<!DOCTYPE html>
<html lang="zh-Hant"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <!-- 標題更改為 v9.0 用於確認 GitHub 上傳成功 -->
    <title>保險導覽系統 (GitHub 終極修正版 v9.0)</title>
    <style>
        /* --- 基礎樣式 (維持 App 手感) --- */
        :root {
            --level-0-bg: #28a745;
            --level-0-text: #ffffff;
            --mobile-bg: #f2f4f8;
            --mobile-header-bg: linear-gradient(90deg, #005a9c, #007bff);
        }

        /* 正常顯示狀態：禁止捲動以維持 App 感 */
        html, body { 
            font-family: -apple-system, sans-serif; 
            background-color: var(--mobile-bg); 
            margin: 0; padding: 0; 
            height: 100vh; 
            overflow: hidden; 
        }

        .view { display: none; flex-direction: column; width: 100%; height: 100%; position: absolute; top: 0; left: 0; background: var(--mobile-bg); }
        .view.active { display: flex; z-index: 10; }
        .header { background: var(--mobile-header-bg); color: white; padding: 15px; text-align: center; position: relative; flex-shrink: 0; z-index: 20; }
        .back-btn { position: absolute; left: 10px; top: 50%; transform: translateY(-50%); background: rgba(255,255,255,0.2); border: none; color: white; padding: 5px 12px; border-radius: 4px; cursor: pointer; }
        .content { flex: 1; overflow-y: auto; padding: 15px; -webkit-overflow-scrolling: touch; }

        .list-item { background: white; margin-bottom: 10px; padding: 15px; border-radius: 10px; display: flex; justify-content: space-between; align-items: center; text-decoration: none; color: inherit; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .circle-container { position: relative; width: 300px; height: 300px; margin: 50px auto; }
        .center-circle { position: absolute; width: 100px; height: 100px; left: 100px; top: 100px; border-radius: 50%; background: var(--level-0-bg); color: white; display: flex; align-items: center; text-align: center; justify-content: center; font-weight: bold; }
        .sub-circle { position: absolute; width: 80px; height: 80px; border-radius: 50%; background: white; border: 2px solid #ddd; display: flex; align-items: center; text-align: center; justify-content: center; font-size: 0.9em; cursor: pointer; }

        /* --- 核心：iOS 終極列印與連結保留樣式 --- */
        @media print {
            /* 1. 徹底摧毀所有限制，這是讓 iOS 彈出視窗的關鍵 */
            html, body { 
                height: auto !important; 
                overflow: visible !important; 
                background: white !important; 
                position: static !important;
            }

            /* 2. 隱藏不必要 UI */
            .no-print, .header, .back-btn, #main-menu-view, #suggested-main-menu-view { 
                display: none !important; 
            }

            /* 3. 列表平坦化 */
            #suggested-product-list-view { 
                display: block !important; 
                position: static !important; 
                height: auto !important; 
                overflow: visible !important;
            }
            #suggested-product-list-content { 
                display: block !important;
                overflow: visible !important; 
                height: auto !important;
                padding: 0 !important;
            }

            /* 4. PDF 連結強化：讓 A 標籤有實體區域 */
            .list-item { 
                page-break-inside: avoid; 
                border: 1px solid #ddd !important;
                margin-bottom: 12px !important;
                padding: 0 !important;
            }
            a { 
                display: block !important; 
                padding: 15px !important;
                text-decoration: underline !important; 
                color: #007bff !important; 
                pointer-events: auto !important;
            }
        }
    </style>
</head>
<body>

    <!-- 主選單視窗 -->
    <div id="main-menu-view" class="view active">
        <div class="header">保險導覽系統 (終極驗證 v9.0)</div>
        <div class="content">
            <div class="circle-container">
                <div class="center-circle">保險<br>規劃</div>
                <div class="sub-circle" style="top: 0; left: 110px;" onclick="showView('#suggested-main-menu-view')">建議組合</div>
            </div>
            <p style="text-align:center; margin-top:30px; color:#888;">GitHub 終極修正版 v9.0</p>
        </div>
    </div>

    <!-- 建議組合主選單 -->
    <div id="suggested-main-menu-view" class="view">
        <div class="header">
            <button class="back-btn" onclick="showView('#main-menu-view')">返回</button>
            終極修正版測試
        </div>
        <div class="content">
            <div class="list-item" onclick="showProductList('建議方案 (v9.0)')">
                <span class="item-text">測試方案 A：點擊進入</span><span class="item-arrow">❯</span>
            </div>
        </div>
    </div>

    <!-- 建議組合產品列表 -->
    <div id="suggested-product-list-view" class="view">
        <div class="header">
            <button class="back-btn no-print" onclick="showView('#suggested-main-menu-view')">返回</button>
            <span id="suggested-list-title">產品列表</span>
            <!-- v9.0 使用直接內聯 onclick 觸發 -->
            <button onclick="executeFinalPrint(this)" style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); background: #28a745; border: none; color: white; padding: 6px 14px; border-radius: 4px; cursor: pointer; font-weight: bold; -webkit-appearance: none;" class="no-print">
                立即產生 PDF (v9.0)
            </button>
        </div>
        <div id="suggested-product-list-content" class="content">
            <div class="list-item">
                <a href="https://www.google.com" target="_blank">
                    <div style="display:flex; justify-content:space-between; width:100%;">
                        <span class="item-text">超連結測試 1 (Google)</span>
                        <span class="item-arrow">測試連結 ❯</span>
                    </div>
                </a>
            </div>
            <div class="list-item">
                <a href="https://github.com" target="_blank">
                    <div style="display:flex; justify-content:space-between; width:100%;">
                        <span class="item-text">超連結測試 2 (GitHub)</span>
                        <span class="item-arrow">測試連結 ❯</span>
                    </div>
                </a>
            </div>
        </div>
    </div>

    <script>
        function showView(selector) {
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.querySelector(selector).classList.add('active');
        }

        function showProductList(title) {
            document.getElementById('suggested-list-title').innerText = title;
            showView('#suggested-product-list-view');
        }

        // --- v9.0 終極修復函式 ---
        function executeFinalPrint(btn) {
            // 1. 立即提供觸發反饋
            btn.style.opacity = "0.5";
            
            // 2. 修復 iOS 核心問題：強制將 body 變為可捲動狀態
            // 如果不這樣做，iOS Safari 會因為抓不到高度而無視 window.print()
            document.documentElement.style.overflow = 'visible';
            document.body.style.overflow = 'visible';

            // 3. 立即呼叫
            window.print();

            // 4. 恢復狀態 (設定較長的延遲，確保列印選單已彈出)
            setTimeout(function() {
                document.documentElement.style.overflow = 'hidden';
                document.body.style.overflow = 'hidden';
                btn.style.opacity = "1";
            }, 2000);
        }
    </script>
</body>
</html>