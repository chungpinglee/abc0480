<!DOCTYPE html>
<html lang="zh-TW"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æä»²å¹³å…¨å®¶-ä¿å–®è³‡ç”¢ç®¡ç†</title>
    
    <style>
        /* =========================================
           ç³»çµ±æ ¸å¿ƒæ¨£å¼
           ========================================= */
        :root {
            --bg-deep: #24355A;
            --bg-modal: #FFFFFF;
            --text-dark: #1F2937;
            --radius-card: 24px;
            --radius-btn: 18px;
            --shadow-card: 0 8px 16px rgba(0,0,0,0.08);
            --transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        body {
            font-family: "Microsoft JhengHei", "å¾®è»Ÿæ­£é»‘é«”", sans-serif;
            background-color: var(--bg-deep);
            color: var(--text-dark);
            margin: 0; padding: 0;
            min-height: 100vh;
            display: flex; flex-direction: column;
            overflow-x: hidden;
            -webkit-tap-highlight-color: transparent;
        }

        /* =========================================
           ğŸ”’ å®‰å…¨ç™»å…¥é®ç½© (Security Overlay)
           ========================================= */
        #security-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--bg-deep);
            z-index: 99999;
            display: flex; justify-content: center; align-items: center;
            flex-direction: column;
            transition: opacity 0.5s;
        }

        .login-box {
            background: white; padding: 40px; border-radius: 20px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
            text-align: center; width: 85%; max-width: 350px;
            animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes popIn { from{transform: scale(0.8); opacity:0;} to{transform: scale(1); opacity:1;} }

        .login-title { font-size: 1.5rem; margin-bottom: 20px; font-weight: 800; color: var(--bg-deep); }
        .login-input { 
            width: 100%; padding: 12px; font-size: 1.2rem; 
            border: 2px solid #eee; border-radius: 10px; margin-bottom: 20px; 
            text-align: center; outline: none; box-sizing: border-box; transition: 0.3s;
        }
        .login-input:focus { border-color: #46B3E6; }
        .login-btn {
            width: 100%; padding: 12px; font-size: 1.2rem; font-weight: bold;
            background: #46B3E6; color: white; border: none; border-radius: 10px;
            cursor: pointer; transition: 0.2s;
        }
        .login-btn:active { transform: scale(0.95); }

        /* é–å®šç•«é¢ */
        #lock-screen {
            display: none; flex-direction: column; justify-content: center; align-items: center;
            width: 100%; height: 100%; text-align: center;
        }
        .lock-msg {
            font-size: 2rem; color: #FF4757; font-weight: 900;
            margin-bottom: 20px; user-select: none; cursor: default;
            padding: 80px 20px;
        }
        .hidden-unlock-area { margin-top: 20px; display: none; }

        /* =========================================
           ä¸»ä»‹é¢æ¨£å¼
           ========================================= */
        header {
            padding: 20px 5%; display: flex; justify-content: center; align-items: center;
            background: rgba(0,0,0,0.15); backdrop-filter: blur(5px);
            position: sticky; top: 0; z-index: 100;
        }
        header h1 { color: white; margin: 0; font-size: 1.6rem; letter-spacing: 1px; font-weight: 800; text-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        
        .floating-toolbar {
            position: fixed; bottom: 30px; right: 30px; z-index: 9000;
            display: flex; flex-direction: column-reverse; gap: 15px; align-items: flex-end;
            pointer-events: none;
        }
        .admin-btn {
            background: rgba(255, 255, 255, 0.9); color: var(--bg-deep);
            border: 1px solid rgba(0,0,0,0.1); width: 60px; height: 60px; border-radius: 50%;
            cursor: pointer; transition: all 0.4s; font-weight: bold; font-size: 1.5rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3); display: flex; align-items: center; justify-content: center;
            pointer-events: auto; backdrop-filter: blur(5px);
        }
        .admin-btn.wide-btn { width: auto; min-width: 140px; height: 50px; border-radius: 50px; font-size: 1rem; padding: 0 20px; gap: 8px; }
        .hidden-btn { opacity: 0; transform: translateY(20px) scale(0.8); pointer-events: none; position: absolute; }
        .admin-btn:not(.hidden-btn) { opacity: 1; transform: translateY(0) scale(1); position: relative; }
        .admin-btn:hover { transform: translateY(-5px) scale(1.1); background: white; box-shadow: 0 8px 25px rgba(0,0,0,0.4); }
        #edit-toggle-btn.edit-mode-active { background: #FF6B6B; color: white; border-color: #FF6B6B; transform: rotate(360deg); box-shadow: 0 0 20px rgba(255, 107, 107, 0.6); }
        .save-btn { background: #46B3E6; color: white; }
        .client-save-btn { background: #2ED573; color: white; }

        /* Main Grid & Cards */
        .main-container { flex: 1; padding: 40px 5%; display: flex; flex-direction: column; align-items: center; width: 100%; box-sizing: border-box; }
        .grid-level-1 { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 30px; width: 100%; max-width: 1400px; margin-bottom: 30px; }
        .main-card {
            border-radius: var(--radius-card); padding: 30px 25px; cursor: pointer; position: relative; overflow: visible;
            min-height: 220px; display: flex; flex-direction: column; justify-content: space-between;
            color: white; box-shadow: var(--shadow-card); border: none; transition: transform 0.3s ease;
        }
        .main-card .icon-large { font-size: 4.5rem; margin-bottom: 10px; filter: drop-shadow(0 4px 6px rgba(0,0,0,0.2)); display: inline-block; animation: breathe 3s infinite ease-in-out; }
        .main-card h2 { font-size: 1.6rem; margin: 0; font-weight: 800; line-height: 1.2; text-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .main-card p { opacity: 0.95; margin-top: 5px; font-size: 1rem; font-weight: 600; }
        .deco-circle { position: absolute; top: -50px; right: -50px; width: 180px; height: 180px; background: rgba(255,255,255,0.15); border-radius: 50%; pointer-events: none; overflow: hidden; }

        /* Modal & Sub Items */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.7); backdrop-filter: blur(8px); z-index: 1000; opacity: 0; visibility: hidden; display: flex; justify-content: center; align-items: center; transition: opacity 0.3s; }
        .modal-overlay.active { opacity: 1; visibility: visible; }
        .modal-content { background: var(--bg-modal); width: 95%; max-width: 1200px; height: 90vh; border-radius: var(--radius-card); display: flex; flex-direction: column; box-shadow: 0 25px 60px rgba(0,0,0,0.5); transform: scale(0.9); opacity: 0; transition: var(--transition); overflow: hidden; }
        .modal-overlay.active .modal-content { transform: scale(1); opacity: 1; }
        .modal-header { padding: 20px 25px; background: white; border-bottom: 2px solid #f0f0f0; display: flex; justify-content: space-between; align-items: center; }
        .modal-title { font-size: 1.4rem; font-weight: 800; display: flex; align-items: center; gap: 10px; color: var(--bg-deep); }
        .close-btn { background: #f3f4f6; border: none; width: 40px; height: 40px; border-radius: 50%; font-size: 1.5rem; cursor: pointer; transition: 0.2s; color: #666; display: flex; align-items: center; justify-content: center; }
        .modal-body { flex: 1; padding: 25px; overflow-y: auto; background-color: #FAFAFA; -webkit-overflow-scrolling: touch; }
        
        .level-2-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .sub-btn { border-radius: var(--radius-btn); padding: 25px 15px; text-align: center; cursor: pointer; transition: transform 0.2s; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 140px; box-shadow: 0 8px 20px rgba(0,0,0,0.15); color: white; position: relative; overflow: visible; border: 2px solid rgba(255,255,255,0.2); }
        .sub-btn.active { box-shadow: inset 0 0 0 5px rgba(255,255,255,0.6); transform: scale(0.98); }
        .sub-btn .emoji { font-size: 3.5rem; margin-bottom: 10px; display: inline-block; filter: drop-shadow(0 4px 4px rgba(0,0,0,0.1)); animation: breathe 3s infinite ease-in-out; }
        .sub-btn .text { font-size: 1.2rem; font-weight: 800; letter-spacing: 0.5px; text-shadow: 0 1px 2px rgba(0,0,0,0.1); }
        
        .level-3-section { display: none; border-top: 3px dashed #ddd; padding-top: 30px; animation: fadeIn 0.5s ease; }
        .section-title { font-size: 1.3rem; margin-bottom: 20px; color: var(--bg-deep); font-weight: 800; display: flex; align-items: center; gap: 10px; }
        .level-3-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; margin-bottom: 30px;}
        .link-card { border-radius: var(--radius-btn); padding: 20px; display: flex; align-items: center; text-decoration: none; color: var(--text-dark); box-shadow: var(--shadow-card); border: 1px solid rgba(0,0,0,0.05); transition: transform 0.3s ease; position: relative; overflow: visible; background: #fff; }
        .link-card .card-icon { font-size: 2.2rem; margin-right: 15px; width: 55px; height: 55px; background: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; box-shadow: 0 4px 8px rgba(0,0,0,0.05); animation: breathe 3s infinite ease-in-out; }
        .link-card strong { display: block; font-size: 1.1rem; margin-bottom: 5px; color: #000; font-weight: 800; }
        .link-card span { font-size: 0.95rem; color: #444; line-height: 1.4; font-weight: 500; }

        /* Animations & Mobile */
        @keyframes breathe { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.08); } }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes shake { 0% { transform: rotate(0deg); } 25% { transform: rotate(1deg); } 50% { transform: rotate(0deg); } 75% { transform: rotate(-1deg); } 100% { transform: rotate(0deg); } }
        
        .edit-mode .main-card, .edit-mode .sub-btn, .edit-mode .link-card { animation: shake 0.3s infinite linear !important; cursor: grab !important; opacity: 1 !important; transform: none !important; }
        .btn-overlay { position: absolute; top: -12px; display: none; gap: 5px; z-index: 20; }
        .btn-overlay.right { right: -10px; }
        .mini-btn { width: 32px; height: 32px; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 16px; cursor: pointer; box-shadow: 0 2px 5px rgba(0,0,0,0.3); border: 2px solid white; transition: transform 0.2s; }
        .delete-btn { background: #FF4757; color: white; }
        .edit-btn { background: #2ED573; color: white; }
        .edit-mode .btn-overlay { display: flex; animation: none !important; }
        
        .add-new-btn { background: rgba(0,0,0,0.05); border: 2px dashed #ccc; border-radius: var(--radius-card); display: flex; align-items: center; justify-content: center; color: #777; font-weight: bold; cursor: pointer; transition: 0.2s; min-height: 100px; }
        .add-new-btn:hover { background: rgba(0,0,0,0.1); color: #333; border-color: #999; }

        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: bold; color: #333; }
        .form-group input { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; font-size: 1rem; box-sizing: border-box; }
        .form-actions { display: flex; justify-content: flex-end; gap: 10px; margin-top: 20px; }
        .btn-confirm { background: #46B3E6; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: bold; }
        .btn-cancel { background: #eee; color: #333; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; }

        @media (hover: hover) {
            body:not(.edit-mode) .main-card:hover { transform: translateY(-10px); box-shadow: 0 25px 50px rgba(0,0,0,0.3); z-index: 5; }
            body:not(.edit-mode) .sub-btn:hover { transform: translateY(-8px); filter: brightness(1.1); }
            body:not(.edit-mode) .link-card:hover { transform: translateY(-5px); box-shadow: var(--shadow-hover); background-color: #D93025 !important; border: 3px solid #D93025; }
            body:not(.edit-mode) .link-card:hover strong, body:not(.edit-mode) .link-card:hover span { color: white !important; }
        }
        @media (max-width: 768px) {
            .grid-level-1 { grid-template-columns: 1fr; }
            .sub-btn { height: 100px; flex-direction: row; justify-content: flex-start; gap: 20px; padding: 15px 25px; text-align: left; }
            .sub-btn .emoji { font-size: 2.5rem; margin-bottom: 0; }
            .floating-toolbar { bottom: 20px; right: 20px; gap: 12px; }
        }
        
        .sortable-ghost { opacity: 0.4; background: #eee !important; border: 2px dashed #999; }
        #editor-modal .modal-content { height: 70vh; max-width: 800px; }
        #json-editor { width: 100%; height: 100%; padding: 20px; font-family: monospace; border: none; resize: none; background: #f8f9fa; font-size: 14px; }
    </style>
</head>
<body class="">

    <div id="security-overlay" style="opacity: 1; display: flex;">
        <div class="login-box" id="login-container">
            <div class="login-title">ğŸ›¡ï¸ å®‰å…¨ç™»å…¥</div>
            <input type="password" id="sys-pwd" class="login-input" placeholder="è«‹è¼¸å…¥å¯†ç¢¼" onkeypress="handleEnter(event)">
            <button class="login-btn" onclick="_check()">é€²å…¥ç³»çµ±</button>
            <div id="err-msg" style="color:red; margin-top:10px; font-weight:bold; height:20px;"></div>
        </div>

        <div id="lock-screen">
            <div id="lock-text" class="lock-msg">éŒ¯èª¤å·²é”3æ¬¡ï¼Œæª”æ¡ˆé–ä½!</div>
            <div id="unlock-area" class="hidden-unlock-area login-box" style="animation: auto ease 0s 1 normal none running none; margin-top: 20px; display: none;">
                <div style="margin-bottom:10px; font-weight:bold;">è§£é™¤é–å®š</div>
                <input type="password" id="unlock-pwd" class="login-input" placeholder="è¼¸å…¥æ­£ç¢ºå¯†ç¢¼é‡ç½®" onkeypress="handleUnlockEnter(event)">
                <button class="login-btn" onclick="_unlock()">è§£é™¤</button>
            </div>
        </div>
    </div>

    <header>
        <h1>ğŸ›¡ï¸ æä»²å¹³å…¨å®¶-ä¿å–®è³‡ç”¢ç®¡ç†</h1>
    </header>

    

    <div class="main-container">
        <div id="level-1-grid" class="grid-level-1"><div class="main-card" data-id="0" style="background-color: rgb(232, 106, 146);">
                    <div class="deco-circle"></div>
                    <div class="icon-large">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦</div>
                    <div><h2>å®¶åº­æˆå“¡åŠä¿å–®å„é …å¥æª¢åˆ†æ</h2><p>æ•´åˆå…¨å®¶èªéŸ³åˆ†æã€æ ¡æ­£å ±å‘Šèˆ‡å€‹äººä¿å–®è©³æƒ…</p></div>
                <div class="btn-overlay right">
                    <div class="mini-btn edit-btn" onclick="openEditForm(event, 'level1', [0])">âœ</div>
                    <div class="mini-btn delete-btn" onclick="deleteCategory(event, 0)">âœ•</div>
                </div></div><div class="main-card" data-id="1" style="background-color: rgb(99, 102, 241);">
                    <div class="deco-circle"></div>
                    <div class="icon-large">ğŸ’¹</div>
                    <div><h2>æŠ•è³‡å‹ä¿éšªå°ˆå€</h2><p>åŠ å€¼çµ¦ä»˜ã€åƒ¹å€¼åˆ†æèˆ‡BVAå ±è¡¨</p></div>
                <div class="btn-overlay right">
                    <div class="mini-btn edit-btn" onclick="openEditForm(event, 'level1', [1])">âœ</div>
                    <div class="mini-btn delete-btn" onclick="deleteCategory(event, 1)">âœ•</div>
                </div></div><div class="main-card" data-id="2" style="background-color: rgb(141, 114, 225);">
                    <div class="deco-circle"></div>
                    <div class="icon-large">ğŸ’°</div>
                    <div><h2>å…¨å®¶è³‡ç”¢çµ±è¨ˆ</h2><p>ä¿éšœã€åƒ¹å€¼ã€é‚„æœ¬é‡‘ä¸‰è¡¨åˆä¸€</p></div>
                <div class="btn-overlay right">
                    <div class="mini-btn edit-btn" onclick="openEditForm(event, 'level1', [2])">âœ</div>
                    <div class="mini-btn delete-btn" onclick="deleteCategory(event, 2)">âœ•</div>
                </div></div><div class="main-card" data-id="3" style="background-color: rgb(253, 185, 64);">
                    <div class="deco-circle"></div>
                    <div class="icon-large">ğŸ¦</div>
                    <div><h2>è²¡å¯Œç®¡ç†å°ˆå€</h2><p>ç¨…å‹™åˆ†æã€å‚³æ‰¿è¦åŠƒèˆ‡æŠ•è³‡</p></div>
                <div class="btn-overlay right">
                    <div class="mini-btn edit-btn" onclick="openEditForm(event, 'level1', [3])">âœ</div>
                    <div class="mini-btn delete-btn" onclick="deleteCategory(event, 3)">âœ•</div>
                </div></div><div class="main-card" data-id="4" style="background-color: rgb(240, 162, 97);">
                    <div class="deco-circle"></div>
                    <div class="icon-large">ğŸš—</div>
                    <div><h2>ç”¢ç‰©ä¿éšª</h2><p>æ±½æ©Ÿè»Šã€ä½å®…ç«éšªèˆ‡è²¬ä»»éšª</p></div>
                <div class="btn-overlay right">
                    <div class="mini-btn edit-btn" onclick="openEditForm(event, 'level1', [4])">âœ</div>
                    <div class="mini-btn delete-btn" onclick="deleteCategory(event, 4)">âœ•</div>
                </div></div><div class="main-card" data-id="5" style="background-color: rgb(90, 191, 154);">
                    <div class="deco-circle"></div>
                    <div class="icon-large">ğŸ¢</div>
                    <div><h2>ä¼æ¥­ä¿å–®å°ˆå€</h2><p>å­£é€šå¯¦æ¥­ã€ç™»å¾¡å¯¦æ¥­</p></div>
                <div class="btn-overlay right">
                    <div class="mini-btn edit-btn" onclick="openEditForm(event, 'level1', [5])">âœ</div>
                    <div class="mini-btn delete-btn" onclick="deleteCategory(event, 5)">âœ•</div>
                </div></div><div class="main-card" data-id="6" style="background-color: rgb(70, 179, 230);">
                    <div class="deco-circle"></div>
                    <div class="icon-large">ğŸ¤</div>
                    <div><h2>å”®å¾Œæœå‹™è³‡æº</h2><p>è¡¨å–®ä¸‹è¼‰èˆ‡è¯çµ¡è³‡è¨Š</p></div>
                <div class="btn-overlay right">
                    <div class="mini-btn edit-btn" onclick="openEditForm(event, 'level1', [6])">âœ</div>
                    <div class="mini-btn delete-btn" onclick="deleteCategory(event, 6)">âœ•</div>
                </div></div><div class="add-new-btn level-1">ï¼‹ æ–°å¢ä¸»åˆ†é¡</div></div>
    </div>

    <div id="view-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <div id="modal-title" class="modal-title"></div>
                <button class="close-btn" onclick="closeViewModal()">âœ•</button>
            </div>
            <div class="modal-body">
                <div id="level-2-container" class="level-2-grid"></div>
                <div id="level-3-section" class="level-3-section">
                    <div id="level-3-title" class="section-title"></div>
                    <div id="level-3-grid" class="level-3-grid"></div>
                </div>
            </div>
        </div>
    </div>

    <div id="form-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title" id="form-title">ç·¨è¼¯é …ç›®</div>
                <button class="close-btn" onclick="closeFormModal()">âœ•</button>
            </div>
            <div class="modal-body">
                <div class="form-group"><label>æ¨™é¡Œ</label><input type="text" id="input-title"></div>
                <div class="form-group" id="group-desc"><label>æè¿°</label><input type="text" id="input-desc"></div>
                <div class="form-group" id="group-url"><label>é€£çµç¶²å€</label><input type="text" id="input-url"></div>
                <div class="form-group"><label>åœ–ç¤º/Emoji</label><input type="text" id="input-icon"></div>
                <div class="form-group" id="group-color"><label>é¡è‰²</label><input type="color" id="input-color"></div>
                <div class="form-actions">
                    <button class="btn-cancel" onclick="closeFormModal()">å–æ¶ˆ</button>
                    <button class="btn-confirm" id="form-submit-btn">ç¢ºèª</button>
                </div>
            </div>
        </div>
    </div>

    <div id="editor-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">âš™ï¸ ç·¨è¼¯è³‡æ–™</div>
                <button class="close-btn" onclick="closeEditor()">Ã—</button>
            </div>
            <div class="modal-body" style="padding:0;"><textarea id="json-editor"></textarea></div>
            <div style="padding:20px; text-align:right; background:#f0f0f0;">
                <button class="admin-btn save-btn wide-btn" onclick="updateData()">æ›´æ–°ä¸¦é è¦½</button>
            </div>
        </div>
    </div>

    <script>
        // ==========================================
        // ğŸ” Security Logic: Mathematical Obfuscation
        // ==========================================
        let _f_c = 0; // Failure Count
        let _l_c = 0; // Lock Click Count
        let isAdmin = false;

        // User Pwd "530712" => Transformed via (c * 7) + 3
        const _u_p = [374, 360, 339, 388, 346, 353];
        
        // Admin Pwd "362963" => Transformed via (c * 7) + 3
        const _a_p = [360, 381, 353, 402, 381, 360];

        function handleEnter(e) { if(e.key === 'Enter') _check(); }
        function handleUnlockEnter(e) { if(e.key === 'Enter') _unlock(); }

        // Core Validation Function
        function _v(input, targetArr) {
            if (input.length !== targetArr.length) return false;
            for (let i = 0; i < input.length; i++) {
                if (((input.charCodeAt(i) * 7) + 3) !== targetArr[i]) return false;
            }
            return true;
        }

        function _check() {
            const pwd = document.getElementById('sys-pwd').value;
            const msg = document.getElementById('err-msg');

            // 1. Check User Password
            if (_v(pwd, _u_p)) {
                isAdmin = false;
                _grantAccess();
                return;
            }

            // 2. Check Admin Password
            if (_v(pwd, _a_p)) {
                isAdmin = true;
                _grantAccess();
                return;
            }

            // 3. Failure
            _f_c++;
            document.getElementById('sys-pwd').value = '';
            if (_f_c >= 3) {
                _lockSystem();
            } else {
                msg.innerText = `å¯†ç¢¼éŒ¯èª¤ (${_f_c}/3)`;
                setTimeout(() => msg.innerText = '', 2000);
            }
        }

        function _lockSystem() {
            document.getElementById('login-container').style.display = 'none';
            const lockScreen = document.getElementById('lock-screen');
            lockScreen.style.display = 'flex';
            
            const lockText = document.getElementById('lock-text');
            _l_c = 0;
            
            // Fix for iPhone double-tap/zoom issues
            lockText.addEventListener('click', function(e) {
                e.preventDefault();
                _l_c++;
                if (_l_c >= 5) {
                    document.getElementById('unlock-area').style.display = 'block';
                    document.getElementById('unlock-area').classList.add('popIn');
                }
            });
        }

        function _unlock() {
            const pwd = document.getElementById('unlock-pwd').value;
            if (_v(pwd, _u_p) || _v(pwd, _a_p)) {
                location.reload(); 
            } else {
                alert("è§£é–å¯†ç¢¼éŒ¯èª¤");
            }
        }

        function _grantAccess() {
            const overlay = document.getElementById('security-overlay');
            overlay.style.opacity = '0';
            setTimeout(() => {
                overlay.style.display = 'none';
                init();
            }, 500);
        }

        // ==========================================
        // ğŸ¨ è‰²å½©åº« & Emoji
        // ==========================================
        const colorPalette = [
            { main: "#FF6B6B", light: "#FFF0F0" }, { main: "#4ECDC4", light: "#E0F7FA" }, 
            { main: "#F9C74F", light: "#FFFDE7" }, { main: "#1A535C", light: "#E0F2F1" }, 
            { main: "#9B5DE5", light: "#F3E5F5" }, { main: "#F15BB5", light: "#FCE4EC" }, 
            { main: "#00BBF9", light: "#E1F5FE" }, { main: "#00F5D4", light: "#E0F2F1" }, 
            { main: "#FB5607", light: "#FFF3E0" }, { main: "#8338EC", light: "#EDE7F6" }, 
            { main: "#3A86FF", light: "#E3F2FD" }, { main: "#FF006E", light: "#FFEBEE" }  
        ];
        const emojiLibrary = ["ğŸ“Š","ğŸ“‘","ğŸ“„","ğŸ—‚ï¸","ğŸ¤","ğŸ©¹","ğŸ“‰","ğŸ’¡","ğŸ¬","ğŸ—£ï¸","ğŸ”","ğŸ“‹","ğŸ¥","ğŸ’°","ğŸ¦","ğŸ’¸","ğŸ“ˆ","ğŸš—","ğŸ›µ","ğŸ˜ï¸","ğŸ§±","ğŸ“‚","ğŸŒ","ğŸ”—","ğŸ›¡ï¸","ğŸ’","ğŸ’µ","ğŸ§­","ğŸ‘µ","ğŸ‘¨","ğŸ‘©","ğŸ‘¦","ğŸ‘©â€ğŸ¦°","ğŸ—ï¸","ğŸ­","âœˆï¸","ğŸ’Š","ğŸ©º","ğŸ§¸","ğŸ","ğŸ“…","âœ…","â­","â¤ï¸","ğŸ”¥","ğŸš€","ğŸ§©","ğŸ¨","ğŸ†","ğŸ””"];
        function getRandomEmoji() { return emojiLibrary[Math.floor(Math.random() * emojiLibrary.length)]; }

        // ==========================================
        // ğŸ”§ è³‡æ–™æ ¸å¿ƒ (Page Data) - ä¾†è‡ªæ‚¨çš„æ¯ç‰ˆæª”æ¡ˆ
        // ==========================================
        let pageData = {
    "categories": [
        {
            "title": "å®¶åº­æˆå“¡åŠä¿å–®å„é …å¥æª¢åˆ†æ",
            "desc": "æ•´åˆå…¨å®¶èªéŸ³åˆ†æã€æ ¡æ­£å ±å‘Šèˆ‡å€‹äººä¿å–®è©³æƒ…",
            "icon": "ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦",
            "color": "#E86A92",
            "subCategories": [
                {
                    "name": "æç´ ç¢§",
                    "emoji": "ğŸ‘©â€ğŸ¦°",
                    "items": [
                        {
                            "title": "ä¿å–®æ ¡æ­£åœ–è¡¨åˆ†æ",
                            "desc": "è¦–è¦ºåŒ–ç¼ºå£åˆ†æ (HTMLç¶²é )",
                            "url": "ä¿å–®åœ–è¡¨åˆ†æ.html",
                            "icon": "ğŸ“Š",
                            "highlight": true
                        },
                        {
                            "title": "ä¿å–®æ ¡æ­£åˆ†æå ±å‘Š",
                            "desc": "è©³ç´°åˆ—è¡¨èˆ‡èªªæ˜ (HTMLç¶²é )",
                            "url": "ä¿å–®åˆ†æå ±å‘Š.html",
                            "icon": "ğŸ“‘",
                            "highlight": true
                        },
                        {
                            "title": "ä¿å–®æ ¡æ­£åˆ†æ(PDF)",
                            "desc": "å®Œæ•´å ±å‘Šæª”æ¡ˆ",
                            "url": "#",
                            "icon": "ğŸ“„"
                        },
                        {
                            "title": "æŠ•ä¿ç´€éŒ„",
                            "desc": "Evernote",
                            "url": "https://share.evernote.com/note/aa3a988f-c735-4f0a-95bf-705462d583b9",
                            "icon": "ğŸ—‚ï¸"
                        },
                        {
                            "title": "æœå‹™ç´€éŒ„",
                            "desc": "Evernote",
                            "url": "https://share.evernote.com/note/9bd4f569-c364-4e93-8b67-cb5202b5fa37",
                            "icon": "ğŸ¤"
                        },
                        {
                            "title": "ç†è³ ç´€éŒ„",
                            "desc": "Evernote",
                            "url": "https://share.evernote.com/note/954a6cba-b7cd-4993-8acc-09bcf00c14a9",
                            "icon": "ğŸ©¹"
                        },
                        {
                            "title": "å—å±±æ ¡æ­£è¡¨",
                            "desc": "PDFæ–‡ä»¶",
                            "url": "å—å±±æ ¡æ­£è¡¨.pdf",
                            "icon": "ğŸ“‰"
                        },
                        {
                            "title": "è£œå¼·å»ºè­°",
                            "desc": "PDFæ–‡ä»¶",
                            "url": "è£œå¼·å»ºè­°.pdf",
                            "icon": "ğŸ’¡"
                        },
                        {
                            "title": "ä¿å–®å¥æª¢åˆ†æ(å½±éŸ³)",
                            "desc": "å€‹äººåˆ†æå½±éŸ³",
                            "url": "ä¿å–®å¥æª¢åˆ†æ.mp4",
                            "icon": "ğŸ¬"
                        }
                    ]
                },
                {
                    "name": "æéº—ç´",
                    "emoji": "ğŸ‘©",
                    "items": [
                        {
                            "title": "å€‹äººèªéŸ³åˆ†æ",
                            "desc": "å°ˆå±¬ä¿å–®è§£èªª",
                            "url": "https://drive.google.com/file/d/1ePhQ-1JX9qf9sJQhcN-I2kkguYzMu9Bw/view?usp=drive_link",
                            "icon": "ğŸ—£ï¸",
                            "highlight": true
                        },
                        {
                            "title": "å€‹äººä¿å–®åˆ†æ",
                            "desc": "è©³ç´°æ¢æ¬¾æ ¡æ­£",
                            "url": "#",
                            "icon": "ğŸ”",
                            "highlight": true
                        },
                        {
                            "title": "å—å±±ä¿å–®æ ¡æ­£",
                            "desc": "å—å±±äººå£½å°ˆå±¬",
                            "url": "https://drive.google.com/file/d/1ET2kY7CQG8CfW83JNpx1L5uEXc_nb36X/view?usp=drive_link",
                            "icon": "ğŸ“‹"
                        },
                        {
                            "title": "æŠ•ä¿ç´€éŒ„",
                            "desc": "Evernote",
                            "url": "https://share.evernote.com/note/cd391a19-ccdf-4587-9191-61dae59c03f9",
                            "icon": "ğŸ—‚ï¸"
                        },
                        {
                            "title": "æœå‹™ç´€éŒ„",
                            "desc": "Evernote",
                            "url": "https://share.evernote.com/note/139b0871-e4cd-4d81-9a6c-627a7550dd2d",
                            "icon": "ğŸ¤"
                        },
                        {
                            "title": "ç†è³ ç´€éŒ„",
                            "desc": "Evernote",
                            "url": "https://share.evernote.com/note/3f8f5f00-6c10-43ba-8ee4-22a3f8347574",
                            "icon": "ğŸ©¹"
                        }
                    ]
                },
                {
                    "name": "å³é€²è²¡",
                    "emoji": "ğŸ‘¨",
                    "items": [
                        {
                            "title": "å€‹äººèªéŸ³åˆ†æ",
                            "desc": "å°ˆå±¬ä¿å–®è§£èªª",
                            "url": "https://drive.google.com/file/d/1ioya4qOrhGwIHytNb_FOaKhtquGZnu51/view?usp=drive_link",
                            "icon": "ğŸ—£ï¸",
                            "highlight": true
                        },
                        {
                            "title": "å€‹äººä¿å–®åˆ†æ",
                            "desc": "è©³ç´°æ¢æ¬¾æ ¡æ­£",
                            "url": "https://drive.google.com/file/d/1aVURO8DNYEqqZizVIetULev93qPTc6YY/view?usp=drive_link",
                            "icon": "ğŸ”",
                            "highlight": true
                        },
                        {
                            "title": "å—å±±ä¿å–®æ ¡æ­£",
                            "desc": "å—å±±äººå£½å°ˆå±¬",
                            "url": "https://drive.google.com/file/d/1R_w8pjFBBNv5dzqZ2DUilDvRTDBBYMn1/view?usp=drive_link",
                            "icon": "ğŸ“‹"
                        },
                        {
                            "title": "æŠ•ä¿ç´€éŒ„",
                            "desc": "Nanshan",
                            "url": "https://share.evernote.com/note/0f59487e-3cc3-4193-9db2-12e6def63aa0",
                            "icon": "ğŸ—‚ï¸"
                        },
                        {
                            "title": "æœå‹™ç´€éŒ„",
                            "desc": "Evernote",
                            "url": "https://share.evernote.com/note/bd60b2d5-5fec-483d-9294-f9bcb1ba336e",
                            "icon": "ğŸ¤"
                        },
                        {
                            "title": "ç†è³ ç´€éŒ„",
                            "desc": "Evernote",
                            "url": "https://share.evernote.com/note/e9e822bf-803a-48cf-80cb-6bac4b429a23",
                            "icon": "ğŸ©¹"
                        }
                    ]
                },
                {
                    "name": "å³éœ½èˆª",
                    "emoji": "ğŸ‘¦",
                    "items": [
                        {
                            "title": "å€‹äººèªéŸ³åˆ†æ",
                            "desc": "å°ˆå±¬ä¿å–®è§£èªª",
                            "url": "https://drive.google.com/file/d/1sVTAcEmax7YyWJJvqJuJ7VzrS5OLC1Bk/view?usp=drive_link",
                            "icon": "ğŸ—£ï¸",
                            "highlight": true
                        },
                        {
                            "title": "å€‹äººä¿å–®åˆ†æ",
                            "desc": "è©³ç´°æ¢æ¬¾æ ¡æ­£",
                            "url": "https://drive.google.com/file/d/1HsDnUmOdntk6t-F29rI45dOBIUcwnvTd/view?usp=drive_link",
                            "icon": "ğŸ”",
                            "highlight": true
                        },
                        {
                            "title": "å—å±±ä¿å–®æ ¡æ­£",
                            "desc": "å—å±±äººå£½å°ˆå±¬",
                            "url": "https://drive.google.com/file/d/1mFfHrGi1KroGHdYlqA8vPpNDI1D0VTLl/view?usp=drive_link",
                            "icon": "ğŸ“‹"
                        },
                        {
                            "title": "æŠ•ä¿ç´€éŒ„",
                            "desc": "Evernote",
                            "url": "https://share.evernote.com/note/1643c582-21a0-47be-a053-e24a1847686d",
                            "icon": "ğŸ—‚ï¸"
                        },
                        {
                            "title": "æœå‹™ç´€éŒ„",
                            "desc": "Evernote",
                            "url": "https://share.evernote.com/note/2d7f3cad-c1d2-4a23-be86-b4f713c73ae1",
                            "icon": "ğŸ¤"
                        },
                        {
                            "title": "ç†è³ ç´€éŒ„",
                            "desc": "Evernote",
                            "url": "https://share.evernote.com/note/2cec8ac0-0f5c-4ef1-a4f0-867ab318e22b",
                            "icon": "ğŸ©¹"
                        }
                    ]
                },
                {
                    "name": "æå¾ç´ ç",
                    "emoji": "ğŸ‘µ",
                    "items": [
                        {
                            "title": "æŠ•ä¿ç´€éŒ„",
                            "desc": "Evernote",
                            "url": "https://share.evernote.com/note/23430a1a-8ff5-4b3b-8352-61aed5567e2c",
                            "icon": "ğŸ—‚ï¸"
                        },
                        {
                            "title": "æœå‹™ç´€éŒ„",
                            "desc": "Evernote",
                            "url": "#",
                            "icon": "ğŸ¤"
                        },
                        {
                            "title": "ç†è³ ç´€éŒ„",
                            "desc": "Evernote",
                            "url": "#",
                            "icon": "ğŸ©¹"
                        }
                    ]
                }
            ]
        },
        {
            "title": "æŠ•è³‡å‹ä¿éšªå°ˆå€",
            "desc": "åŠ å€¼çµ¦ä»˜ã€åƒ¹å€¼åˆ†æèˆ‡BVAå ±è¡¨",
            "icon": "ğŸ’¹",
            "color": "#6366F1",
            "subCategories": [
                {
                    "name": "åˆ†æèˆ‡å ±è¡¨",
                    "emoji": "ğŸ“ˆ",
                    "items": [
                        {
                            "title": "èªéŸ³è§£èªª",
                            "desc": "åˆ†æå°è¦½",
                            "url": "https://drive.google.com/file/d/1ZLp1kj6cZj7DXrmwwNOJwKETfo5Y7OFd/view?usp=drive_link",
                            "icon": "ğŸ§"
                        },
                        {
                            "title": "æŠ•è³‡å‹ä¿å–®åˆ†æ",
                            "desc": "åŠ å€¼çµ¦ä»˜èˆ‡åƒ¹å€¼(PDF)",
                            "url": "https://drive.google.com/file/d/1e5V79mzGUd01i2iDFp_77ntB0786SGey/view?usp=drive_link",
                            "icon": "ğŸ“‘"
                        },
                        {
                            "title": "BVAå ±è¡¨",
                            "desc": "Evernote",
                            "url": "https://share.evernote.com/note/ecb649b3-54b9-482c-0de3-8baf19520f31",
                            "icon": "ğŸ“‰"
                        }
                    ]
                }
            ]
        },
        {
            "title": "å…¨å®¶è³‡ç”¢çµ±è¨ˆ",
            "desc": "ä¿éšœã€åƒ¹å€¼ã€é‚„æœ¬é‡‘ä¸‰è¡¨åˆä¸€",
            "icon": "ğŸ’°",
            "color": "#8D72E1",
            "subCategories": [
                {
                    "name": "ä¸‰å¤§çµ±è¨ˆè¡¨",
                    "emoji": "ğŸ“Š",
                    "items": [
                        {
                            "title": "å…¨å®¶ä¿éšœçµ±è¨ˆè¡¨",
                            "desc": "äººç”Ÿä¿è­‰é‡‘",
                            "url": "../å…¨å®¶ä¿éšœçµ±è¨ˆè¡¨/å…¨å®¶ä¿éšœçµ±è¨ˆè¡¨.html",
                            "icon": "ğŸ›¡ï¸"
                        },
                        {
                            "title": "å…¨å®¶ä¿å–®åƒ¹å€¼",
                            "desc": "å®¶åº­è³‡ç”¢",
                            "url": "../å…¨å®¶ä¿å–®åƒ¹å€¼çµ±è¨ˆè¡¨/å…¨å®¶ä¿å–®åƒ¹å€¼çµ±è¨ˆè¡¨.html",
                            "icon": "ğŸ’"
                        },
                        {
                            "title": "å…¨å®¶é‚„æœ¬é‡‘çµ±è¨ˆ",
                            "desc": "å®¶åº­ç¾é‡‘æµ",
                            "url": "../å…¨å®¶é‚„æœ¬é‡‘çµ±è¨ˆè¡¨/å…¨å®¶é‚„æœ¬é‡‘çµ±è¨ˆè¡¨.html",
                            "icon": "ğŸ’µ"
                        }
                    ]
                },
                {
                    "name": "ç³»çµ±å°èˆª",
                    "emoji": "ğŸ§­",
                    "items": [
                        {
                            "title": "å›ç³»çµ±é¦–é ",
                            "desc": "æéº—ç´å…¨å®¶é¦–é ",
                            "url": "file:///C:/Users/%E6%9D%8E%E4%BB%B2%E5%B9%B3/Desktop/%E6%88%91%E7%9A%84HTML%E7%B3%BB%E7%B5%B1/%E5%AE%A2%E6%88%B6%E7%AE%A1%E7%90%86/%E6%9D%8E%E9%BA%97%E7%90%B4%E5%85%A8%E5%AE%B6/%E6%9D%8E%E9%BA%97%E7%90%B4%E5%85%A8%E5%AE%B6%E9%A6%96%E9%A0%81.html",
                            "icon": "ğŸ”™"
                        }
                    ]
                }
            ]
        },
        {
            "title": "è²¡å¯Œç®¡ç†å°ˆå€",
            "desc": "ç¨…å‹™åˆ†æã€å‚³æ‰¿è¦åŠƒèˆ‡æŠ•è³‡",
            "icon": "ğŸ¦",
            "color": "#FDB940",
            "subCategories": [
                {
                    "name": "ç¨…å‹™èˆ‡å‚³æ‰¿",
                    "emoji": "âš–ï¸",
                    "items": [
                        {
                            "title": "è²¡å¯Œå‚³æ‰¿åˆ†æ",
                            "desc": "èªéŸ³ç‰ˆ",
                            "url": "https://drive.google.com/file/d/1oREACA7iiXogsUXFhpUlM2UEpxYOvFON/view?usp=sharing",
                            "icon": "ğŸ—£ï¸"
                        },
                        {
                            "title": "å…¨å®¶ç¨…å‹™åˆ†æ",
                            "desc": "PDF",
                            "url": "https://drive.google.com/file/d/1HP2e5SIP3uAcJm8Lyu5CE3RiHyuiqe6J/view?usp=drive_link",
                            "icon": "ğŸ§¾"
                        },
                        {
                            "title": "è³‡ç”¢ç¾é‡‘æµåˆ†æ",
                            "desc": "PDF",
                            "url": "https://drive.google.com/file/d/13ECn-fc1mnmH4i60fg6Wj8ypFES98Vwa/view?usp=drive_link",
                            "icon": "ğŸ’§"
                        }
                    ]
                }
            ]
        },
        {
            "title": "ç”¢ç‰©ä¿éšª",
            "desc": "æ±½æ©Ÿè»Šã€ä½å®…ç«éšªèˆ‡è²¬ä»»éšª",
            "icon": "ğŸš—",
            "color": "#F0A261",
            "subCategories": [
                {
                    "name": "è»Šè¼›ä¿éšª",
                    "emoji": "ğŸš˜",
                    "items": [
                        {
                            "title": "æ±½è»Šéšª-å­£é€šå¯¦æ¥­",
                            "desc": "7986-L8",
                            "url": "https://lite.evernote.com/note/659f5c0d-43b9-448c-a6c3-0370fcdd8c13",
                            "icon": "ğŸš™"
                        },
                        {
                            "title": "æ±½è»Šéšª-æéº—ç´",
                            "desc": "6986-YQ (ä¸™å¼)",
                            "url": "https://lite.evernote.com/note/158484e9-8c19-4fae-bfd9-95bcf031f763",
                            "icon": "ğŸš™"
                        },
                        {
                            "title": "æ±½è»Šéšª-æéº—ç´",
                            "desc": "BXM-9689 (ä¹™å¼)",
                            "url": "https://share.evernote.com/note/123d451e-90a4-cd6d-5d74-9e8cf2db7c10",
                            "icon": "ğŸš™"
                        },
                        {
                            "title": "æ©Ÿè»Šéšª-å³éœ½èˆª",
                            "desc": "MPM-9209",
                            "url": "https://lite.evernote.com/note/09e1263c-a93d-4017-a137-e8825bc553c2",
                            "icon": "ğŸ›µ"
                        },
                        {
                            "title": "æ©Ÿè»Šéšª-å³é€²è²¡",
                            "desc": "NAE-9689",
                            "url": "https://lite.evernote.com/note/65f9dbc9-788e-494c-a754-0bbb402c689d",
                            "icon": "ğŸ›µ"
                        },
                        {
                            "title": "æ±½è»Šéšªèªªæ˜æ›¸",
                            "desc": "æ•…äº‹æ›¸ç”¢ç”Ÿå™¨",
                            "url": "C:\\Users\\æä»²å¹³\\Desktop\\æˆ‘çš„HTMLç³»çµ±\\ç¨‹å¼-æ•…äº‹æ›¸ç”¢ç”Ÿå™¨\\æ±½è»Šä¿éšª\\å°ææ–°è»Šçš„å¥‡å¹»ä¹‹-æ•…äº‹\\car_insurance_storybook.html",
                            "icon": "ğŸ“–"
                        }
                    ]
                },
                {
                    "name": "ä½å®…ç«éšª",
                    "emoji": "ğŸ ",
                    "items": [
                        {
                            "title": "åŸºéš†æš–æš–335å··",
                            "desc": "å³é€²è²¡ (æ”¹å»ºä¸­)",
                            "url": "https://lite.evernote.com/note/10a77216-a590-40a1-94e5-9f7912bb48a3",
                            "icon": "ğŸ§±"
                        },
                        {
                            "title": "åŸºéš†æš–æš–è¡—495è™Ÿ",
                            "desc": "æéº—ç´",
                            "url": "https://lite.evernote.com/note/5b9e0fb2-6685-4509-9d98-b07622f92191",
                            "icon": "ğŸ¡"
                        },
                        {
                            "title": "åŸºéš†æš–æš–è¡—323è™Ÿ",
                            "desc": "å³é€²è²¡",
                            "url": "https://lite.evernote.com/note/91e326bd-08ea-741f-bcda-991e3ab78071",
                            "icon": "ğŸ¢"
                        }
                    ]
                },
                {
                    "name": "å—å±±ç”¢ç‰©ç¸½è¡¨",
                    "emoji": "ğŸ“‘",
                    "items": [
                        {
                            "title": "å—å±±ç”¢ç‰©ç¸½è¡¨",
                            "desc": "ç¸½è¦½",
                            "url": "#",
                            "icon": "ğŸ“‚"
                        }
                    ]
                }
            ]
        },
        {
            "title": "ä¼æ¥­ä¿å–®å°ˆå€",
            "desc": "å­£é€šå¯¦æ¥­ã€ç™»å¾¡å¯¦æ¥­",
            "icon": "ğŸ¢",
            "color": "#5ABF9A",
            "subCategories": [
                {
                    "name": "å­£é€šå¯¦æ¥­",
                    "emoji": "ğŸ—ï¸",
                    "items": [
                        {
                            "title": "æŠ•ä¿ç´€éŒ„",
                            "desc": "",
                            "url": "https://share.evernote.com/note/a4c99a9f-27b3-4ab6-9c3d-b80fc1adee97",
                            "icon": "ğŸ—‚ï¸"
                        }
                    ]
                }
            ]
        },
        {
            "title": "å”®å¾Œæœå‹™è³‡æº",
            "desc": "è¡¨å–®ä¸‹è¼‰èˆ‡è¯çµ¡è³‡è¨Š",
            "icon": "ğŸ¤",
            "color": "#46B3E6",
            "url": "å”®å¾Œæœå‹™è³‡æº-é›»è…¦ç‰ˆ/index.html.html",
            "subCategories": []
        }
    ]
};

        // ==========================================
        // ğŸ”§ ç·¨è¼¯æ¨¡å¼èˆ‡ç‹€æ…‹
        // ==========================================
        let isEditMode = false;
        let currentModalCatIndex = -1;
        let currentModalSubIndex = -1;
        let editTarget = null; 

        // ==========================================
        // ğŸš€ UI æ¸²æŸ“é‚è¼¯
        // ==========================================
        const mainGrid = document.getElementById('level-1-grid');
        const viewModal = document.getElementById('view-modal');
        const modalTitle = document.getElementById('modal-title');
        const level2Container = document.getElementById('level-2-container');
        const level3Section = document.getElementById('level-3-section');
        const level3Title = document.getElementById('level-3-title');
        const level3Grid = document.getElementById('level-3-grid');
        const editToggleBtn = document.getElementById('edit-toggle-btn');
        const sourceBtn = document.getElementById('source-btn');
        const saveBtn = document.getElementById('save-btn');
        const clientSaveBtn = document.getElementById('client-save-btn'); 

        // Form Modal Elements
        const formModal = document.getElementById('form-modal');
        const inputTitle = document.getElementById('input-title');
        const inputDesc = document.getElementById('input-desc');
        const inputUrl = document.getElementById('input-url');
        const inputIcon = document.getElementById('input-icon');
        const inputColor = document.getElementById('input-color');
        const formSubmitBtn = document.getElementById('form-submit-btn');

        function init() {
            renderLevel1();
            initLevel1Sortable();
        }

        // Toggle Edit Mode - éœ€æª¢æŸ¥ç®¡ç†å“¡æ¬Šé™
        function toggleEditMode() {
            if (!isAdmin) {
                const input = prompt("è«‹è¼¸å…¥ç®¡ç†å“¡å¯†ç¢¼ (362963) ä»¥å•Ÿç”¨ç¶­ä¿®æ¨¡å¼ï¼š");
                if (input === null) return;
                if (_v(input, _a_p)) {
                    isAdmin = true;
                    alert("ç®¡ç†å“¡æ¬Šé™å·²å•Ÿç”¨ âœ…");
                } else {
                    alert("å¯†ç¢¼éŒ¯èª¤ âŒ");
                    return;
                }
            }

            isEditMode = !isEditMode;
            document.body.classList.toggle('edit-mode', isEditMode);
            editToggleBtn.classList.toggle('edit-mode-active', isEditMode);
            editToggleBtn.innerHTML = isEditMode ? 'âœ…' : 'ğŸ”§';
            
            if (isEditMode) {
                sourceBtn.classList.remove('hidden-btn');
                saveBtn.classList.remove('hidden-btn');
                clientSaveBtn.classList.remove('hidden-btn'); 
            } else {
                sourceBtn.classList.add('hidden-btn');
                saveBtn.classList.add('hidden-btn');
                clientSaveBtn.classList.add('hidden-btn'); 
            }

            renderLevel1();
            if (viewModal.classList.contains('active')) {
                openModal(currentModalCatIndex, true); 
            }
        }

        function renderLevel1() {
            mainGrid.innerHTML = '';
            if(!pageData) return;
            pageData.categories.forEach((cat, index) => {
                const card = document.createElement('div');
                card.className = 'main-card';
                card.style.backgroundColor = cat.color;
                card.setAttribute('data-id', index);
                
                const overlay = document.createElement('div');
                overlay.className = 'btn-overlay right';
                overlay.innerHTML = `
                    <div class="mini-btn edit-btn" onclick="openEditForm(event, 'level1', [${index}])">âœ</div>
                    <div class="mini-btn delete-btn" onclick="deleteCategory(event, ${index})">âœ•</div>
                `;
                
                card.innerHTML = `
                    <div class="deco-circle"></div>
                    <div class="icon-large">${cat.icon}</div>
                    <div><h2>${cat.title}</h2><p>${cat.desc}</p></div>
                `;
                card.appendChild(overlay);

                if (isEditMode) {
                    if(cat.url) card.onclick = (e) => openEditForm(e, 'level1', [index]);
                    else card.onclick = () => openModal(index);
                } else {
                    if (cat.url) card.onclick = () => window.location.href = cat.url;
                    else card.onclick = () => openModal(index);
                }
                mainGrid.appendChild(card);
            });

            if(isEditMode) {
                const addBtn = document.createElement('div');
                addBtn.className = 'add-new-btn level-1';
                addBtn.innerHTML = 'ï¼‹ æ–°å¢ä¸»åˆ†é¡';
                addBtn.onclick = () => openAddForm('level1');
                mainGrid.appendChild(addBtn);
            }
        }

        function initLevel1Sortable() {
            if(typeof Sortable === 'undefined') return; 
            try {
                new Sortable(mainGrid, {
                    animation: 150,
                    ghostClass: 'sortable-ghost',
                    filter: '.add-new-btn',
                    onMove: function (evt) { return !evt.related.classList.contains('add-new-btn'); },
                    onEnd: function (evt) {
                        if(evt.newIndex >= pageData.categories.length) return; 
                        const movedItem = pageData.categories.splice(evt.oldIndex, 1)[0];
                        pageData.categories.splice(evt.newIndex, 0, movedItem);
                    }
                });
            } catch(e) {}
        }

        function openModal(catIndex, restoreLevel3 = false) {
            currentModalCatIndex = catIndex;
            const category = pageData.categories[catIndex];
            if(!category) return;

            modalTitle.innerHTML = `<span style="margin-right:15px; font-size: 2rem;">${category.icon}</span> ${category.title}`;
            modalTitle.style.color = category.color;
            
            level2Container.innerHTML = '';
            if(!restoreLevel3) {
                level3Section.style.display = 'none'; 
                level3Grid.innerHTML = '';
                currentModalSubIndex = -1;
            }

            if(category.subCategories) {
                category.subCategories.forEach((sub, subIndex) => {
                    const btn = document.createElement('div');
                    btn.className = 'sub-btn';
                    if(currentModalSubIndex === subIndex) btn.classList.add('active'); 
                    
                    const overlay = document.createElement('div');
                    overlay.className = 'btn-overlay right';
                    overlay.innerHTML = `
                        <div class="mini-btn edit-btn" onclick="openEditForm(event, 'level2', [${catIndex}, ${subIndex}])">âœ</div>
                        <div class="mini-btn delete-btn" onclick="deleteSubCategory(event, ${catIndex}, ${subIndex})">âœ•</div>
                    `;

                    const colorObj = colorPalette[subIndex % colorPalette.length];
                    btn.style.setProperty('background-color', colorObj.main, 'important');
                    btn.innerHTML = `<div class="emoji">${sub.emoji}</div><div class="text">${sub.name}</div>`;
                    btn.appendChild(overlay);

                    btn.onclick = () => {
                        document.querySelectorAll('.sub-btn').forEach(b => b.classList.remove('active'));
                        btn.classList.add('active');
                        renderLevel3(sub, colorObj, subIndex);
                    };
                    level2Container.appendChild(btn);
                });
            }

            if(isEditMode) {
                const addBtn = document.createElement('div');
                addBtn.className = 'add-new-btn level-2';
                addBtn.innerHTML = 'ï¼‹ æ–°å¢å­åˆ†é¡';
                addBtn.onclick = () => openAddForm('level2');
                level2Container.appendChild(addBtn);
            }
            viewModal.classList.add('active');
        }

        function renderLevel3(subCategory, parentColorObj, subIndex) {
            currentModalSubIndex = subIndex;
            level3Section.style.display = 'block';
            level3Title.innerHTML = `<span style="font-size:1.5rem;">${subCategory.emoji}</span> ${subCategory.name} - è©³ç´°è³‡æ–™`;
            level3Title.style.color = parentColorObj.main; 
            level3Grid.innerHTML = '';

            if(subCategory.items) {
                subCategory.items.forEach((item, index) => {
                    const card = document.createElement('a');
                    card.className = `link-card ${item.highlight ? 'highlight' : ''}`;
                    
                    const overlay = document.createElement('div');
                    overlay.className = 'btn-overlay right';
                    overlay.innerHTML = `
                        <div class="mini-btn edit-btn" onclick="openEditForm(event, 'level3', [${currentModalCatIndex}, ${subIndex}, ${index}])">âœ</div>
                        <div class="mini-btn delete-btn" onclick="deleteItem(event, ${currentModalCatIndex}, ${subIndex}, ${index})">âœ•</div>
                    `;

                    if(!isEditMode) {
                        card.href = item.url || '#';
                        card.target = '_blank';
                    } else {
                        card.href = 'javascript:void(0)';
                    }
                    
                    const specificColor = colorPalette[index % colorPalette.length];
                    card.style.setProperty('background-color', specificColor.light);

                    card.innerHTML = `
                        <div class="card-icon">${item.icon}</div>
                        <div><strong>${item.title}</strong><span>${item.desc}</span></div>
                    `;
                    card.appendChild(overlay);
                    level3Grid.appendChild(card);
                });
            }

            if(isEditMode) {
                const addBtn = document.createElement('div');
                addBtn.className = 'add-new-btn level-3';
                addBtn.innerHTML = 'ï¼‹ æ–°å¢é€£çµ';
                addBtn.onclick = () => openAddForm('level3');
                level3Grid.appendChild(addBtn);
            }
            setTimeout(() => level3Section.scrollIntoView({ behavior: 'smooth', block: 'start' }), 100);
        }

        // ==========================================
        // âœï¸ è¡¨å–®é‚è¼¯
        // ==========================================
        function openAddForm(level) {
            editTarget = { type: level, action: 'add' };
            document.getElementById('form-title').innerText = "æ–°å¢é …ç›®";
            ['input-title','input-desc','input-url','input-icon'].forEach(id=>document.getElementById(id).value='');
            document.getElementById('input-color').value = "#46B3E6";

            document.getElementById('group-desc').style.display = (level === 'level2') ? 'none' : 'block';
            document.getElementById('group-url').style.display = (level === 'level1' || level === 'level3') ? 'block' : 'none';
            document.getElementById('group-color').style.display = (level === 'level1') ? 'block' : 'none';
            formModal.classList.add('active');
        }

        function openEditForm(event, level, indices) {
            event.stopPropagation(); event.preventDefault();
            editTarget = { type: level, action: 'edit', indices: indices };
            document.getElementById('form-title').innerText = "ç·¨è¼¯é …ç›®";

            let data;
            if(level === 'level1') data = pageData.categories[indices[0]];
            else if(level === 'level2') data = pageData.categories[indices[0]].subCategories[indices[1]];
            else if(level === 'level3') data = pageData.categories[indices[0]].subCategories[indices[1]].items[indices[2]];

            inputTitle.value = data.title || data.name;
            inputDesc.value = data.desc || '';
            inputUrl.value = data.url || '';
            inputIcon.value = data.icon || data.emoji;
            if(data.color) document.getElementById('input-color').value = data.color;

            document.getElementById('group-desc').style.display = (level==='level2')?'none':'block';
            document.getElementById('group-url').style.display = (level==='level2')?'none':'block';
            document.getElementById('group-color').style.display = (level==='level1')?'block':'none';
            formModal.classList.add('active');
        }

        formSubmitBtn.onclick = () => {
            const title = inputTitle.value.trim();
            if(!title) { alert("æ¨™é¡Œå¿…å¡«"); return; }
            const desc = inputDesc.value.trim();
            const url = inputUrl.value.trim();
            let icon = inputIcon.value.trim() || getRandomEmoji();
            const color = document.getElementById('input-color').value;

            if(editTarget.action === 'add') {
                if(editTarget.type === 'level1') {
                    pageData.categories.push({ title, desc, icon, color, url, subCategories: [] });
                    renderLevel1();
                } else if(editTarget.type === 'level2') {
                    if(!pageData.categories[currentModalCatIndex].subCategories) pageData.categories[currentModalCatIndex].subCategories = [];
                    pageData.categories[currentModalCatIndex].subCategories.push({ name: title, emoji: icon, items: [] });
                    openModal(currentModalCatIndex, true);
                } else if(editTarget.type === 'level3') {
                    const subCat = pageData.categories[currentModalCatIndex].subCategories[currentModalSubIndex];
                    if(!subCat.items) subCat.items = [];
                    subCat.items.push({ title, desc, icon, url });
                    const colorObj = colorPalette[currentModalSubIndex % colorPalette.length];
                    renderLevel3(subCat, colorObj, currentModalSubIndex);
                }
            } else {
                const idx = editTarget.indices;
                if(editTarget.type === 'level1') {
                    Object.assign(pageData.categories[idx[0]], { title, desc, url, icon, color });
                    renderLevel1();
                } else if(editTarget.type === 'level2') {
                    Object.assign(pageData.categories[idx[0]].subCategories[idx[1]], { name: title, emoji: icon });
                    openModal(idx[0], true);
                } else if(editTarget.type === 'level3') {
                    Object.assign(pageData.categories[idx[0]].subCategories[idx[1]].items[idx[2]], { title, desc, url, icon });
                    const colorObj = colorPalette[idx[1] % colorPalette.length];
                    renderLevel3(pageData.categories[idx[0]].subCategories[idx[1]], colorObj, idx[1]);
                }
            }
            closeFormModal();
        };

        function closeFormModal() { formModal.classList.remove('active'); }
        function deleteCategory(e, i) { e.stopPropagation(); if(confirm('åˆªé™¤æ­¤ä¸»åˆ†é¡ï¼Ÿ')) { pageData.categories.splice(i, 1); renderLevel1(); } }
        function deleteSubCategory(e, ci, si) { e.stopPropagation(); if(confirm('åˆªé™¤æ­¤å­åˆ†é¡ï¼Ÿ')) { pageData.categories[ci].subCategories.splice(si, 1); openModal(ci, true); } }
        function deleteItem(e, ci, si, ii) { 
            e.stopPropagation(); e.preventDefault(); 
            if(confirm('åˆªé™¤æ­¤é€£çµï¼Ÿ')) { 
                pageData.categories[ci].subCategories[si].items.splice(ii, 1); 
                renderLevel3(pageData.categories[ci].subCategories[si], colorPalette[si % colorPalette.length], si); 
            } 
        }

        function closeViewModal() { viewModal.classList.remove('active'); }
        
        // Editor
        const editorModal = document.getElementById('editor-modal');
        const jsonEditor = document.getElementById('json-editor');
        function openEditor() { jsonEditor.value = JSON.stringify(pageData, null, 4); editorModal.classList.add('active'); }
        function closeEditor() { editorModal.classList.remove('active'); }
        function updateData() { try { pageData = JSON.parse(jsonEditor.value); renderLevel1(); closeEditor(); } catch(e) { alert("JSON éŒ¯èª¤"); } }

        // ==========================================
        // ğŸ’¾ å„²å­˜èˆ‡åŠ å¯†åŒ¯å‡ºé‚è¼¯
        // ==========================================
        function saveAndDownload() { _exportFile(false); }
        function saveAsClient() { _exportFile(true); }

        function _exportFile(isClientMode) {
            let fileName = prompt(isClientMode ? "è«‹è¼¸å…¥å®¢æˆ¶æª”åï¼š" : "è«‹è¼¸å…¥æª”æ¡ˆåç¨±ï¼š", document.title);
            if (fileName === null) return;
            if (!fileName.trim()) fileName = "ä¿å–®ç®¡ç†";
            if (!fileName.endsWith(".html")) fileName += ".html";
            let displayTitle = fileName.replace(".html", "").trim();

            const newDoc = document.documentElement.cloneNode(true);
            
            // 1. æ›´æ–°æ¨™é¡Œ
            newDoc.querySelector('title').innerText = displayTitle;
            const h1 = newDoc.querySelector('header h1');
            if(h1) h1.innerText = 'ğŸ›¡ï¸ ' + displayTitle;

            // 2. é‡ç½®ç‹€æ…‹
            newDoc.querySelector('body').classList.remove('edit-mode');
            const newEditBtn = newDoc.querySelector('#edit-toggle-btn');
            if (newEditBtn) { newEditBtn.classList.remove('edit-mode-active'); newEditBtn.innerHTML = 'ğŸ”§'; }
            
            // 3. è™•ç†æŒ‰éˆ•èƒ½è¦‹åº¦ èˆ‡ ç§»é™¤æ‹–æ›³åŠŸèƒ½
            const toolbar = newDoc.querySelector('.floating-toolbar');
            if (isClientMode) {
                // å®¢æˆ¶æ¨¡å¼ï¼šå®Œå…¨ç§»é™¤å·¥å…·åˆ—
                if (toolbar) toolbar.remove();
                
                // â˜…â˜…â˜… é—œéµä¿®æ­£ï¼šç§»é™¤ Sortable.js è…³æœ¬ â˜…â˜…â˜…
                // é€™æ¨£å®¢æˆ¶é–‹å•Ÿæª”æ¡ˆæ™‚ï¼Œæ‹–æ›³åŠŸèƒ½æ ¹æœ¬ä¸æœƒè¢«è¼‰å…¥ï¼Œå¾¹åº•é˜²æ­¢æ‰‹æ©Ÿèª¤è§¸ç§»å‹•
                const sortableScript = newDoc.querySelector('script[src*="Sortable"]');
                if (sortableScript) sortableScript.remove();
            } else {
                // ç®¡ç†å“¡å­˜æª”ï¼šéš±è—é€²éšæŒ‰éˆ•
                ['#save-btn', '#source-btn', '#client-save-btn'].forEach(sel => {
                    const el = newDoc.querySelector(sel);
                    if(el) el.classList.add('hidden-btn');
                });
            }

            // 4. é‡ç½® Overlay (ç¢ºä¿å­˜æª”å¾Œé–‹å•Ÿæ˜¯é–ä½çš„)
            const overlay = newDoc.querySelector('#security-overlay');
            if(overlay) {
                overlay.style.display = 'flex';
                overlay.style.opacity = '1';
            }
            const pwdInput = newDoc.querySelector('#sys-pwd');
            if(pwdInput) pwdInput.value = '';
            const errMsg = newDoc.querySelector('#err-msg');
            if(errMsg) errMsg.innerText = '';
            
            const unlockArea = newDoc.querySelector('#unlock-area');
            if(unlockArea) unlockArea.style.display = 'none'; // é‡ç½®è§£é–å€

            // 5. å¯«å…¥è³‡æ–™
            const jsonStr = JSON.stringify(pageData, null, 4);
            let htmlContent = newDoc.outerHTML;
            htmlContent = htmlContent.replace(/let pageData = \{([\s\S]*?)\};/, function() {
                return `let pageData = ${jsonStr};`;
            });

            // ä¸‹è¼‰
            const blob = new Blob([`<!DOCTYPE html>\n${htmlContent}`], {type: 'text/html'});
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = fileName;
            a.click();
        }
    </script>

</body></html>