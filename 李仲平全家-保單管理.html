<!DOCTYPE html>
<html lang="zh-TW"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æä»²å¹³å…¨å®¶-ä¿å–®ç®¡ç†</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    <style>
        /* =========================================
           1. æ ¸å¿ƒè‰²å½©èˆ‡ç³»çµ±è®Šæ•¸
           ========================================= */
        :root {
            --bg-deep: #24355A;
            --bg-modal: #FFFFFF;
            --text-dark: #1F2937;
            --text-white: #FFFFFF;
            --radius-card: 24px;
            --radius-btn: 18px;
            --shadow-card: 0 8px 16px rgba(0,0,0,0.08);
            --shadow-hover: 0 20px 30px rgba(0,0,0,0.15);
            --transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        body {
            font-family: "Microsoft JhengHei", "å¾®è»Ÿæ­£é»‘é«”", sans-serif;
            background-color: var(--bg-deep);
            color: var(--text-dark);
            margin: 0;
            padding: 0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            overflow-x: hidden;
            -webkit-tap-highlight-color: transparent;
        }

        /* é é¦– */
        header {
            padding: 20px 5%;
            display: flex;
            justify-content: center;
            align-items: center;
            background: rgba(0,0,0,0.15);
            backdrop-filter: blur(5px);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        header h1 { color: white; margin: 0; font-size: 1.6rem; letter-spacing: 1px; font-weight: 800; text-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        
        /* æ‡¸æµ®æ§åˆ¶åˆ— */
        .floating-toolbar {
            position: fixed; bottom: 30px; right: 30px; z-index: 9999;
            display: flex; flex-direction: column-reverse; /* è®“ç·¨è¼¯éˆ•åœ¨æœ€ä¸‹æ–¹ */
            gap: 15px; pointer-events: none;
            align-items: flex-end; /* é å³å°é½Š */
        }

        .admin-btn {
            background: rgba(255, 255, 255, 0.9);
            color: var(--bg-deep);
            border: 1px solid rgba(0,0,0,0.1);
            width: 60px; height: 60px; /* åœ“å½¢æŒ‰éˆ• */
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            font-weight: bold;
            font-size: 1.5rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            pointer-events: auto;
            backdrop-filter: blur(5px);
        }

        /* é•·æ¢å½¢æŒ‰éˆ• */
        .admin-btn.wide-btn {
            width: auto;
            min-width: 140px;
            height: 50px;
            border-radius: 50px;
            font-size: 1rem;
            padding: 0 20px;
            gap: 8px;
        }

        /* éš±è—ç‹€æ…‹ */
        .hidden-btn {
            opacity: 0;
            transform: translateY(20px) scale(0.8);
            pointer-events: none;
            position: absolute; 
        }

        /* é¡¯ç¤ºç‹€æ…‹ */
        .admin-btn:not(.hidden-btn) {
            opacity: 1;
            transform: translateY(0) scale(1);
            position: relative;
        }

        .admin-btn:hover {
            transform: translateY(-5px) scale(1.1);
            background: white;
            box-shadow: 0 8px 25px rgba(0,0,0,0.4);
        }

        /* ç·¨è¼¯æ¨¡å¼å•Ÿå‹•æ¨£å¼ */
        #edit-toggle-btn.edit-mode-active {
            background: #FF6B6B;
            color: white;
            border-color: #FF6B6B;
            transform: rotate(360deg);
            box-shadow: 0 0 20px rgba(255, 107, 107, 0.6);
        }

        .save-btn { background: #46B3E6; color: white; }
        .client-save-btn { background: #2ED573; color: white; } /* å®¢æˆ¶å­˜æª”æŒ‰éˆ•é¡è‰² */

        /* =========================================
           2. å‹•ç•«å®šç¾©
           ========================================= */
        @keyframes breathe { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.08); } }
        
        /* Level 1 Hover */
        @keyframes rubberBand { 
            0% { transform: scale(1); } 30% { transform: scale(1.15, 0.85); } 
            40% { transform: scale(0.9, 1.1); } 50% { transform: scale(1.05, 0.95); } 
            65% { transform: scale(0.98, 1.02); } 75% { transform: scale(1.02, 0.98); } 
            100% { transform: scale(1.1); } 
        }
        
        /* Level 2 Hover */
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-12px); } }
        
        /* Level 3 Hover */
        @keyframes swing { 20% { transform: rotate(15deg); } 40% { transform: rotate(-10deg); } 60% { transform: rotate(5deg); } 80% { transform: rotate(-5deg); } 100% { transform: rotate(0deg); } }
        
        /* ç·¨è¼¯æ¨¡å¼æ™ƒå‹• */
        @keyframes shake { 0% { transform: rotate(0deg); } 25% { transform: rotate(1deg); } 50% { transform: rotate(0deg); } 75% { transform: rotate(-1deg); } 100% { transform: rotate(0deg); } }
        
        /* ç·¨è¼¯æ¨¡å¼æ¨£å¼ */
        .edit-mode .main-card, .edit-mode .sub-btn, .edit-mode .link-card {
            animation: shake 0.3s infinite linear !important; 
            cursor: grab !important; 
            user-select: none;
            opacity: 1 !important; 
            transform: none !important;
        }
        .edit-mode .main-card:active, .edit-mode .sub-btn:active, .edit-mode .link-card:active {
            cursor: grabbing !important; transform: scale(1.05) !important;
        }

        /* =========================================
           3. UI å…ƒä»¶
           ========================================= */
        .main-container { flex: 1; padding: 40px 5%; display: flex; flex-direction: column; align-items: center; }
        .grid-level-1 { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 30px; width: 100%; max-width: 1400px; margin-bottom: 30px; }

        .main-card {
            border-radius: var(--radius-card); padding: 30px 25px; cursor: pointer; position: relative; overflow: visible;
            min-height: 220px; display: flex; flex-direction: column; justify-content: space-between;
            color: white; box-shadow: var(--shadow-card); border: none; transition: transform 0.3s ease;
        }
        .main-card .icon-large { font-size: 4.5rem; margin-bottom: 10px; filter: drop-shadow(0 4px 6px rgba(0,0,0,0.2)); display: inline-block; animation: breathe 3s infinite ease-in-out; }
        .main-card h2 { font-size: 1.6rem; margin: 0; font-weight: 800; line-height: 1.2; text-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .main-card p { opacity: 0.95; margin-top: 5px; font-size: 1rem; font-weight: 600; }
        .deco-circle { position: absolute; top: -50px; right: -50px; width: 180px; height: 180px; background: rgba(255,255,255,0.15); border-radius: 50%; pointer-events: none; overflow: hidden; }

        /* Modal */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.7); backdrop-filter: blur(8px); z-index: 1000; opacity: 0; visibility: hidden; display: flex; justify-content: center; align-items: center; transition: opacity 0.3s; }
        .modal-overlay.active { opacity: 1; visibility: visible; }
        .modal-content { background: var(--bg-modal); width: 95%; max-width: 1200px; height: 90vh; border-radius: var(--radius-card); display: flex; flex-direction: column; box-shadow: 0 25px 60px rgba(0,0,0,0.5); transform: scale(0.9); opacity: 0; transition: var(--transition); overflow: hidden; }
        .modal-overlay.active .modal-content { transform: scale(1); opacity: 1; }
        .modal-header { padding: 20px 25px; background: white; border-bottom: 2px solid #f0f0f0; display: flex; justify-content: space-between; align-items: center; }
        .modal-title { font-size: 1.4rem; font-weight: 800; display: flex; align-items: center; gap: 10px; color: var(--bg-deep); }
        .close-btn { background: #f3f4f6; border: none; width: 40px; height: 40px; border-radius: 50%; font-size: 1.5rem; cursor: pointer; transition: 0.2s; color: #666; display: flex; align-items: center; justify-content: center; }
        .modal-body { flex: 1; padding: 25px; overflow-y: auto; background-color: #FAFAFA; -webkit-overflow-scrolling: touch; }

        /* Level 2 & 3 */
        .level-2-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .sub-btn { border-radius: var(--radius-btn); padding: 25px 15px; text-align: center; cursor: pointer; transition: transform 0.2s; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 140px; box-shadow: 0 8px 20px rgba(0,0,0,0.15); color: white; position: relative; overflow: visible; border: 2px solid rgba(255,255,255,0.2); }
        .sub-btn.active { box-shadow: inset 0 0 0 5px rgba(255,255,255,0.6); transform: scale(0.98); }
        .sub-btn .emoji { font-size: 3.5rem; margin-bottom: 10px; display: inline-block; filter: drop-shadow(0 4px 4px rgba(0,0,0,0.1)); animation: breathe 3s infinite ease-in-out; }
        .sub-btn .text { font-size: 1.2rem; font-weight: 800; letter-spacing: 0.5px; text-shadow: 0 1px 2px rgba(0,0,0,0.1); }

        .level-3-section { display: none; border-top: 3px dashed #ddd; padding-top: 30px; animation: fadeIn 0.5s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .section-title { font-size: 1.3rem; margin-bottom: 20px; color: var(--bg-deep); font-weight: 800; display: flex; align-items: center; gap: 10px; }
        .level-3-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; margin-bottom: 30px;}
        
        @keyframes slideInUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
        
        .link-card { 
            border-radius: var(--radius-btn); padding: 20px; display: flex; align-items: center; 
            text-decoration: none; color: var(--text-dark); box-shadow: var(--shadow-card); 
            border: 1px solid rgba(0,0,0,0.05); 
            opacity: 0; animation: slideInUp 0.5s cubic-bezier(0.2, 0.8, 0.2, 1) forwards; 
            transition: transform 0.3s ease; position: relative; overflow: visible; 
        }
        
        .link-card .card-icon { font-size: 2.2rem; margin-right: 15px; width: 55px; height: 55px; background: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; box-shadow: 0 4px 8px rgba(0,0,0,0.05); animation: breathe 3s infinite ease-in-out; }
        .link-card strong { display: block; font-size: 1.1rem; margin-bottom: 5px; color: #000; font-weight: 800; }
        .link-card span { font-size: 0.95rem; color: #444; line-height: 1.4; font-weight: 500; }
        .link-card.highlight { border: 3px solid rgba(0,0,0,0.1); }

        /* æŒ‰éˆ•ç¾¤çµ„ */
        .btn-overlay { position: absolute; top: -12px; display: none; gap: 5px; z-index: 20; }
        .btn-overlay.right { right: -10px; }
        .mini-btn { width: 32px; height: 32px; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 16px; cursor: pointer; box-shadow: 0 2px 5px rgba(0,0,0,0.3); border: 2px solid white; transition: transform 0.2s; }
        .delete-btn { background: #FF4757; color: white; }
        .edit-btn { background: #2ED573; color: white; }
        .edit-mode .btn-overlay { display: flex; animation: none !important; }
        .mini-btn:hover { transform: scale(1.15); }

        /* æ–°å¢é …ç›®æŒ‰éˆ• */
        .add-new-btn { background: rgba(0,0,0,0.05); border: 2px dashed #ccc; border-radius: var(--radius-card); display: flex; align-items: center; justify-content: center; color: #777; font-weight: bold; cursor: pointer; transition: 0.2s; min-height: 100px; }
        .add-new-btn:hover { background: rgba(0,0,0,0.1); color: #333; border-color: #999; }
        .add-new-btn.level-1 { min-height: 220px; font-size: 1.5rem; }
        .add-new-btn.level-2 { height: 140px; font-size: 1.2rem; }
        .add-new-btn.level-3 { min-height: 100px; font-size: 1rem; }

        /* è¡¨å–® Modal */
        #form-modal .modal-content { max-width: 500px; height: auto; max-height: 90vh; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: bold; color: #333; }
        .form-group input, .form-group textarea, .form-group select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; font-size: 1rem; box-sizing: border-box; }
        .form-actions { display: flex; justify-content: flex-end; gap: 10px; margin-top: 20px; }
        .btn-confirm { background: #46B3E6; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: bold; }
        .btn-cancel { background: #eee; color: #333; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; }

        /* Hover & Mobile */
        @media (hover: hover) {
            body:not(.edit-mode) .main-card:hover { transform: translateY(-10px); box-shadow: 0 25px 50px rgba(0,0,0,0.3); z-index: 5; }
            body:not(.edit-mode) .main-card:hover .icon-large { animation: rubberBand 0.8s ease-out; } 
            body:not(.edit-mode) .sub-btn:hover { transform: translateY(-8px); box-shadow: 0 20px 40px rgba(0,0,0,0.2); filter: brightness(1.1); }
            body:not(.edit-mode) .sub-btn:hover .emoji { animation: bounce 0.6s ease infinite; }
            body:not(.edit-mode) .link-card:hover { transform: translateY(-5px); box-shadow: var(--shadow-hover); filter: brightness(0.98); }
        }
        @media (max-width: 768px) {
            .grid-level-1, .level-3-grid { grid-template-columns: 1fr; }
            .sub-btn { height: 100px; flex-direction: row; justify-content: flex-start; gap: 20px; padding: 15px 25px; text-align: left; }
            .sub-btn .emoji { font-size: 2.5rem; margin-bottom: 0; }
            .floating-toolbar { bottom: 20px; right: 20px; gap: 12px; }
            .admin-btn { width: 50px; height: 50px; font-size: 1.2rem; }
            .admin-btn.wide-btn { height: 45px; min-width: 120px; }
        }
        
        .sortable-ghost { opacity: 0.4; background: #eee !important; border: 2px dashed #999; }
        .sortable-drag { opacity: 1; transform: scale(1.05); box-shadow: 0 20px 40px rgba(0,0,0,0.3); }
        
        #editor-modal .modal-content { height: 70vh; max-width: 800px; }
        #json-editor { width: 100%; height: 100%; padding: 20px; font-family: monospace; border: none; resize: none; background: #f8f9fa; font-size: 14px; }
    </style>
</head>
<body class="">

    <header>
        <h1>ğŸ›¡ï¸ æä»²å¹³å…¨å®¶-ä¿å–®ç®¡ç†</h1>
    </header>

    <div class="floating-toolbar" style="display: none;">
        <button class="admin-btn wide-btn client-save-btn" id="client-save-btn" onclick="saveAsClient()">ğŸ“¤ å¦å­˜å®¢æˆ¶æª”</button>
        <button class="admin-btn wide-btn save-btn" id="save-btn" onclick="saveAndDownload()">ğŸ’¾ å„²å­˜æ–°æª”</button>
        <button class="admin-btn wide-btn" id="source-btn" onclick="openEditor()">âš™ï¸ åŸå§‹ç¢¼</button>
        <button class="admin-btn" id="edit-toggle-btn" onclick="toggleEditMode()" title="åˆ‡æ›ç·¨è¼¯æ¨¡å¼">ğŸ”§</button>
    </div>

    <div class="main-container">
        <div id="level-1-grid" class="grid-level-1"><div class="main-card" data-id="0" style="background-color: rgb(232, 106, 146);">
                    <div class="deco-circle"></div>
                    <div class="icon-large">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦</div>
                    <div>
                        <h2>å®¶åº­æˆå“¡åŠä¿å–®å„é …å¥æª¢åˆ†æ</h2>
                        <p>æ•´åˆå…¨å®¶èªéŸ³åˆ†æã€æ ¡æ­£å ±å‘Šèˆ‡å€‹äººä¿å–®è©³æƒ…</p>
                    </div>
                <div class="btn-overlay right">
                    <div class="mini-btn edit-btn" onclick="openEditForm(event, 'level1', [0])">âœ</div>
                    <div class="mini-btn delete-btn" onclick="deleteCategory(event, 0)">âœ•</div>
                </div></div><div class="main-card" data-id="1" style="background-color: rgb(99, 102, 241);">
                    <div class="deco-circle"></div>
                    <div class="icon-large">ğŸ’¹</div>
                    <div>
                        <h2>æŠ•è³‡å‹ä¿éšªå°ˆå€</h2>
                        <p>åŠ å€¼çµ¦ä»˜ã€åƒ¹å€¼åˆ†æèˆ‡BVAå ±è¡¨</p>
                    </div>
                <div class="btn-overlay right">
                    <div class="mini-btn edit-btn" onclick="openEditForm(event, 'level1', [1])">âœ</div>
                    <div class="mini-btn delete-btn" onclick="deleteCategory(event, 1)">âœ•</div>
                </div></div><div class="main-card" data-id="2" style="background-color: rgb(141, 114, 225);">
                    <div class="deco-circle"></div>
                    <div class="icon-large">ğŸ’°</div>
                    <div>
                        <h2>å…¨å®¶è³‡ç”¢çµ±è¨ˆ</h2>
                        <p>ä¿éšœã€åƒ¹å€¼ã€é‚„æœ¬é‡‘ä¸‰è¡¨åˆä¸€</p>
                    </div>
                <div class="btn-overlay right">
                    <div class="mini-btn edit-btn" onclick="openEditForm(event, 'level1', [2])">âœ</div>
                    <div class="mini-btn delete-btn" onclick="deleteCategory(event, 2)">âœ•</div>
                </div></div><div class="main-card" data-id="3" style="background-color: rgb(253, 185, 64);">
                    <div class="deco-circle"></div>
                    <div class="icon-large">ğŸ¦</div>
                    <div>
                        <h2>è²¡å¯Œç®¡ç†å°ˆå€</h2>
                        <p>ç¨…å‹™åˆ†æã€å‚³æ‰¿è¦åŠƒèˆ‡æŠ•è³‡</p>
                    </div>
                <div class="btn-overlay right">
                    <div class="mini-btn edit-btn" onclick="openEditForm(event, 'level1', [3])">âœ</div>
                    <div class="mini-btn delete-btn" onclick="deleteCategory(event, 3)">âœ•</div>
                </div></div><div class="main-card" data-id="4" style="background-color: rgb(240, 162, 97);">
                    <div class="deco-circle"></div>
                    <div class="icon-large">ğŸš—</div>
                    <div>
                        <h2>ç”¢ç‰©ä¿éšª</h2>
                        <p>æ±½æ©Ÿè»Šã€ä½å®…ç«éšªèˆ‡è²¬ä»»éšª</p>
                    </div>
                <div class="btn-overlay right">
                    <div class="mini-btn edit-btn" onclick="openEditForm(event, 'level1', [4])">âœ</div>
                    <div class="mini-btn delete-btn" onclick="deleteCategory(event, 4)">âœ•</div>
                </div></div><div class="main-card" data-id="5" style="background-color: rgb(90, 191, 154);">
                    <div class="deco-circle"></div>
                    <div class="icon-large">ğŸ¢</div>
                    <div>
                        <h2>ä¼æ¥­ä¿å–®å°ˆå€</h2>
                        <p>å­£é€šå¯¦æ¥­ã€ç™»å¾¡å¯¦æ¥­</p>
                    </div>
                <div class="btn-overlay right">
                    <div class="mini-btn edit-btn" onclick="openEditForm(event, 'level1', [5])">âœ</div>
                    <div class="mini-btn delete-btn" onclick="deleteCategory(event, 5)">âœ•</div>
                </div></div><div class="main-card" data-id="6" style="background-color: rgb(70, 179, 230);">
                    <div class="deco-circle"></div>
                    <div class="icon-large">ğŸ¤</div>
                    <div>
                        <h2>å”®å¾Œæœå‹™è³‡æº</h2>
                        <p>è¡¨å–®ä¸‹è¼‰èˆ‡è¯çµ¡è³‡è¨Š</p>
                    </div>
                <div class="btn-overlay right">
                    <div class="mini-btn edit-btn" onclick="openEditForm(event, 'level1', [6])">âœ</div>
                    <div class="mini-btn delete-btn" onclick="deleteCategory(event, 6)">âœ•</div>
                </div></div><div class="add-new-btn level-1">ï¼‹ æ–°å¢ä¸»åˆ†é¡</div></div>
    </div>

    <div id="view-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <div id="modal-title" class="modal-title"></div>
                <button class="close-btn" onclick="closeViewModal()">âœ•</button>
            </div>
            <div class="modal-body">
                <div id="level-2-container" class="level-2-grid"></div>
                <div id="level-3-section" class="level-3-section">
                    <div id="level-3-title" class="section-title"></div>
                    <div id="level-3-grid" class="level-3-grid"></div>
                </div>
            </div>
        </div>
    </div>

    <div id="form-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title" id="form-title">ç·¨è¼¯é …ç›®</div>
                <button class="close-btn" onclick="closeFormModal()">âœ•</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>æ¨™é¡Œ / åç¨±</label>
                    <input type="text" id="input-title" placeholder="è«‹è¼¸å…¥æ¨™é¡Œ">
                </div>
                <div class="form-group" id="group-desc">
                    <label>æè¿° / èªªæ˜</label>
                    <input type="text" id="input-desc" placeholder="è«‹è¼¸å…¥æè¿°">
                </div>
                <div class="form-group" id="group-url">
                    <label>é€£çµç¶²å€ (é¸å¡«)</label>
                    <input type="text" id="input-url" placeholder="https://... æˆ– ç›¸å°è·¯å¾‘">
                </div>
                <div class="form-group">
                    <label>åœ–ç¤º / Emoji (ç•™ç©ºå‰‡è‡ªå‹•ç”¢ç”Ÿ)</label>
                    <input type="text" id="input-icon" placeholder="ä¾‹å¦‚ï¼šğŸ“Š, ğŸ, æˆ–ç•™ç©º">
                </div>
                <div class="form-group" id="group-color">
                    <label>é¡è‰² (Level 1 ç”¨)</label>
                    <input type="color" id="input-color" value="#46B3E6">
                </div>
                <div class="form-actions">
                    <button class="btn-cancel" onclick="closeFormModal()">å–æ¶ˆ</button>
                    <button class="btn-confirm" id="form-submit-btn">ç¢ºèª</button>
                </div>
            </div>
        </div>
    </div>

    <div id="editor-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">âš™ï¸ ç·¨è¼¯ JSON è³‡æ–™</div>
                <button class="close-btn" onclick="closeEditor()">Ã—</button>
            </div>
            <div class="modal-body" style="padding:0;">
                <textarea id="json-editor"></textarea>
            </div>
            <div style="padding:20px; text-align:right; background:#f0f0f0;">
                <button class="admin-btn save-btn wide-btn" onclick="updateData()">æ›´æ–°ä¸¦é è¦½</button>
            </div>
        </div>
    </div>

    <script>
        // ==========================================
        // ğŸ¨ ç¹½ç´›è‰²å½©åº« & Emoji
        // ==========================================
        const colorPalette = [
            { main: "#FF6B6B", light: "#FFF0F0" }, { main: "#4ECDC4", light: "#E0F7FA" }, 
            { main: "#F9C74F", light: "#FFFDE7" }, { main: "#1A535C", light: "#E0F2F1" }, 
            { main: "#9B5DE5", light: "#F3E5F5" }, { main: "#F15BB5", light: "#FCE4EC" }, 
            { main: "#00BBF9", light: "#E1F5FE" }, { main: "#00F5D4", light: "#E0F2F1" }, 
            { main: "#FB5607", light: "#FFF3E0" }, { main: "#8338EC", light: "#EDE7F6" }, 
            { main: "#3A86FF", light: "#E3F2FD" }, { main: "#FF006E", light: "#FFEBEE" }  
        ];
        const emojiLibrary = ["ğŸ“Š","ğŸ“‘","ğŸ“„","ğŸ—‚ï¸","ğŸ¤","ğŸ©¹","ğŸ“‰","ğŸ’¡","ğŸ¬","ğŸ—£ï¸","ğŸ”","ğŸ“‹","ğŸ¥","ğŸ’°","ğŸ¦","ğŸ’¸","ğŸ“ˆ","ğŸš—","ğŸ›µ","ğŸ˜ï¸","ğŸ§±","ğŸ“‚","ğŸŒ","ğŸ”—","ğŸ›¡ï¸","ğŸ’","ğŸ’µ","ğŸ§­","ğŸ‘µ","ğŸ‘¨","ğŸ‘©","ğŸ‘¦","ğŸ‘©â€ğŸ¦°","ğŸ—ï¸","ğŸ­","âœˆï¸","ğŸ’Š","ğŸ©º","ğŸ§¸","ğŸ","ğŸ“…","âœ…","â­","â¤ï¸","ğŸ”¥","ğŸš€","ğŸ§©","ğŸ¨","ğŸ†","ğŸ””"];
        function getRandomEmoji() { return emojiLibrary[Math.floor(Math.random() * emojiLibrary.length)]; }

        // ==========================================
        // ğŸ”§ è³‡æ–™æ ¸å¿ƒ (Page Data)
        // ==========================================
        let pageData = {
    "categories": [
        {
            "title": "å®¶åº­æˆå“¡åŠä¿å–®å„é …å¥æª¢åˆ†æ",
            "desc": "æ•´åˆå…¨å®¶èªéŸ³åˆ†æã€æ ¡æ­£å ±å‘Šèˆ‡å€‹äººä¿å–®è©³æƒ…",
            "icon": "ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦",
            "color": "#E86A92",
            "subCategories": [
                {
                    "name": "æç´ ç¢§",
                    "emoji": "ğŸ‘©â€ğŸ¦°",
                    "items": [
                        {
                            "title": "ä¿å–®æ ¡æ­£åœ–è¡¨åˆ†æ",
                            "desc": "è¦–è¦ºåŒ–ç¼ºå£åˆ†æ (HTMLç¶²é )",
                            "url": "ä¿å–®åœ–è¡¨åˆ†æ.html",
                            "icon": "ğŸ“Š",
                            "highlight": true
                        },
                        {
                            "title": "ä¿å–®æ ¡æ­£åˆ†æå ±å‘Š",
                            "desc": "è©³ç´°åˆ—è¡¨èˆ‡èªªæ˜ (HTMLç¶²é )",
                            "url": "ä¿å–®åˆ†æå ±å‘Š.html",
                            "icon": "ğŸ“‘",
                            "highlight": true
                        },
                        {
                            "title": "ä¿å–®æ ¡æ­£åˆ†æ(PDF)",
                            "desc": "å®Œæ•´å ±å‘Šæª”æ¡ˆ",
                            "url": "#",
                            "icon": "ğŸ“„"
                        },
                        {
                            "title": "æŠ•ä¿ç´€éŒ„",
                            "desc": "Evernote",
                            "url": "https://share.evernote.com/note/aa3a988f-c735-4f0a-95bf-705462d583b9",
                            "icon": "ğŸ—‚ï¸"
                        },
                        {
                            "title": "æœå‹™ç´€éŒ„",
                            "desc": "Evernote",
                            "url": "https://share.evernote.com/note/9bd4f569-c364-4e93-8b67-cb5202b5fa37",
                            "icon": "ğŸ¤"
                        },
                        {
                            "title": "ç†è³ ç´€éŒ„",
                            "desc": "Evernote",
                            "url": "https://share.evernote.com/note/954a6cba-b7cd-4993-8acc-09bcf00c14a9",
                            "icon": "ğŸ©¹"
                        },
                        {
                            "title": "å—å±±æ ¡æ­£è¡¨",
                            "desc": "PDFæ–‡ä»¶",
                            "url": "å—å±±æ ¡æ­£è¡¨.pdf",
                            "icon": "ğŸ“‰"
                        },
                        {
                            "title": "è£œå¼·å»ºè­°",
                            "desc": "PDFæ–‡ä»¶",
                            "url": "è£œå¼·å»ºè­°.pdf",
                            "icon": "ğŸ’¡"
                        },
                        {
                            "title": "ä¿å–®å¥æª¢åˆ†æ(å½±éŸ³)",
                            "desc": "å€‹äººåˆ†æå½±éŸ³",
                            "url": "ä¿å–®å¥æª¢åˆ†æ.mp4",
                            "icon": "ğŸ¬"
                        }
                    ]
                },
                {
                    "name": "æéº—ç´",
                    "emoji": "ğŸ‘©",
                    "items": [
                        {
                            "title": "å€‹äººèªéŸ³åˆ†æ",
                            "desc": "å°ˆå±¬ä¿å–®è§£èªª",
                            "url": "https://drive.google.com/file/d/1ePhQ-1JX9qf9sJQhcN-I2kkguYzMu9Bw/view?usp=drive_link",
                            "icon": "ğŸ—£ï¸",
                            "highlight": true
                        },
                        {
                            "title": "å€‹äººä¿å–®åˆ†æ",
                            "desc": "è©³ç´°æ¢æ¬¾æ ¡æ­£",
                            "url": "#",
                            "icon": "ğŸ”",
                            "highlight": true
                        },
                        {
                            "title": "å—å±±ä¿å–®æ ¡æ­£",
                            "desc": "å—å±±äººå£½å°ˆå±¬",
                            "url": "https://drive.google.com/file/d/1ET2kY7CQG8CfW83JNpx1L5uEXc_nb36X/view?usp=drive_link",
                            "icon": "ğŸ“‹"
                        },
                        {
                            "title": "æŠ•ä¿ç´€éŒ„",
                            "desc": "Evernote",
                            "url": "https://share.evernote.com/note/cd391a19-ccdf-4587-9191-61dae59c03f9",
                            "icon": "ğŸ—‚ï¸"
                        },
                        {
                            "title": "æœå‹™ç´€éŒ„",
                            "desc": "Evernote",
                            "url": "https://share.evernote.com/note/139b0871-e4cd-4d81-9a6c-627a7550dd2d",
                            "icon": "ğŸ¤"
                        },
                        {
                            "title": "ç†è³ ç´€éŒ„",
                            "desc": "Evernote",
                            "url": "https://share.evernote.com/note/3f8f5f00-6c10-43ba-8ee4-22a3f8347574",
                            "icon": "ğŸ©¹"
                        }
                    ]
                },
                {
                    "name": "å³é€²è²¡",
                    "emoji": "ğŸ‘¨",
                    "items": [
                        {
                            "title": "å€‹äººèªéŸ³åˆ†æ",
                            "desc": "å°ˆå±¬ä¿å–®è§£èªª",
                            "url": "https://drive.google.com/file/d/1ioya4qOrhGwIHytNb_FOaKhtquGZnu51/view?usp=drive_link",
                            "icon": "ğŸ—£ï¸",
                            "highlight": true
                        },
                        {
                            "title": "å€‹äººä¿å–®åˆ†æ",
                            "desc": "è©³ç´°æ¢æ¬¾æ ¡æ­£",
                            "url": "https://drive.google.com/file/d/1aVURO8DNYEqqZizVIetULev93qPTc6YY/view?usp=drive_link",
                            "icon": "ğŸ”",
                            "highlight": true
                        },
                        {
                            "title": "å—å±±ä¿å–®æ ¡æ­£",
                            "desc": "å—å±±äººå£½å°ˆå±¬",
                            "url": "https://drive.google.com/file/d/1R_w8pjFBBNv5dzqZ2DUilDvRTDBBYMn1/view?usp=drive_link",
                            "icon": "ğŸ“‹"
                        },
                        {
                            "title": "æŠ•ä¿ç´€éŒ„",
                            "desc": "Nanshan",
                            "url": "https://share.evernote.com/note/0f59487e-3cc3-4193-9db2-12e6def63aa0",
                            "icon": "ğŸ—‚ï¸"
                        },
                        {
                            "title": "æœå‹™ç´€éŒ„",
                            "desc": "Evernote",
                            "url": "https://share.evernote.com/note/bd60b2d5-5fec-483d-9294-f9bcb1ba336e",
                            "icon": "ğŸ¤"
                        },
                        {
                            "title": "ç†è³ ç´€éŒ„",
                            "desc": "Evernote",
                            "url": "https://share.evernote.com/note/e9e822bf-803a-48cf-80cb-6bac4b429a23",
                            "icon": "ğŸ©¹"
                        }
                    ]
                },
                {
                    "name": "å³éœ½èˆª",
                    "emoji": "ğŸ‘¦",
                    "items": [
                        {
                            "title": "å€‹äººèªéŸ³åˆ†æ",
                            "desc": "å°ˆå±¬ä¿å–®è§£èªª",
                            "url": "https://drive.google.com/file/d/1sVTAcEmax7YyWJJvqJuJ7VzrS5OLC1Bk/view?usp=drive_link",
                            "icon": "ğŸ—£ï¸",
                            "highlight": true
                        },
                        {
                            "title": "å€‹äººä¿å–®åˆ†æ",
                            "desc": "è©³ç´°æ¢æ¬¾æ ¡æ­£",
                            "url": "https://drive.google.com/file/d/1HsDnUmOdntk6t-F29rI45dOBIUcwnvTd/view?usp=drive_link",
                            "icon": "ğŸ”",
                            "highlight": true
                        },
                        {
                            "title": "å—å±±ä¿å–®æ ¡æ­£",
                            "desc": "å—å±±äººå£½å°ˆå±¬",
                            "url": "https://drive.google.com/file/d/1mFfHrGi1KroGHdYlqA8vPpNDI1D0VTLl/view?usp=drive_link",
                            "icon": "ğŸ“‹"
                        },
                        {
                            "title": "æŠ•ä¿ç´€éŒ„",
                            "desc": "Evernote",
                            "url": "https://share.evernote.com/note/1643c582-21a0-47be-a053-e24a1847686d",
                            "icon": "ğŸ—‚ï¸"
                        },
                        {
                            "title": "æœå‹™ç´€éŒ„",
                            "desc": "Evernote",
                            "url": "https://share.evernote.com/note/2d7f3cad-c1d2-4a23-be86-b4f713c73ae1",
                            "icon": "ğŸ¤"
                        },
                        {
                            "title": "ç†è³ ç´€éŒ„",
                            "desc": "Evernote",
                            "url": "https://share.evernote.com/note/2cec8ac0-0f5c-4ef1-a4f0-867ab318e22b",
                            "icon": "ğŸ©¹"
                        }
                    ]
                },
                {
                    "name": "æå¾ç´ ç",
                    "emoji": "ğŸ‘µ",
                    "items": [
                        {
                            "title": "æŠ•ä¿ç´€éŒ„",
                            "desc": "Evernote",
                            "url": "https://share.evernote.com/note/23430a1a-8ff5-4b3b-8352-61aed5567e2c",
                            "icon": "ğŸ—‚ï¸"
                        },
                        {
                            "title": "æœå‹™ç´€éŒ„",
                            "desc": "Evernote",
                            "url": "#",
                            "icon": "ğŸ¤"
                        },
                        {
                            "title": "ç†è³ ç´€éŒ„",
                            "desc": "Evernote",
                            "url": "#",
                            "icon": "ğŸ©¹"
                        }
                    ]
                }
            ]
        },
        {
            "title": "æŠ•è³‡å‹ä¿éšªå°ˆå€",
            "desc": "åŠ å€¼çµ¦ä»˜ã€åƒ¹å€¼åˆ†æèˆ‡BVAå ±è¡¨",
            "icon": "ğŸ’¹",
            "color": "#6366F1",
            "subCategories": [
                {
                    "name": "åˆ†æèˆ‡å ±è¡¨",
                    "emoji": "ğŸ“ˆ",
                    "items": [
                        {
                            "title": "èªéŸ³è§£èªª",
                            "desc": "åˆ†æå°è¦½",
                            "url": "https://drive.google.com/file/d/1ZLp1kj6cZj7DXrmwwNOJwKETfo5Y7OFd/view?usp=drive_link",
                            "icon": "ğŸ§"
                        },
                        {
                            "title": "æŠ•è³‡å‹ä¿å–®åˆ†æ",
                            "desc": "åŠ å€¼çµ¦ä»˜èˆ‡åƒ¹å€¼(PDF)",
                            "url": "https://drive.google.com/file/d/1e5V79mzGUd01i2iDFp_77ntB0786SGey/view?usp=drive_link",
                            "icon": "ğŸ“‘"
                        },
                        {
                            "title": "BVAå ±è¡¨",
                            "desc": "Evernote",
                            "url": "https://share.evernote.com/note/ecb649b3-54b9-482c-0de3-8baf19520f31",
                            "icon": "ğŸ“‰"
                        }
                    ]
                }
            ]
        },
        {
            "title": "å…¨å®¶è³‡ç”¢çµ±è¨ˆ",
            "desc": "ä¿éšœã€åƒ¹å€¼ã€é‚„æœ¬é‡‘ä¸‰è¡¨åˆä¸€",
            "icon": "ğŸ’°",
            "color": "#8D72E1",
            "subCategories": [
                {
                    "name": "ä¸‰å¤§çµ±è¨ˆè¡¨",
                    "emoji": "ğŸ“Š",
                    "items": [
                        {
                            "title": "å…¨å®¶ä¿éšœçµ±è¨ˆè¡¨",
                            "desc": "äººç”Ÿä¿è­‰é‡‘",
                            "url": "../å…¨å®¶ä¿éšœçµ±è¨ˆè¡¨/å…¨å®¶ä¿éšœçµ±è¨ˆè¡¨.html",
                            "icon": "ğŸ›¡ï¸"
                        },
                        {
                            "title": "å…¨å®¶ä¿å–®åƒ¹å€¼",
                            "desc": "å®¶åº­è³‡ç”¢",
                            "url": "../å…¨å®¶ä¿å–®åƒ¹å€¼çµ±è¨ˆè¡¨/å…¨å®¶ä¿å–®åƒ¹å€¼çµ±è¨ˆè¡¨.html",
                            "icon": "ğŸ’"
                        },
                        {
                            "title": "å…¨å®¶é‚„æœ¬é‡‘çµ±è¨ˆ",
                            "desc": "å®¶åº­ç¾é‡‘æµ",
                            "url": "../å…¨å®¶é‚„æœ¬é‡‘çµ±è¨ˆè¡¨/å…¨å®¶é‚„æœ¬é‡‘çµ±è¨ˆè¡¨.html",
                            "icon": "ğŸ’µ"
                        }
                    ]
                },
                {
                    "name": "ç³»çµ±å°èˆª",
                    "emoji": "ğŸ§­",
                    "items": [
                        {
                            "title": "å›ç³»çµ±é¦–é ",
                            "desc": "æéº—ç´å…¨å®¶é¦–é ",
                            "url": "file:///C:/Users/%E6%9D%8E%E4%BB%B2%E5%B9%B3/Desktop/%E6%88%91%E7%9A%84HTML%E7%B3%BB%E7%B5%B1/%E5%AE%A2%E6%88%B6%E7%AE%A1%E7%90%86/%E6%9D%8E%E9%BA%97%E7%90%B4%E5%85%A8%E5%AE%B6/%E6%9D%8E%E9%BA%97%E7%90%B4%E5%85%A8%E5%AE%B6%E9%A6%96%E9%A0%81.html",
                            "icon": "ğŸ”™"
                        }
                    ]
                }
            ]
        },
        {
            "title": "è²¡å¯Œç®¡ç†å°ˆå€",
            "desc": "ç¨…å‹™åˆ†æã€å‚³æ‰¿è¦åŠƒèˆ‡æŠ•è³‡",
            "icon": "ğŸ¦",
            "color": "#FDB940",
            "subCategories": [
                {
                    "name": "ç¨…å‹™èˆ‡å‚³æ‰¿",
                    "emoji": "âš–ï¸",
                    "items": [
                        {
                            "title": "è²¡å¯Œå‚³æ‰¿åˆ†æ",
                            "desc": "èªéŸ³ç‰ˆ",
                            "url": "https://drive.google.com/file/d/1oREACA7iiXogsUXFhpUlM2UEpxYOvFON/view?usp=sharing",
                            "icon": "ğŸ—£ï¸"
                        },
                        {
                            "title": "å…¨å®¶ç¨…å‹™åˆ†æ",
                            "desc": "PDF",
                            "url": "https://drive.google.com/file/d/1HP2e5SIP3uAcJm8Lyu5CE3RiHyuiqe6J/view?usp=drive_link",
                            "icon": "ğŸ§¾"
                        },
                        {
                            "title": "è³‡ç”¢ç¾é‡‘æµåˆ†æ",
                            "desc": "PDF",
                            "url": "https://drive.google.com/file/d/13ECn-fc1mnmH4i60fg6Wj8ypFES98Vwa/view?usp=drive_link",
                            "icon": "ğŸ’§"
                        }
                    ]
                }
            ]
        },
        {
            "title": "ç”¢ç‰©ä¿éšª",
            "desc": "æ±½æ©Ÿè»Šã€ä½å®…ç«éšªèˆ‡è²¬ä»»éšª",
            "icon": "ğŸš—",
            "color": "#F0A261",
            "subCategories": [
                {
                    "name": "è»Šè¼›ä¿éšª",
                    "emoji": "ğŸš˜",
                    "items": [
                        {
                            "title": "æ±½è»Šéšª-å­£é€šå¯¦æ¥­",
                            "desc": "7986-L8",
                            "url": "https://lite.evernote.com/note/659f5c0d-43b9-448c-a6c3-0370fcdd8c13",
                            "icon": "ğŸš™"
                        },
                        {
                            "title": "æ±½è»Šéšª-æéº—ç´",
                            "desc": "6986-YQ (ä¸™å¼)",
                            "url": "https://lite.evernote.com/note/158484e9-8c19-4fae-bfd9-95bcf031f763",
                            "icon": "ğŸš™"
                        },
                        {
                            "title": "æ±½è»Šéšª-æéº—ç´",
                            "desc": "BXM-9689 (ä¹™å¼)",
                            "url": "https://share.evernote.com/note/123d451e-90a4-cd6d-5d74-9e8cf2db7c10",
                            "icon": "ğŸš™"
                        },
                        {
                            "title": "æ©Ÿè»Šéšª-å³éœ½èˆª",
                            "desc": "MPM-9209",
                            "url": "https://lite.evernote.com/note/09e1263c-a93d-4017-a137-e8825bc553c2",
                            "icon": "ğŸ›µ"
                        },
                        {
                            "title": "æ©Ÿè»Šéšª-å³é€²è²¡",
                            "desc": "NAE-9689",
                            "url": "https://lite.evernote.com/note/65f9dbc9-788e-494c-a754-0bbb402c689d",
                            "icon": "ğŸ›µ"
                        },
                        {
                            "title": "æ±½è»Šéšªèªªæ˜æ›¸",
                            "desc": "æ•…äº‹æ›¸ç”¢ç”Ÿå™¨",
                            "url": "C:\\Users\\æä»²å¹³\\Desktop\\æˆ‘çš„HTMLç³»çµ±\\ç¨‹å¼-æ•…äº‹æ›¸ç”¢ç”Ÿå™¨\\æ±½è»Šä¿éšª\\å°ææ–°è»Šçš„å¥‡å¹»ä¹‹-æ•…äº‹\\car_insurance_storybook.html",
                            "icon": "ğŸ“–"
                        }
                    ]
                },
                {
                    "name": "ä½å®…ç«éšª",
                    "emoji": "ğŸ ",
                    "items": [
                        {
                            "title": "åŸºéš†æš–æš–335å··",
                            "desc": "å³é€²è²¡ (æ”¹å»ºä¸­)",
                            "url": "https://lite.evernote.com/note/10a77216-a590-40a1-94e5-9f7912bb48a3",
                            "icon": "ğŸ§±"
                        },
                        {
                            "title": "åŸºéš†æš–æš–è¡—495è™Ÿ",
                            "desc": "æéº—ç´",
                            "url": "https://lite.evernote.com/note/5b9e0fb2-6685-4509-9d98-b07622f92191",
                            "icon": "ğŸ¡"
                        },
                        {
                            "title": "åŸºéš†æš–æš–è¡—323è™Ÿ",
                            "desc": "å³é€²è²¡",
                            "url": "https://lite.evernote.com/note/91e326bd-08ea-741f-bcda-991e3ab78071",
                            "icon": "ğŸ¢"
                        }
                    ]
                },
                {
                    "name": "å—å±±ç”¢ç‰©ç¸½è¡¨",
                    "emoji": "ğŸ“‘",
                    "items": [
                        {
                            "title": "å—å±±ç”¢ç‰©ç¸½è¡¨",
                            "desc": "ç¸½è¦½",
                            "url": "#",
                            "icon": "ğŸ“‚"
                        }
                    ]
                }
            ]
        },
        {
            "title": "ä¼æ¥­ä¿å–®å°ˆå€",
            "desc": "å­£é€šå¯¦æ¥­ã€ç™»å¾¡å¯¦æ¥­",
            "icon": "ğŸ¢",
            "color": "#5ABF9A",
            "subCategories": [
                {
                    "name": "å­£é€šå¯¦æ¥­",
                    "emoji": "ğŸ—ï¸",
                    "items": [
                        {
                            "title": "æŠ•ä¿ç´€éŒ„",
                            "desc": "",
                            "url": "https://share.evernote.com/note/a4c99a9f-27b3-4ab6-9c3d-b80fc1adee97",
                            "icon": "ğŸ—‚ï¸"
                        }
                    ]
                }
            ]
        },
        {
            "title": "å”®å¾Œæœå‹™è³‡æº",
            "desc": "è¡¨å–®ä¸‹è¼‰èˆ‡è¯çµ¡è³‡è¨Š",
            "icon": "ğŸ¤",
            "color": "#46B3E6",
            "url": "å”®å¾Œæœå‹™è³‡æº-é›»è…¦ç‰ˆ/index.html.html",
            "subCategories": []
        }
    ]
};

        // ==========================================
        // ğŸ”§ ç·¨è¼¯æ¨¡å¼èˆ‡ç‹€æ…‹
        // ==========================================
        let isEditMode = false;
        let currentModalCatIndex = -1;
        let currentModalSubIndex = -1;
        let editTarget = null; 

        // ==========================================
        // ğŸš€ UI æ¸²æŸ“é‚è¼¯
        // ==========================================
        const mainGrid = document.getElementById('level-1-grid');
        const viewModal = document.getElementById('view-modal');
        const modalTitle = document.getElementById('modal-title');
        const level2Container = document.getElementById('level-2-container');
        const level3Section = document.getElementById('level-3-section');
        const level3Title = document.getElementById('level-3-title');
        const level3Grid = document.getElementById('level-3-grid');
        const editToggleBtn = document.getElementById('edit-toggle-btn');
        const sourceBtn = document.getElementById('source-btn');
        const saveBtn = document.getElementById('save-btn');
        const clientSaveBtn = document.getElementById('client-save-btn'); // æ–°å¢

        // Form Modal Elements
        const formModal = document.getElementById('form-modal');
        const formTitle = document.getElementById('form-title');
        const inputTitle = document.getElementById('input-title');
        const inputDesc = document.getElementById('input-desc');
        const inputUrl = document.getElementById('input-url');
        const inputIcon = document.getElementById('input-icon');
        const inputColor = document.getElementById('input-color');
        const formSubmitBtn = document.getElementById('form-submit-btn');
        const groupDesc = document.getElementById('group-desc');
        const groupUrl = document.getElementById('group-url');
        const groupColor = document.getElementById('group-color');

        function init() {
            renderLevel1();
            initLevel1Sortable();
        }

        // Toggle Edit Mode
        function toggleEditMode() {
            isEditMode = !isEditMode;
            document.body.classList.toggle('edit-mode', isEditMode);
            editToggleBtn.classList.toggle('edit-mode-active', isEditMode);
            editToggleBtn.innerHTML = isEditMode ? 'âœ…' : 'ğŸ”§';
            
            // Toggle visibility of hidden buttons
            if (isEditMode) {
                sourceBtn.classList.remove('hidden-btn');
                saveBtn.classList.remove('hidden-btn');
                clientSaveBtn.classList.remove('hidden-btn'); // é¡¯ç¤ºå®¢æˆ¶å­˜æª”æŒ‰éˆ•
            } else {
                sourceBtn.classList.add('hidden-btn');
                saveBtn.classList.add('hidden-btn');
                clientSaveBtn.classList.add('hidden-btn'); // éš±è—å®¢æˆ¶å­˜æª”æŒ‰éˆ•
            }

            renderLevel1();
            if (viewModal.classList.contains('active')) {
                openModal(currentModalCatIndex, true); 
            }
        }

        // æ¸²æŸ“ Level 1 (ä¸»é¸å–®)
        function renderLevel1() {
            mainGrid.innerHTML = '';
            pageData.categories.forEach((cat, index) => {
                const card = document.createElement('div');
                card.className = 'main-card';
                card.style.backgroundColor = cat.color;
                card.setAttribute('data-id', index);
                
                // ç·¨è¼¯æŒ‰éˆ•ç¾¤
                const overlay = document.createElement('div');
                overlay.className = 'btn-overlay right';
                overlay.innerHTML = `
                    <div class="mini-btn edit-btn" onclick="openEditForm(event, 'level1', [${index}])">âœ</div>
                    <div class="mini-btn delete-btn" onclick="deleteCategory(event, ${index})">âœ•</div>
                `;
                
                card.innerHTML = `
                    <div class="deco-circle"></div>
                    <div class="icon-large">${cat.icon}</div>
                    <div>
                        <h2>${cat.title}</h2>
                        <p>${cat.desc}</p>
                    </div>
                `;
                card.appendChild(overlay);

                // åœ¨ç·¨è¼¯æ¨¡å¼ä¸‹ï¼Œä¸€å¾‹é–‹å•Ÿè¨­å®šè¦–çª—æˆ–Modalï¼Œæ–¹ä¾¿ç·¨è¼¯å­é …ç›®æˆ–ä¿®æ”¹é€£çµ
                if (isEditMode) {
                    // å¦‚æœæœ‰ URL (Level 1 ç›´æ¥é€£çµ)ï¼Œå‰‡æ‰“é–‹ç·¨è¼¯è¡¨å–®
                    if(cat.url) {
                        card.onclick = (e) => openEditForm(e, 'level1', [index]);
                    } else {
                        card.onclick = () => openModal(index);
                    }
                } else {
                    if (cat.url) {
                        card.onclick = () => window.location.href = cat.url;
                    } else {
                        card.onclick = () => openModal(index);
                    }
                }
                
                mainGrid.appendChild(card);
            });

            // æ–°å¢æŒ‰éˆ• (åƒ…ç·¨è¼¯æ¨¡å¼)
            if(isEditMode) {
                const addBtn = document.createElement('div');
                addBtn.className = 'add-new-btn level-1';
                addBtn.innerHTML = 'ï¼‹ æ–°å¢ä¸»åˆ†é¡';
                addBtn.onclick = () => openAddForm('level1');
                mainGrid.appendChild(addBtn);
            }
        }

        function initLevel1Sortable() {
            if(typeof Sortable === 'undefined') return; // é˜²å‘†
            try {
                new Sortable(mainGrid, {
                    animation: 150,
                    ghostClass: 'sortable-ghost',
                    dragClass: 'sortable-drag',
                    disabled: false,
                    filter: '.add-new-btn',
                    onMove: function (evt) { return !evt.related.classList.contains('add-new-btn'); },
                    onEnd: function (evt) {
                        if(evt.newIndex >= pageData.categories.length) return; 
                        const movedItem = pageData.categories.splice(evt.oldIndex, 1)[0];
                        pageData.categories.splice(evt.newIndex, 0, movedItem);
                    }
                });
            } catch(e) { console.warn("L1 Sortable init failed", e); }
        }

        // é–‹å•Ÿ Modal (Level 2)
        function openModal(catIndex, restoreLevel3 = false) {
            currentModalCatIndex = catIndex;
            const category = pageData.categories[catIndex];
            if(!category) return;

            modalTitle.innerHTML = `<span style="margin-right:15px; font-size: 2rem;">${category.icon}</span> ${category.title}`;
            modalTitle.style.color = category.color;
            
            level2Container.innerHTML = '';
            
            // å¦‚æœä¸æ˜¯æ¢å¾©æ¨¡å¼ï¼Œå‰‡é‡ç½®ç¬¬3å±¤
            if(!restoreLevel3) {
                level3Section.style.display = 'none'; 
                level3Grid.innerHTML = '';
                currentModalSubIndex = -1;
            }

            if(category.subCategories) {
                category.subCategories.forEach((sub, subIndex) => {
                    const btn = document.createElement('div');
                    btn.className = 'sub-btn';
                    btn.setAttribute('data-id', subIndex);
                    if(currentModalSubIndex === subIndex) btn.classList.add('active'); 
                    
                    const overlay = document.createElement('div');
                    overlay.className = 'btn-overlay right';
                    overlay.innerHTML = `
                        <div class="mini-btn edit-btn" onclick="openEditForm(event, 'level2', [${catIndex}, ${subIndex}])">âœ</div>
                        <div class="mini-btn delete-btn" onclick="deleteSubCategory(event, ${catIndex}, ${subIndex})">âœ•</div>
                    `;

                    const colorObj = colorPalette[subIndex % colorPalette.length];
                    btn.style.setProperty('background-color', colorObj.main, 'important');
                    
                    btn.innerHTML = `
                        <div class="emoji">${sub.emoji}</div>
                        <div class="text">${sub.name}</div>
                    `;
                    btn.appendChild(overlay);

                    btn.onclick = () => {
                        document.querySelectorAll('.sub-btn').forEach(b => b.classList.remove('active'));
                        btn.classList.add('active');
                        renderLevel3(sub, colorObj, subIndex);
                    };
                    
                    level2Container.appendChild(btn);
                });
            }

            if(isEditMode) {
                const addBtn = document.createElement('div');
                addBtn.className = 'add-new-btn level-2';
                addBtn.innerHTML = 'ï¼‹ æ–°å¢å­åˆ†é¡';
                addBtn.onclick = () => openAddForm('level2');
                level2Container.appendChild(addBtn);
            }

            // ===============================================
            // ä¿®æ­£é‡é»ï¼šå„ªå…ˆé–‹å•Ÿè¦–çª—ï¼Œå†å˜—è©¦åˆå§‹åŒ–æ’åº
            // ===============================================
            viewModal.classList.add('active');

            // åˆå§‹åŒ–æ’åº (åŒ…å«éŒ¯èª¤è™•ç†)
            try {
                if(window.level2Sortable) window.level2Sortable.destroy();
                if(typeof Sortable !== 'undefined') {
                    window.level2Sortable = new Sortable(level2Container, {
                        animation: 150,
                        ghostClass: 'sortable-ghost',
                        filter: '.add-new-btn',
                        onMove: function (evt) { return !evt.related.classList.contains('add-new-btn'); },
                        onEnd: function (evt) {
                            const category = pageData.categories[currentModalCatIndex];
                            const movedItem = category.subCategories.splice(evt.oldIndex, 1)[0];
                            category.subCategories.splice(evt.newIndex, 0, movedItem);
                        }
                    });
                }
            } catch(e) {
                console.warn("Level 2 Sortable init failed:", e);
            }

            if(restoreLevel3 && currentModalSubIndex !== -1 && category.subCategories) {
                const subCat = category.subCategories[currentModalSubIndex];
                const colorObj = colorPalette[currentModalSubIndex % colorPalette.length];
                renderLevel3(subCat, colorObj, currentModalSubIndex);
            }
        }

        function renderLevel3(subCategory, parentColorObj, subIndex) {
            currentModalSubIndex = subIndex;
            level3Section.style.display = 'block';
            level3Title.innerHTML = `<span style="font-size:1.5rem;">${subCategory.emoji}</span> ${subCategory.name} - è©³ç´°è³‡æ–™`;
            level3Title.style.color = parentColorObj.main; 
            level3Grid.innerHTML = '';

            if(subCategory.items) {
                subCategory.items.forEach((item, index) => {
                    const card = document.createElement('a');
                    card.className = `link-card ${item.highlight ? 'highlight' : ''}`;
                    card.setAttribute('data-id', index);
                    
                    const overlay = document.createElement('div');
                    overlay.className = 'btn-overlay right';
                    overlay.innerHTML = `
                        <div class="mini-btn edit-btn" onclick="openEditForm(event, 'level3', [${currentModalCatIndex}, ${subIndex}, ${index}])">âœ</div>
                        <div class="mini-btn delete-btn" onclick="deleteItem(event, ${currentModalCatIndex}, ${subIndex}, ${index})">âœ•</div>
                    `;

                    if(!isEditMode) {
                        card.href = item.url || '#';
                        card.target = '_blank';
                    } else {
                        card.href = 'javascript:void(0)';
                    }
                    
                    card.style.animationDelay = `${index * 0.08}s`; 
                    const specificColor = colorPalette[index % colorPalette.length];
                    card.style.setProperty('background-color', specificColor.light, 'important');

                    card.innerHTML = `
                        <div class="card-icon">${item.icon}</div>
                        <div>
                            <strong>${item.title}</strong>
                            <span>${item.desc}</span>
                        </div>
                    `;
                    card.appendChild(overlay);
                    
                    level3Grid.appendChild(card);
                });
            }

            if(isEditMode) {
                const addBtn = document.createElement('div');
                addBtn.className = 'add-new-btn level-3';
                addBtn.innerHTML = 'ï¼‹ æ–°å¢é€£çµ';
                addBtn.onclick = () => openAddForm('level3');
                level3Grid.appendChild(addBtn);
            }
            
            // åˆå§‹åŒ–æ’åº (åŒ…å«éŒ¯èª¤è™•ç†)
            try {
                if(window.level3Sortable) window.level3Sortable.destroy();
                if(typeof Sortable !== 'undefined') {
                    window.level3Sortable = new Sortable(level3Grid, {
                        animation: 150,
                        ghostClass: 'sortable-ghost',
                        filter: '.add-new-btn',
                        onMove: function (evt) { return !evt.related.classList.contains('add-new-btn'); },
                        onEnd: function (evt) {
                            const subCat = pageData.categories[currentModalCatIndex].subCategories[currentModalSubIndex];
                            const movedItem = subCat.items.splice(evt.oldIndex, 1)[0];
                            subCat.items.splice(evt.newIndex, 0, movedItem);
                        }
                    });
                }
            } catch(e) {
                console.warn("Level 3 Sortable init failed:", e);
            }

            setTimeout(() => {
                level3Section.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }, 100);
        }

        // ==========================================
        // âœï¸ æ–°å¢èˆ‡ç·¨è¼¯è¡¨å–®é‚è¼¯
        // ==========================================
        function openAddForm(level) {
            editTarget = { type: level, action: 'add' };
            formTitle.innerText = "æ–°å¢é …ç›®";
            inputTitle.value = "";
            inputDesc.value = "";
            inputUrl.value = "";
            inputIcon.value = ""; 
            inputColor.value = "#46B3E6";

            groupDesc.style.display = (level === 'level2') ? 'none' : 'block';
            groupUrl.style.display = (level === 'level1' || level === 'level3') ? 'block' : 'none';
            groupColor.style.display = (level === 'level1') ? 'block' : 'none';

            formModal.classList.add('active');
        }

        function openEditForm(event, level, indices) {
            event.stopPropagation();
            event.preventDefault();
            editTarget = { type: level, action: 'edit', indices: indices };
            formTitle.innerText = "ç·¨è¼¯é …ç›®";

            let data;
            if(level === 'level1') {
                data = pageData.categories[indices[0]];
                inputTitle.value = data.title;
                inputDesc.value = data.desc;
                inputUrl.value = data.url || '';
                inputIcon.value = data.icon;
                inputColor.value = data.color;
                groupDesc.style.display = 'block';
                groupUrl.style.display = 'block';
                groupColor.style.display = 'block';
            } else if(level === 'level2') {
                data = pageData.categories[indices[0]].subCategories[indices[1]];
                inputTitle.value = data.name;
                inputIcon.value = data.emoji;
                groupDesc.style.display = 'none';
                groupUrl.style.display = 'none';
                groupColor.style.display = 'none';
            } else if(level === 'level3') {
                data = pageData.categories[indices[0]].subCategories[indices[1]].items[indices[2]];
                inputTitle.value = data.title;
                inputDesc.value = data.desc;
                inputUrl.value = data.url;
                inputIcon.value = data.icon;
                groupDesc.style.display = 'block';
                groupUrl.style.display = 'block';
                groupColor.style.display = 'none';
            }
            formModal.classList.add('active');
        }

        formSubmitBtn.onclick = () => {
            const title = inputTitle.value.trim();
            const desc = inputDesc.value.trim();
            const url = inputUrl.value.trim();
            let icon = inputIcon.value.trim();
            const color = inputColor.value;

            if(!title) { alert("æ¨™é¡Œä¸èƒ½ç‚ºç©ºï¼"); return; }
            if(!icon) icon = getRandomEmoji();

            if(editTarget.action === 'add') {
                if(editTarget.type === 'level1') {
                    pageData.categories.push({
                        title: title, desc: desc, icon: icon, color: color, url: url, subCategories: []
                    });
                    renderLevel1();
                } else if(editTarget.type === 'level2') {
                    if(!pageData.categories[currentModalCatIndex].subCategories) pageData.categories[currentModalCatIndex].subCategories = [];
                    pageData.categories[currentModalCatIndex].subCategories.push({
                        name: title, emoji: icon, items: []
                    });
                    openModal(currentModalCatIndex, true);
                } else if(editTarget.type === 'level3') {
                    const subCat = pageData.categories[currentModalCatIndex].subCategories[currentModalSubIndex];
                    if(!subCat.items) subCat.items = [];
                    subCat.items.push({
                        title: title, desc: desc, icon: icon, url: url
                    });
                    const colorObj = colorPalette[currentModalSubIndex % colorPalette.length];
                    renderLevel3(subCat, colorObj, currentModalSubIndex);
                }
            } else {
                const idx = editTarget.indices;
                if(editTarget.type === 'level1') {
                    const cat = pageData.categories[idx[0]];
                    cat.title = title; cat.desc = desc; cat.url = url; cat.icon = icon; cat.color = color;
                    renderLevel1();
                } else if(editTarget.type === 'level2') {
                    const sub = pageData.categories[idx[0]].subCategories[idx[1]];
                    sub.name = title; sub.emoji = icon;
                    openModal(idx[0], true);
                } else if(editTarget.type === 'level3') {
                    const item = pageData.categories[idx[0]].subCategories[idx[1]].items[idx[2]];
                    item.title = title; item.desc = desc; item.url = url; item.icon = icon;
                    const colorObj = colorPalette[idx[1] % colorPalette.length];
                    const subCat = pageData.categories[idx[0]].subCategories[idx[1]];
                    renderLevel3(subCat, colorObj, idx[1]);
                }
            }
            closeFormModal();
        };

        function closeFormModal() { formModal.classList.remove('active'); }

        // ==========================================
        // ğŸ—‘ï¸ åˆªé™¤åŠŸèƒ½
        // ==========================================
        function deleteCategory(e, index) {
            e.stopPropagation();
            if(confirm('ç¢ºå®šè¦åˆªé™¤æ•´å€‹åˆ†é¡å—ï¼Ÿæ­¤å‹•ä½œç„¡æ³•å¾©åŸã€‚')) {
                pageData.categories.splice(index, 1);
                renderLevel1();
            }
        }
        function deleteSubCategory(e, catIndex, subIndex) {
            e.stopPropagation();
            if(confirm('ç¢ºå®šè¦åˆªé™¤æ­¤å­åˆ†é¡å—ï¼Ÿ')) {
                pageData.categories[catIndex].subCategories.splice(subIndex, 1);
                openModal(catIndex, true);
            }
        }
        function deleteItem(e, catIndex, subIndex, itemIndex) {
            e.stopPropagation();
            e.preventDefault();
            if(confirm('ç¢ºå®šè¦åˆªé™¤æ­¤é€£çµå—ï¼Ÿ')) {
                const subCat = pageData.categories[catIndex].subCategories[subIndex];
                subCat.items.splice(itemIndex, 1);
                const colorObj = colorPalette[subIndex % colorPalette.length];
                renderLevel3(subCat, colorObj, subIndex);
            }
        }

        function closeViewModal() { viewModal.classList.remove('active'); }
        viewModal.addEventListener('click', (e) => { if(e.target === viewModal) closeViewModal(); });

        // ç·¨è¼¯å™¨èˆ‡å­˜æª”
        const editorModal = document.getElementById('editor-modal');
        const jsonEditor = document.getElementById('json-editor');
        function openEditor() { jsonEditor.value = JSON.stringify(pageData, null, 4); editorModal.classList.add('active'); }
        function closeEditor() { editorModal.classList.remove('active'); }
        function updateData() { try { pageData = JSON.parse(jsonEditor.value); renderLevel1(); closeEditor(); } catch(e) { alert("JSON æ ¼å¼éŒ¯èª¤"); } }
        
        function saveAndDownload() {
            const newDocument = document.documentElement.cloneNode(true);
            
            // å­˜æª”æ™‚å¼·åˆ¶é—œé–‰ç·¨è¼¯æ¨¡å¼ (è¨­ç‚ºé è¨­ç‹€æ…‹)
            newDocument.querySelector('body').classList.remove('edit-mode');
            const newEditBtn = newDocument.querySelector('#edit-toggle-btn');
            if (newEditBtn) {
                newEditBtn.classList.remove('edit-mode-active');
                newEditBtn.innerHTML = 'ğŸ”§'; 
            }
            
            // éš±è—æ‰€æœ‰é€²éšæŒ‰éˆ•
            const newSaveBtn = newDocument.querySelector('#save-btn');
            if (newSaveBtn) newSaveBtn.classList.add('hidden-btn');

            const newSourceBtn = newDocument.querySelector('#source-btn');
            if (newSourceBtn) newSourceBtn.classList.add('hidden-btn');

            const newClientBtn = newDocument.querySelector('#client-save-btn');
            if (newClientBtn) newClientBtn.classList.add('hidden-btn');

            const dataStr = JSON.stringify(pageData, null, 4);
            let htmlContent = newDocument.outerHTML;
            // ä¿®æ­£ï¼šä½¿ç”¨å›å‘¼å‡½æ•¸é¿å…ç‰¹æ®Šç¬¦è™Ÿï¼ˆå¦‚ $ï¼‰è¢«éŒ¯èª¤è§£æ
            htmlContent = htmlContent.replace(/let pageData = \{([\s\S]*?)\};/, function() {
                return `let pageData = ${dataStr};`;
            });

            const blob = new Blob([`<!DOCTYPE html>\n${htmlContent}`], {type: 'text/html'});
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = `ä¿å–®ç®¡ç†_${new Date().toISOString().split('T')[0]}.html`;
            a.click();
        }

        // æ–°å¢ï¼šå¦å­˜å®¢æˆ¶æª”æ¡ˆ (éš±è—ç·¨è¼¯æŒ‰éˆ•ï¼Œä¸ç§»é™¤å…ƒç´ )
        function saveAsClient() {
            // Prompt for filename
            let defaultName = "-ä¿å–®ç®¡ç†";
            let fileName = prompt("è«‹è¼¸å…¥å®¢æˆ¶æª”åï¼š", defaultName);
            
            if (fileName === null) return; // User clicked Cancel
            
            if (!fileName.trim()) {
                fileName = "å®¢æˆ¶ä¿å–®"; // Fallback if empty string provided
            }
            
            // Prepare clean name for title/header (before adding extension for file)
            let displayTitle = fileName.trim();
            if (displayTitle.endsWith(".html")) {
                displayTitle = displayTitle.substring(0, displayTitle.length - 5);
            }

            // Prepare filename for download
            if (!fileName.endsWith(".html")) {
                fileName += ".html";
            }

            const newDocument = document.documentElement.cloneNode(true);
            
            // Update Title
            newDocument.querySelector('title').innerText = displayTitle;

            // Update Header H1
            // Preserving the icon style
            const headerH1 = newDocument.querySelector('header h1');
            if(headerH1) {
                headerH1.innerText = 'ğŸ›¡ï¸ ' + displayTitle;
            }

            // 1. å¼·åˆ¶é—œé–‰ç·¨è¼¯æ¨¡å¼ (èˆ‡ä¸€èˆ¬å­˜æª”ç›¸åŒ)
            newDocument.querySelector('body').classList.remove('edit-mode');
            const newEditBtn = newDocument.querySelector('#edit-toggle-btn');
            if (newEditBtn) {
                newEditBtn.classList.remove('edit-mode-active');
                newEditBtn.innerHTML = 'ğŸ”§'; 
            }

            // 2. éš±è—æ‡¸æµ®å·¥å…·åˆ— (é€™æ˜¯å®¢æˆ¶æª”çš„å·®ç•°ï¼šç›´æ¥éš±è—æ•´å€‹å·¥å…·åˆ—)
            const toolbar = newDocument.querySelector('.floating-toolbar');
            if (toolbar) {
                toolbar.style.display = 'none'; // åªéš±è—ï¼Œä¸ç§»é™¤ï¼Œé¿å… JS åˆå§‹åŒ–æŠ“ä¸åˆ°å…ƒç´ å ±éŒ¯
            }

            // 3. é‡ç½®ä¸¦æ¸…ç† View Modal (ç¢ºä¿é–‹å•Ÿæ™‚ç‹€æ…‹æ­£ç¢º)
            const viewModal = newDocument.querySelector('#view-modal');
            if (viewModal) {
                viewModal.classList.remove('active');
                const l2 = newDocument.querySelector('#level-2-container');
                if(l2) l2.innerHTML = '';
                const l3 = newDocument.querySelector('#level-3-grid');
                if(l3) l3.innerHTML = '';
            }

            // 4. æ›´æ–°è³‡æ–™ (ä½¿ç”¨å®‰å…¨æ›¿æ›)
            const dataStr = JSON.stringify(pageData, null, 4);
            let htmlContent = newDocument.outerHTML;
            htmlContent = htmlContent.replace(/let pageData = \{([\s\S]*?)\};/, function() {
                return `let pageData = ${dataStr};`;
            });

            // 5. ä¸‹è¼‰
            const blob = new Blob([`<!DOCTYPE html>\n${htmlContent}`], {type: 'text/html'});
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = fileName; // Use the prompted filename
            a.click();
        }

        init();
    </script>

</body></html>