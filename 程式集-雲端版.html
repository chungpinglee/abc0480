<!DOCTYPE html>
<html lang="zh-TW"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>程式集-雲端版</title>
    <style>
        /* --- 全域與基本樣式 (未修改) --- */
        :root {
            --primary-color: #007bff;
            --primary-hover-color: #0056b3;
            --secondary-color: #6c757d;
            --background-color: #f8f9fa;
            --content-bg-color: #ffffff;
            --text-color: #212529;
            --border-color: #dee2e6;
            --shadow-color: rgba(0, 0, 0, 0.1);
            --danger-color: #dc3545;
            --danger-hover-color: #c82333;
            --success-color: #28a745;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            margin: 0;
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
            transition: background-color 0.3s;
        }
        .container { max-width: 960px; margin: 0 auto; padding: 15px; }

        /* --- 頁首 (未修改) --- */
        header {
            background-color: var(--content-bg-color);
            padding: 15px;
            margin-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
            box-shadow: 0 2px 4px var(--shadow-color);
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            align-items: center;
            gap: 15px;
        }
        #page-title { margin: 0; font-size: 1.8em; flex-grow: 1; }
        #page-title:hover { cursor: pointer; opacity: 0.7; }
        .controls-main { display: flex; align-items: center; gap: 10px; flex-wrap: wrap; }
        
        /* --- 編輯模式開關 (未修改) --- */
        .switch { position: relative; display: inline-block; width: 50px; height: 28px; }
        .switch input { display: none; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 28px; }
        .slider:before { position: absolute; content: ""; height: 20px; width: 20px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--primary-color); }
        input:checked + .slider:before { transform: translateX(22px); }
        .edit-mode-label { font-size: 0.9em; user-select: none; cursor: pointer; }

        /* --- 按鈕通用樣式 (未修改) --- */
        button { padding: 8px 12px; font-size: 0.9em; border: 1px solid var(--border-color); border-radius: 5px; cursor: pointer; background-color: var(--content-bg-color); transition: all 0.2s ease-in-out; }
        button:hover { opacity: 0.8; border-color: var(--secondary-color); }
        #add-block-btn { background-color: var(--success-color); color: white; border-color: var(--success-color); }
        #save-btn { background-color: var(--primary-color); color: white; border-color: var(--primary-color); }
        .primary-action { background-color: var(--primary-color); color: white; } /* Helper class for modal button */

        /* --- 區塊 (Block) 樣式 (未修改) --- */
        .block { background: var(--content-bg-color); border: 1px solid var(--border-color); border-radius: 8px; margin-bottom: 20px; padding: 15px; box-shadow: 0 1px 3px var(--shadow-color); transition: box-shadow 0.3s; }
        .block:hover { box-shadow: 0 4px 8px var(--shadow-color); }
        .block-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border-color); padding-bottom: 10px; margin-bottom: 15px; }
        .block-title { margin: 0; font-size: 1.4em; }
        .block-title:hover { cursor: pointer; opacity: 0.7; }
        .block-controls, .item-controls { display: flex; gap: 5px; }
        .block-controls button, .item-controls button { padding: 5px 8px; font-size: 1em; }
        .delete-block, .delete-item { color: var(--danger-color); }
        .delete-block:hover, .delete-item:hover { background-color: var(--danger-color); color: white; }
        .add-item-btn { margin-top: 15px; width: 100%; }

        /* --- 項目 (Item) 樣式 (未修改) --- */
        .item-list { display: flex; flex-direction: column; gap: 10px; }
        .item { display: flex; justify-content: space-between; align-items: center; padding: 10px; background-color: var(--background-color); border-radius: 5px; border: 1px solid transparent; }
        .item-content { flex-grow: 1; }
        .item-content a { text-decoration: none; color: var(--primary-color); font-weight: 500; }
        .item-content a:hover { text-decoration: underline; }
        .edit-mode .item-content a { pointer-events: none; }
        .item-edit-form { display: none; flex-direction: column; gap: 5px; flex-grow: 1; }
        .item-edit-form input { padding: 5px; border: 1px solid var(--border-color); border-radius: 3px; }
        .item-edit-form button { font-size: 0.8em; padding: 4px 8px; }

        /* --- 編輯模式控制 (未修改) --- */
        .edit-mode-item { display: none; }
        .edit-mode .edit-mode-item { display: flex; }
        .edit-mode-item.inline { display: none; }
        .edit-mode .edit-mode-item.inline { display: inline; }

        /* --- 桌面版響應式調整 (未修改) --- */
        @media (min-width: 768px) {
            #page-title { font-size: 2.2em; }
            .container { padding: 20px; }
        }

        /* --- 彈出視窗 (Modal) 樣式 (未修改) --- */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: none; 
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal-content {
            background-color: var(--content-bg-color);
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
        }
        .modal-content h3 {
            margin-top: 0;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 10px;
        }
        .modal-form-group {
            margin-bottom: 15px;
        }
        .modal-form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .modal-form-group select,
        .modal-form-group input {
            width: 100%;
            padding: 8px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            box-sizing: border-box; 
        }
        .modal-controls {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
        }
        /* --- 項目庫管理視窗的樣式 (未修改) --- */
        #library-items-list {
            max-height: 250px;
            overflow-y: auto;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            padding: 10px;
            margin-bottom: 15px;
        }
        .library-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 5px;
            border-bottom: 1px solid #eee;
        }
        .library-item:last-child {
            border-bottom: none;
        }
        .library-item-info {
            flex-grow: 1;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            margin-right: 10px;
        }
        .library-item-info small {
            color: var(--secondary-color);
            display: block;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .delete-library-item {
            padding: 2px 6px;
            font-size: 0.8em;
            color: var(--danger-color);
            flex-shrink: 0;
        }
        .delete-library-item:hover {
            background-color: var(--danger-color);
            color: white;
        }
        .top-modal-controls {
            display: flex;
            flex-wrap: wrap; 
            gap: 10px;
            margin: 15px 0;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 15px;
        }
        .top-modal-controls button {
            flex-grow: 1;
        }

        /* --- ✨ 美化修改開始 ✨ --- */
        
        /* 1. 字體請用微軟正黑體 */
        body {
            font-family: "Microsoft JhengHei", "微軟正黑體", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        }

        /* 2. 表頭標題 */
        #page-title {
            background-color: #007bff; /* 藍色 */
            color: white;
            font-weight: bold;
            padding: 5px 15px;
            border-radius: 8px;
            border: 2px solid black; /* 外框:黑粗體 */
            transition: all 0.2s ease-in-out;
        }
        /* 5. 滑鼠滑過文字時，文字顏色:紅色 */
        #page-title:hover {
            color: #dc3545; /* 紅色 */
            opacity: 1;
            text-shadow: none;
        }
        /* 6. 滑鼠停留在文字時，文字字體加大1號加粗，顏色:紅色，並且有光輝 */
        #page-title:active {
            color: #dc3545; /* 紅色 */
            font-weight: 900; /* 加粗 */
            font-size: 110%; /* 加大1號 */
            text-shadow: 0 0 10px rgba(255, 20, 20, 0.8); /* 紅色光輝 */
        }

        /* 3. 所有區塊:文字:深藍色，填滿效果:淡綠色 */
        .block {
            background-color: #DFF0D8; /* 淡綠色 */
            color: #00008B; /* 深藍色 */
            border-color: #C1E2B3;
        }
        .block .block-title {
            color: #00008B; /* 深藍色 */
            transition: all 0.2s ease-in-out;
        }
        /* 5. 滑鼠滑過區塊標題時 */
        .block .block-title:hover {
            color: #dc3545; /* 紅色 */
            opacity: 1;
        }
        /* 6. 滑鼠停留(按住)區塊標題時 */
        .block .block-title:active {
            color: #dc3545; /* 紅色 */
            font-weight: 900; /* 加粗 */
            font-size: 110%; /* 加大1號 */
            text-shadow: 0 0 10px rgba(255, 20, 20, 0.8); /* 紅色光輝 */
        }

        /* 4. 項目文字:黑色 */
        .item {
            background-color: var(--background-color);
            border: 1px solid var(--border-color);
        }
        .item .item-content a {
            color: black; /* 黑色 */
            font-weight: bold;
            display: inline-block; 
            transition: all 0.2s ease-in-out;
        }
        /* 5. 滑鼠滑過項目文字時 */
        .item .item-content a:hover {
            color: #dc3545; /* 紅色 */
            text-decoration: underline;
        }
        /* 6. 滑鼠停留(按住)項目文字時 */
        .item .item-content a:active {
            color: #dc3545; /* 紅色 */
            font-weight: 900; /* 加粗 */
            font-size: 110%; /* 加大1號 */
            text-shadow: 0 0 10px rgba(255, 20, 20, 0.8); /* 紅色光輝 */
        }

        /* 7. 當我滑鼠滑過按鈕時，按鈕顏色:白色，填滿效果:紅色 */
        button:hover {
            background-color: #dc3545; /* 紅色 */
            color: white !important; /* !important 確保覆蓋所有按鈕的文字顏色 */
            border-color: #c82333; 
            opacity: 1;
        }
        /* 針對特定已有 hover 效果的按鈕進行微調，確保一致性 */
        .delete-block:hover, .delete-item:hover, .delete-library-item:hover {
            background-color: #dc3545;
            color: white !important;
            border-color: #c82333;
        }
        /* --- ✨ 美化修改結束 ✨ --- */
    </style>
</head>
<body data-page-id="page-1761815926014" class="">

    <div class="container">
        <header>
            <h1 id="page-title" title="點擊以編輯標題" contenteditable="false" style="">程式集-雲端版</h1>
            <div class="controls-main">
                <label for="edit-mode-toggle" class="edit-mode-label">編輯模式</label>
                <label class="switch">
                    <input type="checkbox" id="edit-mode-toggle">
                    <span class="slider"></span>
                </label>
                <button id="manage-library-btn" class="edit-mode-item">📚 管理項目庫</button>
                <button id="add-block-btn" class="edit-mode-item">＋ 新增區塊</button>
                <button id="save-btn">💾 儲存並下載</button>
            </div>
        </header>

        <main id="main-container">
            
                
                
                
                
                <section class="block" data-id="1761814381624">
                    <div class="block-header">
                        <h2 class="block-title" title="點擊以編輯區塊標題">程式集</h2>
                        <div class="block-controls edit-mode-item">
                            <button class="move-block-up" title="上移">↑</button>
                            <button class="move-block-down" title="下移">↓</button>
                            <button class="delete-block" title="刪除區塊">🗑️</button>
                        </div>
                    </div>
                    <div class="item-list">
                <div class="item" data-id="1761814432489">
                    <div class="item-content" style="display: block;">
                        <a href="https://chungpinglee.github.io/abc0480/115%E5%B9%B4%E6%9C%88%E6%9B%86%E7%AD%86%E8%A8%98%E6%9C%AC%E7%A6%AE%E5%88%B8%E5%95%8F%E5%8D%B7.html" target="_blank" style="color: black;">115年月曆筆記本禮券需求問卷</a>
                    </div>
                    <div class="item-edit-form" style="display: none;">
                        <input type="text" class="edit-item-name" placeholder="顯示名稱" value="115年月曆筆記本禮券需求問卷">
                        <input type="url" class="edit-item-url" placeholder="https://example.com" value="#">
                        <div>
                            <button class="save-item-edit">儲存</button>
                            <button class="cancel-item-edit">取消</button>
                        </div>
                    </div>
                    <div class="item-controls edit-mode-item" style="">
                        <button class="edit-item" title="編輯">✏️</button>
                        <button class="move-item-up" title="上移">↑</button>
                        <button class="move-item-down" title="下移">↓</button>
                        <button class="delete-item" title="刪除">🗑️</button>
                    </div>
                </div>
            
                <div class="item" data-id="1761814471110">
                    <div class="item-content">
                        <a href="#" target="_blank" style="color: black;">保險規劃方向調查表</a>
                    </div>
                    <div class="item-edit-form">
                        <input type="text" class="edit-item-name" placeholder="顯示名稱" value="保險規劃方向調查表">
                        <input type="url" class="edit-item-url" placeholder="https://example.com" value="#">
                        <div>
                            <button class="save-item-edit">儲存</button>
                            <button class="cancel-item-edit">取消</button>
                        </div>
                    </div>
                    <div class="item-controls edit-mode-item">
                        <button class="edit-item" title="編輯">✏️</button>
                        <button class="move-item-up" title="上移">↑</button>
                        <button class="move-item-down" title="下移">↓</button>
                        <button class="delete-item" title="刪除">🗑️</button>
                    </div>
                </div>
            
                <div class="item" data-id="1761814481673">
                    <div class="item-content" style="display: block;">
                        <a href="https://chungpinglee.github.io/abc0480//%E4%BF%9D%E9%9A%AA%E5%95%86%E5%93%81%E5%B0%8E%E8%A6%BD.html" target="_blank" style="color: black;">保險商品導覽</a>
                    </div>
                    <div class="item-edit-form" style="display: none;">
                        <input type="text" class="edit-item-name" placeholder="顯示名稱" value="保險商品導覽">
                        <input type="url" class="edit-item-url" placeholder="https://example.com" value="#">
                        <div>
                            <button class="save-item-edit">儲存</button>
                            <button class="cancel-item-edit">取消</button>
                        </div>
                    </div>
                    <div class="item-controls edit-mode-item" style="">
                        <button class="edit-item" title="編輯">✏️</button>
                        <button class="move-item-up" title="上移">↑</button>
                        <button class="move-item-down" title="下移">↓</button>
                        <button class="delete-item" title="刪除">🗑️</button>
                    </div>
                </div>
            </div>
                    <button class="add-item-btn edit-mode-item">＋ 新增項目</button>
                </section><section class="block" data-id="1753780819659">
                    <div class="block-header">
                        <h2 class="block-title" title="點擊以編輯區塊標題">南山人壽-服務資源</h2>
                        <div class="block-controls edit-mode-item">
                            <button class="move-block-up" title="上移">↑</button>
                            <button class="move-block-down" title="下移">↓</button>
                            <button class="delete-block" title="刪除區塊">🗑️</button>
                        </div>
                    </div>
                    <div class="item-list">
                <div class="item" data-id="1753781119786">
                    <div class="item-content" style="display: block;">
                        <a href="https://www.nanshanlife.com.tw/nanshanlife/sitemap" target="_blank">南山人壽官方網站</a>
                    </div>
                    <div class="item-edit-form" style="display: none;">
                        <input type="text" class="edit-item-name" placeholder="顯示名稱" value="南山人壽官方網站">
                        <input type="url" class="edit-item-url" placeholder="https://example.com" value="https://www.nanshanlife.com.tw/nanshanlife/sitemap">
                        <div>
                            <button class="save-item-edit">儲存</button>
                            <button class="cancel-item-edit">取消</button>
                        </div>
                    </div>
                    <div class="item-controls edit-mode-item" style="">
                        <button class="edit-item" title="編輯">✏️</button>
                        <button class="move-item-up" title="上移">↑</button>
                        <button class="move-item-down" title="下移">↓</button>
                        <button class="delete-item" title="刪除">🗑️</button>
                    </div>
                </div>
                <div class="item" data-id="1753781144800">
                    <div class="item-content">
                        <a href="https://chatweb.nanshanlife.com.tw/?token=kTOszsUUuuuhVmDFdiPE9X4AaXYkFD0mthnj6hEB4Q5Mf1%2Fw0M4XapkgG7J9qk5GTmW6tRf45wI5PeqrYNn9LyrugF1PgkYIhyKB0yz%2BsQQAjjuqvb5x%2BQOAw0ffZEPRFDaHBgMrs6d7bERiPLADZCwdIZGS3O3O3T5cPk5MFCg%3D" target="_blank">南山人壽AI智能客服</a>
                    </div>
                    <div class="item-edit-form">
                        <input type="text" class="edit-item-name" placeholder="顯示名稱" value="南山人壽AI智能客服">
                        <input type="url" class="edit-item-url" placeholder="https://example.com" value="https://chatweb.nanshanlife.com.tw/?token=kTOszsUUuuuhVmDFdiPE9X4AaXYkFD0mthnj6hEB4Q5Mf1%2Fw0M4XapkgG7J9qk5GTmW6tRf45wI5PeqrYNn9LyrugF1PgkYIhyKB0yz%2BsQQAjjuqvb5x%2BQOAw0ffZEPRFDaHBgMrs6d7bERiPLADZCwdIZGS3O3O3T5cPk5MFCg%3D">
                        <div>
                            <button class="save-item-edit">儲存</button>
                            <button class="cancel-item-edit">取消</button>
                        </div>
                    </div>
                    <div class="item-controls edit-mode-item">
                        <button class="edit-item" title="編輯">✏️</button>
                        <button class="move-item-up" title="上移">↑</button>
                        <button class="move-item-down" title="下移">↓</button>
                        <button class="delete-item" title="刪除">🗑️</button>
                    </div>
                </div>
                <div class="item" data-id="1753781175002">
                    <div class="item-content">
                        <a href="https://www.nanshanlife.com.tw/nanshanlife/service-online-nsapp" target="_blank">請加入-南山人壽手機APP</a>
                    </div>
                    <div class="item-edit-form">
                        <input type="text" class="edit-item-name" placeholder="顯示名稱" value="請加入-南山人壽手機APP">
                        <input type="url" class="edit-item-url" placeholder="https://example.com" value="https://www.nanshanlife.com.tw/nanshanlife/service-online-nsapp">
                        <div>
                            <button class="save-item-edit">儲存</button>
                            <button class="cancel-item-edit">取消</button>
                        </div>
                    </div>
                    <div class="item-controls edit-mode-item">
                        <button class="edit-item" title="編輯">✏️</button>
                        <button class="move-item-up" title="上移">↑</button>
                        <button class="move-item-down" title="下移">↓</button>
                        <button class="delete-item" title="刪除">🗑️</button>
                    </div>
                </div>
                <div class="item" data-id="1753781186676">
                    <div class="item-content">
                        <a href="https://www.nanshanlife.com.tw/nanshanlife/service-online-line" target="_blank">請加入-LINE南山人壽官方帳號</a>
                    </div>
                    <div class="item-edit-form">
                        <input type="text" class="edit-item-name" placeholder="顯示名稱" value="請加入-LINE南山人壽官方帳號">
                        <input type="url" class="edit-item-url" placeholder="https://example.com" value="https://www.nanshanlife.com.tw/nanshanlife/service-online-line">
                        <div>
                            <button class="save-item-edit">儲存</button>
                            <button class="cancel-item-edit">取消</button>
                        </div>
                    </div>
                    <div class="item-controls edit-mode-item">
                        <button class="edit-item" title="編輯">✏️</button>
                        <button class="move-item-up" title="上移">↑</button>
                        <button class="move-item-down" title="下移">↓</button>
                        <button class="delete-item" title="刪除">🗑️</button>
                    </div>
                </div>
                <div class="item" data-id="1753781227056">
                    <div class="item-content" style="display: block;">
                        <a href="https://www.nanshanlife.com.tw/nanshanlife/service-form" target="_blank">各種表格下載</a>
                    </div>
                    <div class="item-edit-form" style="display: none;">
                        <input type="text" class="edit-item-name" placeholder="顯示名稱" value="各種表格下載">
                        <input type="url" class="edit-item-url" placeholder="https://example.com" value="https://www.nanshanlife.com.tw/nanshanlife/service-form">
                        <div>
                            <button class="save-item-edit">儲存</button>
                            <button class="cancel-item-edit">取消</button>
                        </div>
                    </div>
                    <div class="item-controls edit-mode-item" style="">
                        <button class="edit-item" title="編輯">✏️</button>
                        <button class="move-item-up" title="上移">↑</button>
                        <button class="move-item-down" title="下移">↓</button>
                        <button class="delete-item" title="刪除">🗑️</button>
                    </div>
                </div>
                <div class="item" data-id="1753781243757">
                    <div class="item-content">
                        <a href="#" target="_blank">免付費電話 0800-020-060 按1</a>
                    </div>
                    <div class="item-edit-form">
                        <input type="text" class="edit-item-name" placeholder="顯示名稱" value="免付費電話 0800-020-060 按1">
                        <input type="url" class="edit-item-url" placeholder="https://example.com" value="#">
                        <div>
                            <button class="save-item-edit">儲存</button>
                            <button class="cancel-item-edit">取消</button>
                        </div>
                    </div>
                    <div class="item-controls edit-mode-item">
                        <button class="edit-item" title="編輯">✏️</button>
                        <button class="move-item-up" title="上移">↑</button>
                        <button class="move-item-down" title="下移">↓</button>
                        <button class="delete-item" title="刪除">🗑️</button>
                    </div>
                </div>
            </div>
                    <button class="add-item-btn edit-mode-item">＋ 新增項目</button>
                </section>
                <section class="block" data-id="1753780831656">
                    <div class="block-header">
                        <h2 class="block-title" title="點擊以編輯區塊標題">南山產物-服務資源</h2>
                        <div class="block-controls edit-mode-item">
                            <button class="move-block-up" title="上移">↑</button>
                            <button class="move-block-down" title="下移">↓</button>
                            <button class="delete-block" title="刪除區塊">🗑️</button>
                        </div>
                    </div>
                    <div class="item-list">
                <div class="item" data-id="1753781261326">
                    <div class="item-content">
                        <a href="https://www.nanshangeneral.com.tw/sitemap" target="_blank">南山產物官方網站</a>
                    </div>
                    <div class="item-edit-form">
                        <input type="text" class="edit-item-name" placeholder="顯示名稱" value="南山產物官方網站">
                        <input type="url" class="edit-item-url" placeholder="https://example.com" value="https://www.nanshangeneral.com.tw/sitemap">
                        <div>
                            <button class="save-item-edit">儲存</button>
                            <button class="cancel-item-edit">取消</button>
                        </div>
                    </div>
                    <div class="item-controls edit-mode-item">
                        <button class="edit-item" title="編輯">✏️</button>
                        <button class="move-item-up" title="上移">↑</button>
                        <button class="move-item-down" title="下移">↓</button>
                        <button class="delete-item" title="刪除">🗑️</button>
                    </div>
                </div>
                <div class="item" data-id="1753781281417">
                    <div class="item-content">
                        <a href="https://www.nanshangeneral.com.tw/download" target="_blank">南山產物-各種表格下載</a>
                    </div>
                    <div class="item-edit-form">
                        <input type="text" class="edit-item-name" placeholder="顯示名稱" value="南山產物-各種表格下載">
                        <input type="url" class="edit-item-url" placeholder="https://example.com" value="https://www.nanshangeneral.com.tw/download">
                        <div>
                            <button class="save-item-edit">儲存</button>
                            <button class="cancel-item-edit">取消</button>
                        </div>
                    </div>
                    <div class="item-controls edit-mode-item">
                        <button class="edit-item" title="編輯">✏️</button>
                        <button class="move-item-up" title="上移">↑</button>
                        <button class="move-item-down" title="下移">↓</button>
                        <button class="delete-item" title="刪除">🗑️</button>
                    </div>
                </div><div class="item" data-id="1753781270000">
                    <div class="item-content">
                        <a href="https://www.nanshangeneral.com.tw/contactus?tabTitle=%E5%8C%97%E5%8D%80&amp;page=1" target="_blank">汽車拖吊服務專線及全省服務據點</a>
                    </div>
                    <div class="item-edit-form">
                        <input type="text" class="edit-item-name" placeholder="顯示名稱" value="汽車拖吊服務專線及全省服務據點">
                        <input type="url" class="edit-item-url" placeholder="https://example.com" value="https://www.nanshangeneral.com.tw/contactus?tabTitle=%E5%8C%97%E5%8D%80&amp;page=1">
                        <div>
                            <button class="save-item-edit">儲存</button>
                            <button class="cancel-item-edit">取消</button>
                        </div>
                    </div>
                    <div class="item-controls edit-mode-item">
                        <button class="edit-item" title="編輯">✏️</button>
                        <button class="move-item-up" title="上移">↑</button>
                        <button class="move-item-down" title="下移">↓</button>
                        <button class="delete-item" title="刪除">🗑️</button>
                    </div>
                </div>
                <div class="item" data-id="1753781292328">
                    <div class="item-content">
                        <a href="https://www.nanshangeneral.com.tw/PublicWebGeneral/flight_delay.html" target="_blank">不便險:飛機延誤即時申請理賠流程</a>
                    </div>
                    <div class="item-edit-form">
                        <input type="text" class="edit-item-name" placeholder="顯示名稱" value="不便險:飛機延誤即時申請理賠流程">
                        <input type="url" class="edit-item-url" placeholder="https://example.com" value="https://www.nanshangeneral.com.tw/PublicWebGeneral/flight_delay.html">
                        <div>
                            <button class="save-item-edit">儲存</button>
                            <button class="cancel-item-edit">取消</button>
                        </div>
                    </div>
                    <div class="item-controls edit-mode-item">
                        <button class="edit-item" title="編輯">✏️</button>
                        <button class="move-item-up" title="上移">↑</button>
                        <button class="move-item-down" title="下移">↓</button>
                        <button class="delete-item" title="刪除">🗑️</button>
                    </div>
                </div>
                <div class="item" data-id="1753781337969">
                    <div class="item-content">
                        <a href="https://www.nanshangeneral.com.tw/240" target="_blank">旅遊平安險:理賠文件及問題說明</a>
                    </div>
                    <div class="item-edit-form">
                        <input type="text" class="edit-item-name" placeholder="顯示名稱" value="旅遊平安險:理賠文件及問題說明">
                        <input type="url" class="edit-item-url" placeholder="https://example.com" value="https://www.nanshangeneral.com.tw/240">
                        <div>
                            <button class="save-item-edit">儲存</button>
                            <button class="cancel-item-edit">取消</button>
                        </div>
                    </div>
                    <div class="item-controls edit-mode-item">
                        <button class="edit-item" title="編輯">✏️</button>
                        <button class="move-item-up" title="上移">↑</button>
                        <button class="move-item-down" title="下移">↓</button>
                        <button class="delete-item" title="刪除">🗑️</button>
                    </div>
                </div><div class="item" data-id="1753781360094">
                    <div class="item-content">
                        <a href="https://www.nanshangeneral.com.tw/service-119?tabTitle=%E8%A1%8C%E6%94%BF%E5%8F%8A%E6%97%85%E9%81%8A%E8%B3%87%E8%A8%8A%E5%8D%94%E5%8A%A9" target="_blank">海外緊急救援專線及相關說明</a>
                    </div>
                    <div class="item-edit-form">
                        <input type="text" class="edit-item-name" placeholder="顯示名稱" value="海外緊急救援專線及相關說明">
                        <input type="url" class="edit-item-url" placeholder="https://example.com" value="https://www.nanshangeneral.com.tw/service-119?tabTitle=%E8%A1%8C%E6%94%BF%E5%8F%8A%E6%97%85%E9%81%8A%E8%B3%87%E8%A8%8A%E5%8D%94%E5%8A%A9">
                        <div>
                            <button class="save-item-edit">儲存</button>
                            <button class="cancel-item-edit">取消</button>
                        </div>
                    </div>
                    <div class="item-controls edit-mode-item">
                        <button class="edit-item" title="編輯">✏️</button>
                        <button class="move-item-up" title="上移">↑</button>
                        <button class="move-item-down" title="下移">↓</button>
                        <button class="delete-item" title="刪除">🗑️</button>
                    </div>
                </div><div class="item" data-id="1753781408831">
                    <div class="item-content">
                        <a href="https://www.nanshangeneral.com.tw/line" target="_blank">請加入個人化LINE通知服務</a>
                    </div>
                    <div class="item-edit-form">
                        <input type="text" class="edit-item-name" placeholder="顯示名稱" value="請加入個人化LINE通知服務">
                        <input type="url" class="edit-item-url" placeholder="https://example.com" value="https://www.nanshangeneral.com.tw/line">
                        <div>
                            <button class="save-item-edit">儲存</button>
                            <button class="cancel-item-edit">取消</button>
                        </div>
                    </div>
                    <div class="item-controls edit-mode-item">
                        <button class="edit-item" title="編輯">✏️</button>
                        <button class="move-item-up" title="上移">↑</button>
                        <button class="move-item-down" title="下移">↓</button>
                        <button class="delete-item" title="刪除">🗑️</button>
                    </div>
                </div><div class="item" data-id="1753781320990">
                    <div class="item-content">
                        <a href="#" target="_blank">南山產物免付費電話 :0800-020-060按2</a>
                    </div>
                    <div class="item-edit-form">
                        <input type="text" class="edit-item-name" placeholder="顯示名稱" value="南山產物免付費電話 :0800-020-060按2">
                        <input type="url" class="edit-item-url" placeholder="https://example.com" value="#">
                        <div>
                            <button class="save-item-edit">儲存</button>
                            <button class="cancel-item-edit">取消</button>
                        </div>
                    </div>
                    <div class="item-controls edit-mode-item">
                        <button class="edit-item" title="編輯">✏️</button>
                        <button class="move-item-up" title="上移">↑</button>
                        <button class="move-item-down" title="下移">↓</button>
                        <button class="delete-item" title="刪除">🗑️</button>
                    </div>
                </div>
            
                <div class="item" data-id="1761814580005">
                    <div class="item-content" style="display: block;">
                        <a href="https://notebooklm.google.com/notebook/2357da7b-cc3e-4bb1-b5af-88ba09d62456" target="_blank" style="color: black;">車禍.調解.相關法令諮詢</a>
                    </div>
                    <div class="item-edit-form" style="display: none;">
                        <input type="text" class="edit-item-name" placeholder="顯示名稱" value="車禍.調解.相關法令諮詢">
                        <input type="url" class="edit-item-url" placeholder="https://example.com" value="https://notebooklm.google.com/notebook/2357da7b-cc3e-4bb1-b5af-88ba09d62456">
                        <div>
                            <button class="save-item-edit">儲存</button>
                            <button class="cancel-item-edit">取消</button>
                        </div>
                    </div>
                    <div class="item-controls edit-mode-item" style="">
                        <button class="edit-item" title="編輯">✏️</button>
                        <button class="move-item-up" title="上移">↑</button>
                        <button class="move-item-down" title="下移">↓</button>
                        <button class="delete-item" title="刪除">🗑️</button>
                    </div>
                </div>
            </div>
                    <button class="add-item-btn edit-mode-item">＋ 新增項目</button>
                </section>
                
            
                
            </main>
    </div>

    <div id="add-item-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <h3>新增項目</h3>
            <div class="modal-form-group">
                <label for="item-library-select">從資料庫中選擇</label>
                <select id="item-library-select"><option value="new">--- 請選擇或自行輸入 ---</option><option value="{&quot;name&quot;:&quot;⛰️🛡️南山人壽保單校正表&quot;,&quot;url&quot;:&quot;&quot;,&quot;color&quot;:&quot;#f90606&quot;,&quot;id&quot;:&quot;lib-1758039397462&quot;}" style="color: rgb(249, 6, 6); font-weight: bold;">⛰️🛡️南山人壽保單校正表</option><option value="{&quot;name&quot;:&quot;🏔️🏠南山產物--總表&quot;,&quot;url&quot;:&quot;&quot;,&quot;color&quot;:&quot;#064b12&quot;,&quot;id&quot;:&quot;lib-1758100273321&quot;}" style="color: rgb(6, 75, 18); font-weight: bold;">🏔️🏠南山產物--總表</option><option value="{&quot;name&quot;:&quot;🏠🔥住宅火險&quot;,&quot;url&quot;:&quot;&quot;,&quot;color&quot;:&quot;#f20202&quot;,&quot;id&quot;:&quot;lib-1758039464230&quot;}" style="color: rgb(242, 2, 2); font-weight: bold;">🏠🔥住宅火險</option><option value="{&quot;name&quot;:&quot;💰🧘‍♂️金如意個人意外險&quot;,&quot;url&quot;:&quot;&quot;,&quot;color&quot;:&quot;#f50505&quot;,&quot;id&quot;:&quot;lib-1758039478988&quot;}" style="color: rgb(245, 5, 5); font-weight: bold;">💰🧘‍♂️金如意個人意外險</option><option value="{&quot;name&quot;:&quot;📄📊保單校正分析報告&quot;,&quot;url&quot;:&quot;&quot;,&quot;color&quot;:&quot;#ff0512&quot;,&quot;id&quot;:&quot;lib-1758039374761&quot;}" style="color: rgb(255, 5, 18); font-weight: bold;">📄📊保單校正分析報告</option><option value="{&quot;name&quot;:&quot;🩺🗣️保單健檢語音分析&quot;,&quot;url&quot;:&quot;&quot;,&quot;color&quot;:&quot;#f50000&quot;,&quot;id&quot;:&quot;lib-1758039330676&quot;}" style="color: rgb(245, 0, 0); font-weight: bold;">🩺🗣️保單健檢語音分析</option><option value="{&quot;name&quot;:&quot;🚗🛡️汽車險-💻&quot;,&quot;url&quot;:&quot;C:\\Users\\李仲平\\Desktop\\我的HTML系統\\程式-故事書產生器\\汽車保險\\小李新車的奇幻之-故事\\car_insurance_storybook.html&quot;,&quot;color&quot;:&quot;#f90606&quot;,&quot;id&quot;:&quot;lib-1758103441719&quot;}" style="color: rgb(249, 6, 6); font-weight: bold;">🚗🛡️汽車險-💻</option><option value="{&quot;name&quot;:&quot;🚗🛡️汽車險-📞&quot;,&quot;url&quot;:&quot;https://drive.google.com/file/d/1I7QmEN6IN13dUD5dHxF5hkW_tJlDpF6g/view?usp=sharing&quot;,&quot;color&quot;:&quot;#000000&quot;,&quot;id&quot;:&quot;lib-1758103594280&quot;}" style="color: rgb(0, 0, 0);">🚗🛡️汽車險-📞</option><option value="{&quot;name&quot;:&quot;🛵🛡️機車險&quot;,&quot;url&quot;:&quot;&quot;,&quot;color&quot;:&quot;#ff0000&quot;,&quot;id&quot;:&quot;lib-1758039498411&quot;}" style="color: rgb(255, 0, 0); font-weight: bold;">🛵🛡️機車險</option><option value="{&quot;name&quot;:&quot;投保紀錄&quot;,&quot;url&quot;:&quot;&quot;,&quot;color&quot;:&quot;#000000&quot;,&quot;id&quot;:&quot;lib-1758039696261&quot;}" style="color: rgb(0, 0, 0);">投保紀錄</option><option value="{&quot;name&quot;:&quot;投資型保單加值給付與價值分析--報表&quot;,&quot;url&quot;:&quot;&quot;,&quot;color&quot;:&quot;#000000&quot;,&quot;id&quot;:&quot;lib-1758039649399&quot;}" style="color: rgb(0, 0, 0);">投資型保單加值給付與價值分析--報表</option><option value="{&quot;name&quot;:&quot;投資型保單加值給付與價值分析-語音&quot;,&quot;url&quot;:&quot;&quot;,&quot;color&quot;:&quot;#000000&quot;,&quot;id&quot;:&quot;lib-1758039613152&quot;}" style="color: rgb(0, 0, 0);">投資型保單加值給付與價值分析-語音</option><option value="{&quot;name&quot;:&quot;車險相關服務&quot;,&quot;url&quot;:&quot;&quot;,&quot;color&quot;:&quot;#ff0505&quot;,&quot;id&quot;:&quot;lib-1761444312687&quot;}" style="color: rgb(255, 5, 5); font-weight: bold;">車險相關服務</option><option value="{&quot;name&quot;:&quot;服務紀錄&quot;,&quot;url&quot;:&quot;&quot;,&quot;color&quot;:&quot;#000000&quot;,&quot;id&quot;:&quot;lib-1758039712730&quot;}" style="color: rgb(0, 0, 0);">服務紀錄</option><option value="{&quot;name&quot;:&quot;保單校正分析報告--&quot;,&quot;url&quot;:&quot;&quot;,&quot;color&quot;:&quot;#000000&quot;,&quot;id&quot;:&quot;lib-1758039564638&quot;}" style="color: rgb(0, 0, 0);">保單校正分析報告--</option><option value="{&quot;name&quot;:&quot;保單健檢語音分析--&quot;,&quot;url&quot;:&quot;&quot;,&quot;color&quot;:&quot;#000000&quot;,&quot;id&quot;:&quot;lib-1758039525067&quot;}" style="color: rgb(0, 0, 0);">保單健檢語音分析--</option><option value="{&quot;name&quot;:&quot;南山人壽保單校正表--&quot;,&quot;url&quot;:&quot;&quot;,&quot;color&quot;:&quot;#000000&quot;,&quot;id&quot;:&quot;lib-1758039579520&quot;}" style="color: rgb(0, 0, 0);">南山人壽保單校正表--</option><option value="{&quot;name&quot;:&quot;旅遊不便險相關服務&quot;,&quot;url&quot;:&quot;&quot;,&quot;color&quot;:&quot;#fe0101&quot;,&quot;id&quot;:&quot;lib-1761444344686&quot;}" style="color: rgb(254, 1, 1); font-weight: bold;">旅遊不便險相關服務</option><option value="{&quot;name&quot;:&quot;理賠紀錄&quot;,&quot;url&quot;:&quot;&quot;,&quot;color&quot;:&quot;#000000&quot;,&quot;id&quot;:&quot;lib-1758039729790&quot;}" style="color: rgb(0, 0, 0);">理賠紀錄</option></select>
            </div>
            <div id="manual-item-entry" style="display: block;">
                <div class="modal-form-group">
                    <label for="new-item-name">自行輸入項目名稱</label>
                    <input type="text" id="new-item-name" placeholder="">
                </div>
                <div class="modal-form-group">
                    <label for="new-item-url">連結 URL</label>
                    <input type="url" id="new-item-url" placeholder="https://example.com">
                </div>
            </div>
            <div class="modal-controls">
                <button id="cancel-add-item-btn">取消</button>
                <button id="confirm-add-item-btn" class="primary-action">確認新增</button>
            </div>
        </div>
    </div>
    
    <div id="add-block-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <h3>新增區塊</h3>
            <div class="modal-form-group">
                <label for="new-block-title">請輸入新標題</label>
                <input type="text" id="new-block-title" placeholder="例如：客戶A相關連結">
            </div>
            <div class="modal-controls">
                <button id="cancel-add-block-btn">取消</button>
                <button id="confirm-add-block-btn" class="primary-action">確認新增</button>
            </div>
        </div>
    </div>
    
    <div id="manage-library-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <h3>管理全域項目庫</h3>
            
            <div class="top-modal-controls">
                <button id="add-to-library-continue-btn">新增後繼續</button>
                <button id="add-to-library-close-btn" class="primary-action">新增並關閉</button>
                <button id="close-library-modal-btn">關閉視窗</button>
            </div>

            <p>您可以在下方查看、新增或刪除項目庫中的內容。</p>

            <div class="modal-form-group">
                <label>目前庫存項目</label>
                <div id="library-items-list"></div>
            </div>
            <hr>
            <h4>新增至項目庫</h4>
            <div class="modal-form-group">
                <label for="lib-new-item-name">顯示名稱 (必要)</label>
                <div style="display: flex; align-items: center; gap: 10px;">
                    <input type="text" id="lib-new-item-name" placeholder="例如：常用報表系統" style="flex-grow: 1;">
                    <input type="color" id="lib-new-item-color" title="選擇文字顏色" value="#000000" style="width: 25px; height: 25px; padding: 2px;">
                    </div>
            </div>
            <div class="modal-form-group">
                <label for="lib-new-item-url">連結 URL (非必要)</label>
                <input type="url" id="lib-new-item-url" placeholder="可留空">
            </div>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {

        // --- 頁面身分證機制 (邏輯不變) ---
        let pageId = document.body.dataset.pageId;
        if (!pageId) {
            pageId = 'page-' + Date.now();
            document.body.dataset.pageId = pageId;
        }

        // --- DOM 元素選擇 (無新增) ---
        const pageTitle = document.getElementById('page-title');
        const mainContainer = document.getElementById('main-container');
        const addBlockBtn = document.getElementById('add-block-btn');
        const editModeToggle = document.getElementById('edit-mode-toggle');
        const saveBtn = document.getElementById('save-btn');
        const addItemModal = document.getElementById('add-item-modal');
        const itemLibrarySelect = document.getElementById('item-library-select');
        const manualItemEntry = document.getElementById('manual-item-entry');
        const newItemNameInput = document.getElementById('new-item-name');
        const newItemUrlInput = document.getElementById('new-item-url');
        const confirmAddItemBtn = document.getElementById('confirm-add-item-btn');
        const cancelAddItemBtn = document.getElementById('cancel-add-item-btn');
        const addBlockModal = document.getElementById('add-block-modal');
        const newBlockTitleInput = document.getElementById('new-block-title');
        const confirmAddBlockBtn = document.getElementById('confirm-add-block-btn');
        const cancelAddBlockBtn = document.getElementById('cancel-add-block-btn');
        const manageLibraryBtn = document.getElementById('manage-library-btn');
        const manageLibraryModal = document.getElementById('manage-library-modal');
        const libraryItemsList = document.getElementById('library-items-list');
        const libNewItemNameInput = document.getElementById('lib-new-item-name');
        const libNewItemUrlInput = document.getElementById('lib-new-item-url');
        const libNewItemColorInput = document.getElementById('lib-new-item-color');
        const addToLibraryContinueBtn = document.getElementById('add-to-library-continue-btn');
        const addToLibraryCloseBtn = document.getElementById('add-to-library-close-btn');
        const closeLibraryModalBtn = document.getElementById('close-library-modal-btn');

        // --- 狀態與資料 (邏輯不變) ---
        const CONTENT_STORAGE_KEY = `portalPageContent-${pageId}`;
        const GLOBAL_LIBRARY_KEY = `portalGlobalItemLibrary`;
        let globalItemLibrary = [];
        let currentAddItemTargetList = null; 

        // --- 核心資料存取函數 (邏輯不變) ---
        const savePageContent = () => {
            const dataToSave = {
                title: pageTitle.textContent,
                content: mainContainer.innerHTML
            };
            localStorage.setItem(CONTENT_STORAGE_KEY, JSON.stringify(dataToSave));
        };
        const saveGlobalLibrary = () => {
            globalItemLibrary.sort((a, b) => a.name.localeCompare(b.name, 'zh-Hant'));
            localStorage.setItem(GLOBAL_LIBRARY_KEY, JSON.stringify(globalItemLibrary));
        };
        const loadState = () => {
            const savedLibrary = localStorage.getItem(GLOBAL_LIBRARY_KEY);
            if (savedLibrary) {
                globalItemLibrary = JSON.parse(savedLibrary);
            }
            const savedData = localStorage.getItem(CONTENT_STORAGE_KEY);
            if (savedData) {
                const data = JSON.parse(savedData);
                pageTitle.textContent = data.title;
                mainContainer.innerHTML = data.content;
                updatePageTitle();
            } else {
                if(mainContainer.children.length === 0){
                    addBlock('預設區塊');
                }
            }
        };
        const addItemToGlobalLibrary = (name, url, color) => {
            const trimmedName = name.trim();
            const trimmedUrl = url.trim();
            const existingItem = globalItemLibrary.find(item => item.name === trimmedName);
            if (!existingItem) {
                globalItemLibrary.push({ name: trimmedName, url: trimmedUrl, color: color, id: 'lib-' + Date.now() });
                saveGlobalLibrary();
                return true;
            } else {
                alert(`名稱為 "${trimmedName}" 的項目已存在於庫中，請使用不同名稱。`);
                return false;
            }
        };

        // --- 核心功能函數 (邏輯不變) ---
        const toggleEditMode = () => {
            document.body.classList.toggle('edit-mode', editModeToggle.checked);
            if (!editModeToggle.checked) {
                document.querySelectorAll('.is-editing').forEach(el => {
                    el.classList.remove('is-editing');
                    if(el.classList.contains('item')){
                        toggleItemEditView(el, false);
                    }
                });
                document.querySelectorAll('[contenteditable="true"]').forEach(el => {
                    el.contentEditable = 'false';
                    savePageContent(); 
                });
            }
        };
        const makeEditable = (element) => {
            if (!editModeToggle.checked) return;
            element.style.outline = 'none';
            element.contentEditable = 'true';
            element.focus();
            document.execCommand('selectAll', false, null);
            element.addEventListener('blur', () => {
                element.contentEditable = 'false';
                element.style.outline = '';
                savePageContent();
            }, { once: true });
        };
        const updatePageTitle = () => {
            document.title = pageTitle.textContent.trim();
        };
        const addBlock = (title = '新區塊') => {
            const blockId = Date.now();
            const blockHTML = `
                <section class="block" data-id="${blockId}">
                    <div class="block-header">
                        <h2 class="block-title" title="點擊以編輯區塊標題">${title}</h2>
                        <div class="block-controls edit-mode-item">
                            <button class="move-block-up" title="上移">↑</button>
                            <button class="move-block-down" title="下移">↓</button>
                            <button class="delete-block" title="刪除區塊">🗑️</button>
                        </div>
                    </div>
                    <div class="item-list"></div>
                    <button class="add-item-btn edit-mode-item">＋ 新增項目</button>
                </section>
            `;
            mainContainer.insertAdjacentHTML('beforeend', blockHTML);
            savePageContent();
        };
        const createAndInsertItem = (itemListEl, name, url, color) => {
            const itemId = Date.now();
            const linkColor = color || 'black';
            const itemHTML = `
                <div class="item" data-id="${itemId}">
                    <div class="item-content">
                        <a href="${url || '#'}" target="_blank" style="color: ${linkColor};">${name}</a>
                    </div>
                    <div class="item-edit-form">
                        <input type="text" class="edit-item-name" placeholder="顯示名稱" value="${name}">
                        <input type="url" class="edit-item-url" placeholder="https://example.com" value="${url || '#'}">
                        <div>
                            <button class="save-item-edit">儲存</button>
                            <button class="cancel-item-edit">取消</button>
                        </div>
                    </div>
                    <div class="item-controls edit-mode-item">
                        <button class="edit-item" title="編輯">✏️</button>
                        <button class="move-item-up" title="上移">↑</button>
                        <button class="move-item-down" title="下移">↓</button>
                        <button class="delete-item" title="刪除">🗑️</button>
                    </div>
                </div>
            `;
            itemListEl.insertAdjacentHTML('beforeend', itemHTML);
            savePageContent();
        };
        const toggleItemEditView = (itemEl, showEdit) => {
            const contentView = itemEl.querySelector('.item-content');
            const editForm = itemEl.querySelector('.item-edit-form');
            const controlsView = itemEl.querySelector('.item-controls');
            contentView.style.display = showEdit ? 'none' : 'block';
            editForm.style.display = showEdit ? 'flex' : 'none';
            controlsView.style.display = showEdit ? 'none' : '';
            if(showEdit){ itemEl.classList.add('is-editing'); } 
            else { itemEl.classList.remove('is-editing'); }
        };
        const saveItemEdit = (btn) => {
            const itemEl = btn.closest('.item');
            const nameInput = itemEl.querySelector('.edit-item-name');
            const urlInput = itemEl.querySelector('.edit-item-url');
            const link = itemEl.querySelector('.item-content a');
            link.textContent = nameInput.value;
            link.href = urlInput.value || '#';
            toggleItemEditView(itemEl, false);
            savePageContent();
        };
        const moveElement = (element, direction) => {
            const parent = element.parentNode;
            if (direction === 'up') {
                const previousSibling = element.previousElementSibling;
                if (previousSibling) parent.insertBefore(element, previousSibling);
            } else if (direction === 'down') {
                const nextSibling = element.nextElementSibling;
                if (nextSibling) parent.insertBefore(nextSibling, element);
            }
            savePageContent();
        };
        const saveAndDownload = () => {
            const newDocument = document.documentElement.cloneNode(true);
            const newId = 'page-' + Date.now();
            newDocument.querySelector('body').dataset.pageId = newId;
            newDocument.querySelector('body').classList.remove('edit-mode');
            const editToggle = newDocument.querySelector('#edit-mode-toggle');
            if (editToggle) {
                editToggle.checked = false;
            }
            const htmlContent = `<!DOCTYPE html>\n` + newDocument.outerHTML;
            const blob = new Blob([htmlContent], { type: 'text/html;charset=utf-8' });
            const link = document.createElement('a');
            const newFileName = pageTitle.textContent.trim() || 'portal';
            link.href = URL.createObjectURL(blob);
            link.download = `${newFileName}-${new Date().toISOString().slice(0,10)}.html`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(link.href);
            alert('具備完整編輯功能的新檔案已成功產生並開始下載！');
        };

        // --- Modal 相關函數 (邏輯不變) ---
        const showAddItemModal = (btn) => {
            currentAddItemTargetList = btn.closest('.block').querySelector('.item-list');
            itemLibrarySelect.innerHTML = '<option value="new">--- 請選擇或自行輸入 ---</option>';
            globalItemLibrary.forEach(item => {
                const option = document.createElement('option');
                option.value = JSON.stringify(item);
                option.textContent = item.name;
                option.style.color = item.color || 'black';
                if ((item.color || '#000000').toLowerCase() !== '#000000') {
                    option.style.fontWeight = 'bold';
                }
                itemLibrarySelect.appendChild(option);
            });
            itemLibrarySelect.value = 'new';
            manualItemEntry.style.display = 'block';
            newItemNameInput.value = '';
            newItemUrlInput.value = '';
            addItemModal.style.display = 'flex';
            newItemNameInput.focus();
        };
        const closeAddItemModal = () => {
            addItemModal.style.display = 'none';
            currentAddItemTargetList = null;
        };
        const showAddBlockModal = () => {
            newBlockTitleInput.value = '';
            addBlockModal.style.display = 'flex';
            newBlockTitleInput.focus();
        };
        const closeAddBlockModal = () => {
            addBlockModal.style.display = 'none';
        };
        const populateLibraryManagementList = () => {
            libraryItemsList.innerHTML = ''; 
            if (globalItemLibrary.length === 0) {
                libraryItemsList.innerHTML = '<p style="text-align:center; color: var(--secondary-color);">項目庫是空的。</p>';
                return;
            }
            globalItemLibrary.forEach(item => {
                const itemEl = document.createElement('div');
                itemEl.className = 'library-item';
                itemEl.dataset.id = item.id;
                const itemColor = item.color || '#000000';
                itemEl.innerHTML = `
                    <div class="library-item-info" title="${item.name}\n${item.url || '無連結'}">
                        <strong style="color: ${itemColor};">${item.name}</strong>
                        <small>${item.url || '無連結'}</small>
                    </div>
                    <button class="delete-library-item" title="從庫中刪除">🗑️</button>
                `;
                libraryItemsList.appendChild(itemEl);
            });
        };
        const showManageLibraryModal = () => {
            populateLibraryManagementList();
            manageLibraryModal.style.display = 'flex';
        };
        const closeManageLibraryModal = () => {
            manageLibraryModal.style.display = 'none';
        };
        const handleAddToLibrary = (shouldClose) => {
            const name = libNewItemNameInput.value.trim();
            const url = libNewItemUrlInput.value.trim();
            const color = libNewItemColorInput.value;
            if (!name) {
                alert('顯示名稱不可為空！');
                return;
            }
            if (addItemToGlobalLibrary(name, url, color)) {
                libNewItemNameInput.value = '';
                libNewItemUrlInput.value = '';
                libNewItemNameInput.style.color = '#000000';
                libNewItemColorInput.value = '#000000';
                populateLibraryManagementList();
                if (shouldClose) {
                    closeManageLibraryModal();
                } else {
                    libNewItemNameInput.focus();
                }
            }
        };

        // --- 事件監聽器 (邏輯不變) ---
        mainContainer.addEventListener('click', (e) => {
            const target = e.target;
            const block = target.closest('.block');
            const item = target.closest('.item');
            if (target.matches('.block-title')) { makeEditable(target); }
            if (target.matches('.delete-block')) {
                if (confirm('確定要刪除這個區塊及其所有內容嗎？')) {
                    block.remove();
                    savePageContent();
                }
            }
            if (target.matches('.move-block-up')) { moveElement(block, 'up'); }
            if (target.matches('.move-block-down')) { moveElement(block, 'down'); }
            if (target.matches('.add-item-btn')) { showAddItemModal(target); }
            if (!item) return;
            if (target.matches('.edit-item')) { toggleItemEditView(item, true); }
            if (target.matches('.save-item-edit')) { saveItemEdit(target); }
            if (target.matches('.cancel-item-edit')) {
                const nameInput = item.querySelector('.edit-item-name');
                const urlInput = item.querySelector('.edit-item-url');
                const link = item.querySelector('.item-content a');
                nameInput.value = link.textContent;
                urlInput.value = link.href;
                toggleItemEditView(item, false);
            }
            if (target.matches('.delete-item')) {
                if (confirm('確定要刪除這個項目嗎？')) {
                    item.remove();
                    savePageContent();
                }
            }
            if (target.matches('.move-item-up')) { moveElement(item, 'up'); }
            if (target.matches('.move-item-down')) { moveElement(item, 'down'); }
        });
        itemLibrarySelect.addEventListener('change', () => {
            manualItemEntry.style.display = (itemLibrarySelect.value === 'new') ? 'block' : 'none';
            if (itemLibrarySelect.value === 'new') newItemNameInput.focus();
        });
        confirmAddItemBtn.addEventListener('click', () => {
            if (!currentAddItemTargetList) return;
            let name, url, color;
            if (itemLibrarySelect.value === 'new') {
                name = newItemNameInput.value.trim();
                url = newItemUrlInput.value.trim();
                color = null;
                if (!name) {
                    alert('請輸入顯示名稱！');
                    return;
                }
            } else {
                const selectedItem = JSON.parse(itemLibrarySelect.value);
                name = selectedItem.name;
                url = selectedItem.url;
                color = selectedItem.color;
            }
            createAndInsertItem(currentAddItemTargetList, name, url, color);
            closeAddItemModal();
        });
        cancelAddItemBtn.addEventListener('click', closeAddItemModal);
        editModeToggle.addEventListener('change', toggleEditMode);
        if(saveBtn) { saveBtn.addEventListener('click', saveAndDownload); }
        addBlockBtn.addEventListener('click', showAddBlockModal);
        pageTitle.addEventListener('click', () => makeEditable(pageTitle));
        pageTitle.addEventListener('input', () => {
            updatePageTitle(); 
            setTimeout(savePageContent, 500);
        });
        confirmAddBlockBtn.addEventListener('click', () => {
            let title = newBlockTitleInput.value.trim();
            if (!title) {
                alert('請輸入區塊標題！');
                return;
            }
            addBlock(title);
            closeAddBlockModal();
        });
        cancelAddBlockBtn.addEventListener('click', closeAddBlockModal);
        manageLibraryBtn.addEventListener('click', showManageLibraryModal);
        addToLibraryContinueBtn.addEventListener('click', () => handleAddToLibrary(false));
        addToLibraryCloseBtn.addEventListener('click', () => handleAddToLibrary(true));
        libraryItemsList.addEventListener('click', (e) => {
            if(e.target.matches('.delete-library-item')) {
                const itemEl = e.target.closest('.library-item');
                const itemId = itemEl.dataset.id;
                const itemText = itemEl.querySelector('strong').textContent;
                if (confirm(`確定要從全域項目庫中永久刪除 "${itemText}" 嗎？\n(這不會影響已新增到頁面上的項目)`)) {
                    globalItemLibrary = globalItemLibrary.filter(item => item.id !== itemId);
                    saveGlobalLibrary();
                    populateLibraryManagementList();
                }
            }
        });
        closeLibraryModalBtn.addEventListener('click', closeManageLibraryModal);
        libNewItemColorInput.addEventListener('input', () => {
            libNewItemNameInput.style.color = libNewItemColorInput.value;
        });

        // --- 頁面初始化 ---
        loadState();
        toggleEditMode();
    });
    </script>

</body></html>