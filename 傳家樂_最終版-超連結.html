<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ä¿å–®è³‡ç”¢ç®¡ç† - å‚³å®¶æ¨‚å®‰å…¨é˜²ç¦¦ç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=LXGW+WenKai+TC:wght@300;400;700&family=Noto+Sans+TC:wght@300;400;700&family=Noto+Serif+TC:wght@300;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style id="print-dynamic-style"></style>
    <style id="main-style">
        :root{--bg-color:#f3f4f6;--card-bg:#f9f6ea;--text-primary:#594a42;--font-title:'Noto Serif TC',serif;--font-body:'Noto Sans TC',sans-serif}body{background-color:var(--bg-color);background-image:radial-gradient(#e5e7eb 1px,transparent 1px);background-size:20px 20px;font-family:var(--font-body);color:var(--text-primary);overflow:hidden;position:fixed;width:100%;height:100%;touch-action:none;-webkit-user-select:none;user-select:none;overscroll-behavior:none}.font-title{font-family:var(--font-title)}.font-body{font-family:var(--font-body)}#toast-notification{position:fixed;bottom:80px;left:50%;transform:translateX(-50%) translateY(20px);background-color:rgba(45,42,38,.85);color:#fff;padding:10px 24px;border-radius:50px;font-size:.9rem;font-weight:500;opacity:0;pointer-events:none;transition:all .3s cubic-bezier(.2,.8,.2,1);z-index:2500;box-shadow:0 4px 15px rgba(0,0,0,0.15);backdrop-filter:blur(4px);font-family:'Noto Sans TC',sans-serif;letter-spacing:.05em}#toast-notification.show{opacity:1;transform:translateX(-50%) translateY(0)}.card-page-num{position:absolute;bottom:15px;right:20px;font-size:.9rem;font-weight:700;color:var(--text-primary);opacity:.4;font-family:'Noto Sans TC',monospace;z-index:50;pointer-events:none}#admin-btn{position:fixed;bottom:20px;right:20px;width:56px;height:56px;background:#2d2a26;border:3px solid #fff;border-radius:50%;display:none;align-items:center;justify-content:center;color:#fff;z-index:1000;cursor:pointer;box-shadow:0 4px 15px rgba(0,0,0,0.4);transition:all .3s}#admin-btn:hover{transform:scale(1.1);background:#4a453f}#admin-panel{position:fixed;top:0;left:0;width:100%;height:100%;background:0 0;z-index:2000;display:none;flex-direction:column;overflow:hidden;pointer-events:none}#admin-panel>*{pointer-events:auto}.admin-layout-container{pointer-events:none}.admin-editor,.admin-header,.admin-sidebar{pointer-events:auto}.admin-header{background:#fff;border-bottom:1px solid #e5e7eb;box-shadow:0 2px 10px rgba(0,0,0,0.05)}.admin-sidebar{background:#fff;border-right:1px solid #e5e7eb;overflow-y:auto;display:flex;flex-direction:column}.admin-editor{background:#f8f9fa;overflow-y:auto}.admin-card-item{padding:1rem;border-bottom:1px solid #f3f4f6;cursor:pointer;transition:background .2s;display:flex;justify-content:space-between;align-items:center}.admin-card-item:hover{background:#f9fafb}.admin-card-item.active{background:#eff6ff;border-left:4px solid #3b82f6}.form-label{display:block;font-size:.875rem;font-weight:500;color:#374151;margin-bottom:.25rem}.form-input{width:100%;padding:.5rem;border:1px solid #d1d5db;border-radius:.375rem;margin-bottom:1rem;font-family:'Noto Sans TC',sans-serif}.form-input:focus{outline:0;border-color:#3b82f6;ring:2px solid #93c5fd}.global-settings{background:#fff;border-bottom:1px solid #e5e7eb;padding:1rem;flex-shrink:0}.library-container{border:2px solid #e2e8f0;border-radius:8px;background:#fff;overflow:hidden;margin-bottom:24px}.lib-section-title{background:#f1f5f9;padding:8px 12px;font-size:.75rem;font-weight:700;color:#64748b;text-transform:uppercase;letter-spacing:.05em;border-bottom:1px solid #e2e8f0;display:flex;justify-content:space-between;align-items:center}.lib-area{padding:12px}.lib-area+.lib-section-title{border-top:1px solid #e2e8f0}.lib-item{padding:8px;border-bottom:1px solid #f1f5f9;font-size:.875rem;color:#4b5563;cursor:pointer;transition:all .2s;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.lib-item:hover{background-color:#f8fafc}.lib-item.active{background-color:#e0e7ff;color:#4338ca;font-weight:700;border-left:3px solid #4338ca}#card-stack{position:fixed;width:375px;height:660px;left:50%;top:50%;transform:translate(-50%,-50%);margin:0;z-index:100;transition:all .5s cubic-bezier(.2,.8,.2,1);touch-action:none;-webkit-user-select:none;user-select:none;will-change:transform}.card{position:absolute;top:0;left:0;width:100%;height:100%;background-color:var(--card-bg);box-shadow:0 4px 20px rgba(0,0,0,0.1);border:1px solid rgba(0,0,0,0.05);border-radius:12px;padding:2rem;display:flex;flex-direction:column;justify-content:center;align-items:center;cursor:grab;user-select:none;will-change:transform;transform-origin:50% 100%;overflow:hidden;touch-action:none;display:none}.card:active{cursor:grabbing}.card-sheen{position:absolute;top:0;left:0;width:100%;height:100%;background:linear-gradient(115deg,transparent 0,rgba(255,255,255,.4) 45%,rgba(255,255,255,0) 55%,transparent 100%);pointer-events:none;z-index:10;opacity:0;transition:opacity .5s ease-out;mix-blend-mode:screen}.card-content{position:relative;z-index:5;width:100%;height:100%;display:flex;flex-direction:column;justify-content:center;align-items:center;pointer-events:none}.back-btn{position:absolute;top:10px;left:10px;font-size:.7rem;font-family:'Noto Sans TC',sans-serif;font-weight:700;color:gray;background:rgba(255,255,255,.5);padding:2px 6px;border-radius:4px;cursor:pointer;z-index:50;text-transform:uppercase;letter-spacing:.05em;transition:all .2s;border:1px solid transparent;pointer-events:auto}.back-btn:hover{color:#333;background:rgba(255,255,255,.9);border-color:#ddd}a{pointer-events:auto}a.text-link{text-decoration:underline;text-decoration-style:dotted;text-underline-offset:4px;transition:all .2s}a.text-link:hover{opacity:.7}span[style*="color"]{display:inline}a[href]{cursor:pointer}.timeline-item{position:relative;padding-left:20px;border-left:2px solid currentColor;padding-bottom:20px}.timeline-item::before{content:'';position:absolute;left:-6px;top:5px;width:10px;height:10px;background:currentColor;border-radius:50%}.timeline-item:last-child{border-left:none}.grid-box{border:1px solid currentColor;padding:10px;border-radius:4px;text-align:center;pointer-events:auto}.key-value{display:flex;justify-content:space-between;border-bottom:1px dashed currentColor;padding:8px 0;width:100%}.bar-container{width:100%;display:flex;align-items:center;margin-bottom:8px;font-size:.8rem}.bar-label{width:30%;text-align:right;padding-right:10px;opacity:.8}.bar-track{flex:1;height:8px;background:rgba(0,0,0,0.05);border-radius:4px;overflow:hidden}.bar-fill{height:100%;background:currentColor;opacity:.7;border-radius:4px}.bar-value{width:15%;padding-left:8px;font-size:.7rem;opacity:.6}.custom-scrollbar{pointer-events:auto}.custom-scrollbar::-webkit-scrollbar{width:4px}.custom-scrollbar::-webkit-scrollbar-track{background:0 0}.custom-scrollbar::-webkit-scrollbar-thumb{background:rgba(0,0,0,0.1);border-radius:2px}.custom-scrollbar::-webkit-scrollbar-thumb:hover{background:rgba(0,0,0,0.2)}@media print{body{-webkit-print-color-adjust:exact;print-color-adjust:exact;background:#fff!important;background-image:none!important;overflow:visible!important;height:auto!important;position:relative!important;zoom:1!important}#add-page-btn,#admin-btn,#admin-panel,#close-admin-btn,#print-file-btn,#print-settings-modal,#save-file-btn,#start-overlay,#toast-notification,.back-btn,.card-sheen{display:none!important}#card-stack{position:static!important;width:100%!important;max-width:100%!important;height:auto!important;transform:none!important;display:grid!important;gap:20px;margin:0!important;padding:20px;top:auto!important;left:auto!important}.card{position:relative!important;width:100%!important;height:480px!important;top:auto!important;left:auto!important;transform:none!important;box-shadow:none!important;border:1px solid #ddd!important;page-break-inside:avoid;break-inside:avoid;margin-bottom:20px;background-color:var(--card-bg)!important;display:flex!important}.card-content{zoom:.9}a{text-decoration:none!important;color:inherit!important;pointer-events:none}}#password-section{opacity:0;transform:scale(.1) translateZ(-1000px);transition:all 2s cubic-bezier(.19,1,.22,1);display:none;pointer-events:none}#password-section.active{display:flex;opacity:1;transform:scale(1) translateZ(0);pointer-events:auto}#lock-message{display:none;flex-direction:column;align-items:center;gap:1rem;margin-top:2rem;animation:fadeIn .5s ease-in}#lock-text{cursor:default}@keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}#trigger-btn{transition:opacity .5s}#access-input{letter-spacing:.1em;text-align:center}#access-input::placeholder{font-size:.8rem;letter-spacing:0;color:#a8a29e}
    </style>
</head>
<body class="flex flex-col items-center justify-start h-screen w-screen overflow-hidden relative">
    <button id="admin-btn" title="é€²å…¥å¾Œå°ç·¨è¼¯"><i class="fas fa-cog text-2xl"></i></button>
    <div id="toast-notification">å·²ç¶“æ˜¯ç¬¬ä¸€é å›‰ï¼</div>
    
    <div id="print-settings-modal" class="fixed inset-0 bg-black/60 z-[3000] hidden flex items-center justify-center backdrop-blur-sm">
        <div class="bg-white rounded-lg shadow-2xl w-full max-w-[340px] overflow-hidden">
            <div class="bg-gray-800 text-white px-4 py-3 flex justify-between items-center"><h3 class="text-base font-bold flex items-center gap-2"><i class="fas fa-print"></i> åˆ—å° / PDF è¨­å®š</h3><button onclick="closePrintModal()" class="text-gray-400 hover:text-white transition"><i class="fas fa-times"></i></button></div>
            <div class="p-4 space-y-4"><div><label class="block text-xs font-bold text-gray-500 mb-2 uppercase tracking-wide">1. æª”æ¡ˆå„ªåŒ–</label><div class="grid grid-cols-2 gap-2"><label class="cursor-pointer border border-gray-200 rounded p-2 hover:border-blue-500 hover:bg-blue-50 transition flex flex-col items-center gap-1 group has-[:checked]:border-blue-600 has-[:checked]:bg-blue-50"><input type="radio" name="print_mode" value="original" class="hidden" checked=""><i class="fas fa-palette text-lg text-gray-400 group-has-[:checked]:text-blue-600"></i><span class="text-xs font-bold text-gray-700">ä¿æŒåŸæ¨£</span></label><label class="cursor-pointer border border-gray-200 rounded p-2 hover:border-red-600 hover:bg-red-600 transition flex flex-col items-center gap-1 group has-[:checked]:border-green-600 has-[:checked]:bg-green-50"><input type="radio" name="print_mode" value="compress" class="hidden"><i class="fas fa-font text-lg text-gray-400 group-hover:text-white group-has-[:checked]:text-green-600"></i><span class="text-xs font-bold text-gray-700 group-hover:text-white">è®Šæ›´å­—é«”</span></label></div></div><div><label class="block text-xs font-bold text-gray-500 mb-1 uppercase tracking-wide">2. æ’åˆ—æ–¹å¼</label><select id="print-layout" class="w-full border border-gray-300 rounded p-2 text-sm bg-white"><option value="2" selected="">ç›´å¼æ’åˆ— (2å¼µ/é )</option><option value="4">ç”°å­—æ’åˆ— (4å¼µ/é )</option></select></div></div>
            <div class="p-3 border-t bg-gray-50 flex justify-end gap-2"><button onclick="closePrintModal()" class="px-3 py-1.5 text-gray-500 hover:bg-gray-200 rounded text-xs font-medium transition">å–æ¶ˆ</button><button onclick="executePrint()" class="px-4 py-1.5 bg-blue-600 hover:bg-blue-700 text-white rounded text-xs font-bold shadow transition flex items-center gap-1"><i class="fas fa-print"></i> åˆ—å°</button></div>
        </div>
    </div>

    <div id="admin-panel" class="flex flex-row" style="display: none;">
        <div class="admin-header w-full h-16 flex justify-between items-center px-6 fixed top-0 left-0 z-50">
            <h2 class="text-xl font-bold text-gray-800 flex items-center gap-2"><i class="fas fa-edit text-blue-500"></i> 20æ¬¾ç‰ˆé¢ç·¨è¼¯å™¨</h2>
            <div class="flex gap-3"><button id="print-file-btn" class="bg-emerald-600 text-white px-4 py-2 rounded hover:bg-emerald-700 transition shadow-sm text-sm font-bold flex items-center"><i class="fas fa-print mr-2"></i> åˆ—å°è¨­å®š</button><div class="w-[1px] h-8 bg-gray-300 mx-2"></div><button id="save-file-btn" class="bg-indigo-600 text-white px-4 py-2 rounded hover:bg-indigo-700 transition shadow-sm text-sm font-bold flex items-center"><i class="fas fa-save mr-2"></i> å„²å­˜ä¸¦ä¸‹è¼‰æ–°æª”</button><div class="w-[1px] h-8 bg-gray-300 mx-2"></div><button id="add-page-btn" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition shadow-sm text-sm"><i class="fas fa-plus mr-1"></i> æ–°å¢é é¢</button><button id="close-admin-btn" class="bg-gray-800 text-white px-4 py-2 rounded hover:bg-black transition shadow-sm text-sm">é—œé–‰</button></div>
        </div>
        <div class="admin-layout-container flex w-full h-full pt-16">
            <div class="w-[35%] h-full hidden md:block"></div>
            <div class="admin-sidebar w-full md:w-[25%] h-full flex flex-col bg-white border-r border-gray-200 shadow-sm relative z-10"><div class="global-settings"><h4 class="text-xs font-bold text-gray-500 uppercase mb-3">ğŸ¨ å…¨å±€é¢¨æ ¼è¨­å®š</h4><div class="grid grid-cols-2 gap-2 mb-2"><div><label class="text-xs text-gray-400 block mb-1">ç´™å¼µé¡è‰²</label><input type="color" id="global-paper-color" class="w-full h-8 p-0 border rounded cursor-pointer" value="#f9f6ea"></div></div></div><div class="p-4 bg-gray-50 border-b text-xs font-bold text-gray-400 uppercase tracking-wider flex-shrink-0">é é¢åˆ—è¡¨</div><div id="page-list-container" class="flex-1 overflow-y-auto custom-scrollbar"></div><div class="p-4 border-t flex-shrink-0"><button id="reset-data-btn" class="text-red-400 hover:text-red-600 text-xs underline w-full text-center">æ¢å¾©åŸå§‹ç¯„ä¾‹</button></div></div>
            <div class="admin-editor flex-1 h-full p-8 overflow-y-auto border-l border-gray-100 bg-[#f8f9fa]"><div id="editor-empty" class="h-full flex flex-col items-center justify-center text-gray-400"><i class="fas fa-arrow-left text-4xl mb-4"></i><p>è«‹é»é¸å·¦å´é é¢é–‹å§‹ç·¨è¼¯</p></div><div id="editor-form" class="hidden w-full bg-white p-6 rounded-xl shadow-sm border border-gray-200"><div class="flex justify-between items-center mb-6 pb-4 border-b"><h3 class="text-lg font-bold text-gray-800">ç·¨è¼¯é é¢å…§å®¹</h3><span id="editing-id-display" class="text-xs text-gray-400 font-mono"></span></div><div class="grid grid-cols-2 gap-6"><div><label class="form-label">ç‰ˆå‹é¸æ“‡</label><select id="edit-type" class="form-input bg-gray-50 font-bold text-gray-700 text-sm"><optgroup label="åŠŸèƒ½é é¢"><option value="total_toc">â˜… è‡ªå‹•ç¸½ç›®éŒ„ (Auto TOC)</option><option value="cover">1. å°é¢ (Cover)</option><option value="intro">2. å‰è¨€/æ•˜è¿° (Intro)</option><option value="toc">3. æ‰‹å‹•ç›®éŒ„ (Manual Index)</option><option value="chapter">4. ç« ç¯€é  (Chapter)</option><option value="quote">5. é‡‘å¥ (Quote)</option></optgroup><optgroup label="æ¸…å–®èˆ‡æ¢åˆ—"><option value="standard">6. é …ç›®æ¸…å–® (Bullets)</option><option value="numbered">7. æ•¸å­—æ¸…å–® (1.2.3)</option><option value="checklist">8. æª¢æŸ¥è¡¨ (Checklist)</option><option value="grid">9. ç¶²æ ¼åœ–æ¨™ (Grid 4)</option><option value="grid3">10. ç¶²æ ¼åœ–æ¨™ (Grid 3)</option></optgroup><optgroup label="è³‡è¨Šåœ–è¡¨"><option value="stat">11. é—œéµæ•¸å­— (Big Stat)</option><option value="keyvalue">12. è¦æ ¼æ•¸å€¼ (Specs)</option><option value="chart">13. ç°¡æ˜“é•·æ¢åœ– (Chart)</option><option value="comparison">14. å°ç…§æ¯”è¼ƒ (VS)</option><option value="table">15. è¡¨æ ¼ (Table)</option></optgroup><optgroup label="æµç¨‹èˆ‡å…¶ä»–"><option value="timeline">16. å‚ç›´æ™‚é–“è»¸ (Timeline)</option><option value="process">17. æ©«å‘æµç¨‹ (Process)</option><option value="qa">18. å•èˆ‡ç­” (Q&A)</option><option value="warning">19. è­¦èª/æ³¨æ„ (Warning)</option><option value="contact">20. åç‰‡/çµå°¾ (Contact)</option></optgroup></select></div><div><label class="form-label">ä¸»é¡Œè‰²ç³»</label><div class="flex items-center gap-2"><input type="color" id="edit-color" class="h-[42px] w-[60px] cursor-pointer border rounded p-1"><span class="text-xs text-gray-400">é»æ“Šæ›´æ›æ–‡å­—èˆ‡è£é£¾é¡è‰²</span></div></div></div><div class="grid grid-cols-3 gap-6"><div class="col-span-2"><label class="form-label">ä¸»æ¨™é¡Œ</label><input type="text" id="edit-title" class="form-input font-bold mb-2" placeholder="è¼¸å…¥æ¨™é¡Œå…§å®¹..."><div class="flex items-center gap-2"><label class="text-xs text-gray-500">ç¸®æ”¾æ¯”ä¾‹ï¼š</label><select id="edit-title-scale" class="form-input w-32 mb-0 text-sm bg-gray-50 cursor-pointer font-mono text-center p-1 h-8 py-0"><option value="70">70%</option><option value="80">80%</option><option value="90">90%</option><option value="100">100%</option><option value="110">110%</option><option value="120">120%</option><option value="custom">è‡ªè¨‚ %...</option></select></div></div><div><label class="form-label">å´é‚Šæ¨™ç±¤/å°æ¨™</label><input type="text" id="edit-tag" class="form-input"></div></div><div class="library-container"><div class="lib-section-title text-green-700 bg-green-50 border-green-200 flex justify-between items-center"><span><i class="fas fa-plus-circle mr-1"></i> æ–°å¢è³‡æ–™åˆ°é¡Œåº«</span><button onclick="lib_add_new()" class="bg-green-600 text-white px-3 py-1 rounded text-xs font-bold shadow hover:bg-green-700 whitespace-nowrap"><i class="fas fa-save"></i> å­˜å…¥</button></div><div class="lib-area bg-green-50/30"><div class="flex flex-col gap-2"><div class="relative"><textarea id="lib-new-content" placeholder="è«‹åœ¨æ­¤è¼¸å…¥æˆ–è²¼ä¸Šæ–‡å­— (é‡è¤‡å…§å®¹å°‡è¢«æ‹’çµ•)..." class="w-full h-16 text-sm border border-gray-300 rounded p-2 focus:outline-none focus:border-green-500 resize-none font-mono"></textarea></div></div></div><div class="lib-section-title text-indigo-700 bg-indigo-50 border-indigo-200"><span><i class="fas fa-list-ul mr-1"></i> é¡Œåº«åˆ—è¡¨ (é»é¸ä»¥åç™½)</span></div><div class="lib-area bg-indigo-50/30"><div id="lib-list-container" class="bg-white border border-gray-300 rounded overflow-y-auto custom-scrollbar mb-2" style="height: 160px;"></div><div class="flex gap-2"><button onclick="lib_insert_at_cursor()" class="flex-1 bg-indigo-600 text-white px-3 py-2 rounded text-sm font-bold shadow hover:bg-indigo-700 transition flex items-center justify-center gap-2"><i class="fas fa-mouse-pointer"></i> æ’å…¥æ–‡å­—</button><button onclick="lib_delete()" class="flex-1 bg-white text-red-500 hover:bg-red-50 px-3 py-2 rounded border border-red-200 text-sm font-bold shadow-sm transition flex items-center justify-center gap-2" title="åˆªé™¤é¸ä¸­çš„é¡Œåº«"><i class="fas fa-trash-alt"></i> åˆªé™¤</button></div></div></div><label class="form-label flex justify-between items-end"><div>å…§å®¹ç·¨è¼¯ <span class="text-xs text-orange-500 ml-2">(èªæ³•ï¼šæ–‡å­—## é€£çµ | [link:..] | [color:..])</span></div><div class="flex items-center gap-2 bg-gray-100 px-2 py-1 rounded border border-gray-200"><button onclick="insertLink()" class="text-gray-600 hover:text-blue-600 hover:bg-white p-1 rounded transition" title="æ’å…¥è¶…é€£çµ"><i class="fas fa-link"></i></button><div class="w-[1px] h-4 bg-gray-300"></div><label class="flex items-center gap-1 cursor-pointer text-gray-600 hover:text-gray-900"><i class="fas fa-palette text-sm"></i><input type="color" id="text-color-picker" class="w-5 h-5 p-0 border-0 bg-transparent cursor-pointer" value="#000000" onchange="insertColorCode(this.value)"></label></div></label><div id="hint-text" class="text-xs font-normal text-gray-500 mt-1 bg-yellow-50 p-2 rounded border border-yellow-100 mb-2">æç¤ºå€</div><textarea id="edit-content" class="form-input h-48 font-mono text-sm leading-relaxed"></textarea><div class="flex justify-end pt-4 border-t mt-4 gap-3"><button id="delete-page-btn" class="px-4 py-2 text-red-500 hover:bg-red-50 rounded transition text-sm">åˆªé™¤æ­¤é </button><button id="apply-change-btn" class="px-6 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition shadow">ç¢ºèªä¿®æ”¹ (æš«å­˜)</button></div></div></div></div></div>

    <div id="start-overlay" class="fixed top-0 left-0 w-full h-full bg-[#fdfcf8] z-[1500] flex flex-col justify-center items-center transition-opacity duration-500" style="opacity: 1; display: flex;"><div class="text-center p-8 border-y border-stone-200"><h1 class="text-4xl font-bold text-stone-700 mb-2 tracking-widest font-title">ä¿å–®è³‡ç”¢ç®¡ç†</h1><p class="text-sm text-stone-400 tracking-[0.5em] font-body">20 STYLES COLLECTION</p></div><button id="trigger-btn" onclick="startPasswordAnimation()" class="mt-12 px-12 py-3 border border-stone-600 text-stone-600 hover:bg-stone-600 hover:text-white transition-all rounded-sm tracking-widest font-body">é–‹å§‹ç¿»é–±</button><div id="password-section" class="mt-8 flex flex-col items-center gap-4 w-full max-w-[280px]"><div class="relative w-full"><input type="password" id="access-input" placeholder="è«‹è¼¸å…¥å¯†ç¢¼" class="w-full px-4 py-3 border border-stone-300 rounded bg-[#fdfcf8] focus:border-stone-500 focus:ring-1 focus:ring-stone-500 outline-none transition text-stone-700 placeholder-stone-400"></div><button id="submit-pass-btn" onclick="checkPassword()" class="w-full px-8 py-3 bg-stone-700 text-white hover:bg-stone-900 transition-all rounded-sm tracking-widest font-body">ç¢ºèªé€²å…¥</button><p id="error-msg" class="text-red-500 text-xs tracking-wider opacity-0 transition-opacity">å¯†ç¢¼éŒ¯èª¤</p></div><div id="lock-message"><p id="lock-text" class="text-red-600 text-xl font-bold tracking-widest cursor-pointer select-none">éŒ¯èª¤å·²é”3æ¬¡ï¼Œæª”æ¡ˆé–ä½!</p></div></div>
    <div id="card-stack"></div>

    <script id="main-script">
        const _p_h = "7bdd7d4572d08b1edddb2ce6670399c525c21e64d853881037a0e9a48bb3d587";
        window.encryptedData = {"c":"01dbc0ada9fbb95cd716dd30f72e08819c626bb7a84e31fe4b8af9c0ca8b45481f8e2c62f083f560a395321df5e315944421d3923ad24604caae76ad9fbcb20ae1c0e26997ec808a13077620e12807075a7e3c06a718977f3a27bb0987db656a3166b84bb59f681eac8496d4d4596b167b270ff6075ae2d4f27cba3de8b1790445fef98e235c8eab5d735e5bc06e25b603081188b3a614e8f72ed434c51b52dfc5e7f74ea6625c84263fda53286245bf160c3c87585889c456c9f7c70616e628a3d0ca8185568826645976a96ae167960551538a53fc342895c5df0516bec17571c78162517632507d79e877cedc8a03d85557a0bcdb08a157da3f90c440d41b654f62f724b7daa28326bec67a5d5a98a75b98a196acc7f49b3b7395890fb62e315409070b612907061b39ce869ce23c2a9b54772ca34af8ed16bdfad96c17413dbf16c96459048deebbd5a6529df5313345183945fa48e2d79930d1652aa5243f178e14da31b6227c29c0517caf927361e886faa635484cc2357aecba260ff9e143dca52cfd597aa1622dee83a28a3d605320ef7590dc40225b05681325b9c5629ff6f84e502b3d16862b8466170224cde4e50f426850cefe37da60506c818edc5536c45e9fdafa281df980cfc4ea5bc064b01d3f82bb2b982d39c56ee0d06370e9e40f3335cba625fac4b6d9c4db44f1820d92c9421ea6ec23ddbabc3517bf44a364faee8325e6c3c8f28e933d517e42ba69f1f78401d802c83fbd56cfb956c9734b89dc64bd0ca410514ea1a549a66066d8b0e701a54e5c636c5e543dd3b3988c9902ff4c48667d2c1d149cff75e2ce75c8212b32f1c90fef081640bc3c8e5e75bf3e33442079a81cfb1a6ff919a773a57cbecb8e51878b4f2c357be6b980495787e3a802f140280cfb84ed8a9bcc0013c4b2a6c19336bee6b2900953648b0bbad500066a2c43413356e4e12ec3e44372138448b040a6db1c8fe5fe75c23852f332d74e76b60642865d6a12bddc3f91a2efd766595c64d21055e7e1df9cc0691a3cf6fddfd76fb6907ecabeee6ca794dbf4c5a316b6b39457737b64b9cff2a6c0f4bdd5c15521855aef7c81597b0d4ac6bedcbe79815557140473a052601525b3d21a202fe705cbf1692e945aa849b30e57f41451db7953d050622346284e7fc25ed79afdd587790eca493ef82e246e2c3a8372313ff83a49b24ec34b50b51fa4d854542b3fac9a1750aa35f344b8e40a7b1f0eaf0a6dd0c179249fdcbf7f2e0560b41ac07f2f924e3edbb86abe05c319aeba23d63260dabb796f4f1c16fd5a951375fc69da537c02369ea8050493bebafafb5fbe348b326a4873dc93732cf3037700baa99c3209016a84dd9e59fcc8855f154cc46c5dc5effb8f4ad9f03bd92ffd34d4dc83d3a73baa7c51fe72df4931d899ca76cf1e8769a8508f4f1c5f5e7e64353e023c5fcdfcce10b22638eb17e68d8b6239a277dfc87a745dc1a7bdcf8a4b50eea165261ba09c5a9606fad0c7801f4cb5da93a3629f54bc0d0c50d3b660e39557f988cb7de64c36c7f629d298606a760942f26bbc767725a77b2e99d0ba1b764de9afa06838fc7af06ba8771e6e2acf43f7cbec7ee631922a04d1ef6e89f29782081cb7e5f93fbf768e4cfcf3c369de1cdf7961afc544d2aef61c633dd25915fb6ff4df4db85dcc15f5db3d3549ae461d1f19a7c9ce90fa2c8715a33ed6315cc5cb4b2f2e1f5effea1ba9df3034cdf44dcab9430fbea6ff54c452b691c9ed8245586c901807f11cd25d67c2d03be87e0d8ec72f29fe2dff1484669dd6049f2ca3232db394767a14e27b866767ce913da1084c52ea0a3ad19c4042a03bb69155e65417ec93de07fe7a26172ffb5d2df1abb7c70bb1be7143568b7c283a8c1d4a99715a6b2d35939eb026d2180f51c6a7896cd86f163c237fba8377091884d32c60a63de69e321ae259dfb54bb4ba0db7a263541c65d783e21530b19123668a525722a2c2d5689ab4d2c10491978a035e790f411890f4b959f857afa15420550278dd053b1adf387039e1a914126319db8dcc82c42be26b64bc7843f39698f0c65fb795d01276963f01b5e1ccd0a4d0123763ce397123cbee8fecc1cda5ed7277116b41d6c892e8e662f126728456562f569bd4e45fcdeedafc8ebf8c3afc16769fdc7698be21e4a639e6891f899c959cba99df0c40a0fa9edd633d10fe02a86a45295efa55a38ea333663cb8499d371c979ce2a8e6da77c14e1f5acdf7593286a0925a70c89b8400e1a30e45076959eaef9088157abe0939f399addd10769916b0bc12b4579075186588b177d91bd3f555a570eb8d25d2c65840ce2fbcf91fca3c4085727bbeb1a9f47092ffa80af9e8536e15602b9929470b06d570547e4de49e6f1ba20d8282e697b4ed397c0c75835ec1b72c7ba2c5c8c0a590a7379d6486c2f0df73a855215160d71559af4f0a4bf4904a83994607b728fb0ae393f9ba5aa988270a79f67e904d2620215a10dac7d68b611e8632773f95422e5afd9d40d7eb9cee43ba513a7f7d8a4ca8d12b7566c26e61a6c0bf9ecbe37c2f19cf74f10cdcaacc7b55269d65f1059aa517bb08ea28755d425fe2249d859e835c071cce47ff632b7ec0183fc2f54d1d5c24f2a46699c8983e5f72bc8a39f918538b27730ae5055f266b9e645c6031065cbaeb56522309b18e5b747008b97915b69443aa539255a44ba3c704598e9cb0d816cba0909e939b2e01e0b08d31b975fda1216561858c81a9732ce0304e749673f8ec79b996b8fe7991bce0a174705b3e8d37f9e9400fd8a30de4144536b0ad24c5e3c0e58fbbe61ac2d6b4f46440628f575d62a3deb9661bd8b8075e1b20ba87645e1754dd9d2c68b509542a82381fc1e3d1d0eec011b07ddb74a08de145f793bb3217d447a73f4bd15f26f1d63db0a248d868cf1bdefbb29c4e87a708a2b22db12d7f0b7ec859117161c6a5aad11d8070dfc9659f187b3d1518d4edb2288a9dc0a6434d4aa73d786de2767de2dda3c97f3d5bf4ae9c4fc248630c90d7581123f6225ba63fd2d6a18aacf212713a46e5f34c1116566a2438ace7975bdb68439568564dbf56f63a68818a07a61528904a40d11ba684d313774ca40c106ee41feabe7ac7fa486ec9859cee0a588ee089840deed88def12ba7fd85b311bf54f7fc6c5b562bb780ce2d1909ad4621eb7a267f28939faa4c5bc8ae75bb46cc7d8026eafea2781f502d58f0c151c019114c8394e4f54ba5d38ba5cb2357fb253d8c878c1416e5d4c5e515bb8166a16786d2ddd7eedca3cad07d338f8e67a2817d98072aaa50677b0d9b63c6abc5e08729620e26305f52c2cd78bfd8a02c989ff3ea4548db2bd0428b1f5322605e25bef75529ec832bb1969f9916abf81c3753fb81acf6673c2fff33a53124e0da9e0a39d149cdf4928b0f6a21c38b99f621058d49e48ccddf6014b32d9df8d042cbfa112af7e1765852b6614de72db68c0d90a05d9d2c767d16cd5e49a189093bfc238efcb3f70746979b475971a270fba9c24fd9ca5bde2f4483975b9a42c3182b62fecedc2b2f5604b33d2c0709458dbad45a0213cd7e869d67fff592e78398c5c74f74d36730c9818f29f15e5332275e31355b0e5b4ea63352446a4bc79c9f7171152734b8fe5c4d7a3b4aa2cdbc13d14e434093cdaff82e5bfaefbeef3c2b6c7a413f1a18cefc44fdda4035fbd8e2e8c7042f957109b7b7d0f46c831475225041e3aaa4e8bc01ea070a0ca3834eb80c9aeef4eac2e18e75adf45d114b89c2d7cb21eaad86b5dff889a7db7565dcdf1b227cf80c52838e16d8ba7bf5a4288c21f533660a5f7d03762470c88b37b4312aad0391d62110a64c65bfec93a8256e4af9234d540742f75685f8d7690e2222bd045e3391760107b6562982fd81d0ed06fb721ea1afc29cb781a0d9c578d145da5ed5d279b30c577b1b03cfcbe747ebb4dcb3a4a4d10968e8a3946446efa60c2be632c9c982d5fc6579b385c8249c68d244416688e6bca73ece5855e6edb330d574d6553afda1e4e3f8c59bc7d690f8fc490fb62238b5cb4cbffd534a92a34f0b515e5213de4f3d5c3d8e84181a8ad5e65be4c574cdaa1d38cf906925997517384050a21b348c633ec543a326bfecdcc464a1c982c065b3c51bffac0f28180f46d09559ab4e94f0eca1f98a5b0c50f532ad5d0f27ccf149d2469b343d553b90cdc3769d404cc715f2fb7dbf06e958057ac630355b6f3764894cc04949f2ac9fa3d1ccf2717bf4457ed068a37de2e8f6f94c2fc8f82558eb5c4d78245b436f2602d59fe9e57c92e9d48355a2b11d4873cabc7eefcea79c4070ba023688eaac404ee47510453318131e1ad78da75cf4f7ca29a97a62a5f80210e38347a255549c174a40905180d9ec25792e68f3cf2a903d2c9a51626665c7a1b8f2bd4b3698bfa2f86b07b1c2b3645de8e4776fc78d443571545d1d98b0e52accbc85429fc4de4c2c90a0765cc73c84e9e685a7de5759669a050c515d1f790a1063bc78fa7dab8205e08eeb618d4cfaf9ab110c7f84f41d8a1913dd751b6aef996625e044fa10620e66b78ebd8f799ab83567143f09bb8ae779e26bd23922461a8dac92514438e1617c3548d011e129f229eea9ef18557572a2fc7ddc27e306ae4cc7f90939521f89ef290c8144374df3461ddd85d69be17f919ced91c91bdd982530c1b5fa6b09e0edd03b6cafd5548d78d738fd43570c7ffdca7386ec9b78f0b96a440584f81112bdccb194e9855d6f90954f27df56338bfbd4449c3aa9f191c1ae1b2c9d24a48a9244425e56fc43696cd32a5454657fbe010bbe7bc28ea2c4540012b0998413c95b8e5ffe4e17078a5dc1940b63be658c21e89ec1f6cd0452bc514bcbd21334a8568612798ffcb9b4bc70a648e520e2df6953ca1fc15aa27493128c284110bb16d0ad2b9816e51428f15d5c047d00d9d45df18930e5c6e307709ced746f7989a92a8d0ca6c468d61f16c5b7758e32e681326f05d86407d6ce966224ea293ef280042391086c3e73c4c857c66f2d10f46a91af159afffe0a7430d3d3f6445b5c702c6c6f4bb8b1f402bcf261ad11fc9066d05dd99338532d8e5c18176d23d92c3c7fe51bc65f1b7139d411c65787360f6d2aa433564547c0ffd2d513d8fdf65297b02b19ac864f3f727a56edd13adbf6ec95a5ccce751c3198f5728b967e87568d30a1d8a1e6be00d03fb33106166b6194cc8c5bff9f161822232a642ea9fe205cccd16fbd7d3bb24d6fd6cd5472ac69661e2738be1589d7438abb5394c07b67d926224278775f764ccbb70fbe70f30ed27674b04d2ba034feccef9cef5ef8e17d0dc264c1d0f10452808a615c5d6a049687f845518ef4fc5294ca03a8e70cde7a563bdce911aabb9479573640d71f4510ae41acbb4e6152a4d1f9052337e2ab08a36cc5e61e8dd73fc07b53cf67717eae05dc12b551bbd24960907a1d84a4e6538f0108043b5f86594ecf0e18245ebcfcd4f176440fa7e1a24047236bd643c616d79b34fbbb3887c81c4b32835d559b1f960d301d5c2952d9687492c5bd1f6f455b0c2736bf32da9133e5c9d7719d51a14a5f8a24c367c94a07ac1d8543e9274433d0e9468062fd0f63d28476ca837aecedecaff0c00b338fb43cdf0fd17b51252666ed7a7d3fa10ab8623cf9363bc2f434e02df2b8671fe0b9cbd0c3b130263c2e8f46925ed27c38de2ac2d525679109190c86bcb444179b2f72d412098e8cdd8a5c80761cae39c05294b5da63db5ebc99dd6b4bcff0b2754c93b64dd7ef4d87d67040f758751b9cacdc0ce5a59fd9351b280c2ffa95f3a5a766e221d71263451934a5751bf9af8d983a0b689bc9d6c0f08d2a28292246df6932a30d45d2709dc66faea4a1fdd8e285485333a22af7320c8654c9ecde51953b5a120c579007bc6703b0ada173d388eee26dea31c6d7ae76a60d959f08ba87fe7985579cd8eaedc9f9c79b377e56c038cfd96436442cd7e9509e6377b5045a987586ebe17c040cd40eb295ba26f8bec7fb0256515f189c5e82000309b7531236209356016d5ce9db9ab7cb083b73b23dc6c38060ba89fbebc6d59dca6c0082f0c338e40a0b3296ebcbeb595392944092ef7033f4276b7b3b14d07465aa4a838000ebb52b7930bee821b70ca94c41782b502523b79866228ce31b46d0a450df7c827d7ee7103daf57e86b189c3d693488553fcc878371d56ef21b04821945f30347afa9a9c668cef5ae65d2d2679dfe68256f6cf44d2ee1806decdc2ae711a05b4f583b77cbe090067510ec739a4fc6927ec5b561bb0a15273ccfb733462808a6fe2530715a947f3749d5bec2e312cde5cd40f692279b4b3f0a43db02430ce64cb536c9095fdd18fd83024c3d199ae6d07f6bbb1c610283fe74bd9ed1de5421afd6646640a087a379c80af7524d0d367430b74405c781aea7561156a5fee3f7903218ddcb3ee0def137de4ab0537191bd00387fe35a09490cae041f012130d63aa081fc70aeb5a11a36d359a1a6ab0a54568e45502267853a09a261d01f36f45bed7e63a589da8c75005e55361d10269d113005e11ef53c8c52d9e943a63453074549229b45ab79a5573b7f08efab7b37b3a6bc2edac09f5aff44e2ad26ed8eceb2a14516f303ea44d97f96f8712ef5a4bec92bf486548333a9b5e89da68bf26653721107e930c3f7a051a021bf41b7812774545c3c816034dcc8867bb41c5738b6630ba90eff8e6584f5a180fa3b53891f9cee6fccbd5d0ea9ec22299dd00d2642b5d77063f02389ace2ef30258bf3048a86cd7c2f426272def453b4600391bb5c7635f1786b2af0b0ad5bc0217227dc379094dab6048ab33dcd2ce170da62fb60d2a557f743be7b0050b3c0eb6c92dea7108748a2cd2ce32ba47e318187526557fd5bdcb36065b531a295b8a58712a1711a24e5925fa9147c4713a6808a19126f8875f67f9588b2e7cb2e11dcced535059ebcb80da3ed15b47c0d966ca97abdd6af0ff2864733a70096bb3adc029153c87d8ee06dca751602506d71ff5a4db90fcbba49315e8c081f78cbe37864954d41c27be103649ae64cc4000640b73ccc20307fc9a03a21bc9df27f80bbeaa46d77bd8bf1b31233c1115cd00215769c5d9f7d06547ee87d71c8b4ad1829dc9d3cf30740970529dd7038e059f4cd951b06c224f257b0efd4c63547530e75c2e1ce981ddfaee211c089f5712743f26597733a6a6a4817e58d659c22268589da2521cb3b3800b4e5beeed5decf27b05a2db377ce0e879279617940a190d45be876b7f7078fe5bbe9b7c250dbd4a018fdaa7ee030bc2fae7e8acf3148ef27f5547f3ebaed74540b404ae5b8d61e19d33fd27db4857ccc8d34af6bdde33b5af4f748633072062559afbfa58bafb5daff02b0e9f1160a64ef43f14c2bcf228f564c74b05a7f75a5fa5262deb92a0a1d3a60ad4dc779ece4aad0b5b8cbf250d71d8dc746d342670c9d8e8ea18c65cf2a9288e50a6d37d14674d2849a34c94fc44bb3ec171a1987d8f0c3396e31592ac10c9788cdd51b0104d5e9136af5dc9c8d28f1d398f3f77c29a8e7d77c728d0b0e5f388c99fa0443ddd84238d1c700b2e403a6d2d566efae50d4887e395ebc473ee4ab92321d049357d6d1f69a114250f8bf74e183667effc28746b9c565954b7d60650a3df028d084fbf408205408152b1977ed14d6543ddffa40e15dfdb30a5c3ebc408cef34d83ebb4b0c16c5066505e51db4dc54fde6010a6e8cbd02e4cbabf5866f98d657670068b46f445d145e2c9d2f5f815e9e7d858362b9d54cc33d7cb2865c4a3f3b7f5465ca28bf2b96418d8a69a2ea5426ef04dba471154ac9e5e1c9e48ff88b9c26118ba6f5f790e452f69ed6be9d71c063536857fb86a256302bb60a7e7c2512f6fc31387ddb421de30247d8a9613461c8747c5b0065b72642d9319423bd8ebfb423bab96bb8eda47c940ffb875a7a937ce67cf669eaee3ad8d9f3afb91b226c6a1f1a9363039a1fad1695d892d58e264357a6a5130b8b9b5d2cb9097eee0ff9ab99e38533a41b318c40590948a4cb9bbd7d047504c295b66d2adc12cee2f78ecf65530d96a1a7c488402f3a027d9b66d6a17f8f895e0bac0f889a5b256dcfad401bde403401b5ffae409d41f95f149cef2120940c8aa03b1f08f633479859abdf5b4ee4435f540ea006df6d2ecf9eecae4b155ce61afacedb50a8c6c4f81caffa3f567a4776b83f43364d0c3ab4e1b4663e007e3eeed1dcb54cfe398310aec94420f59cd669a4149aae1d2ab93408685ab578c8c2cfb671cd9e59a32017ba547a3ae74ae87a45ff47b7bbe9a47e1d647d100bb96999f1f0f8863034ef77f7622b6e98bd3f26c3edb6b23aa769a0f363fa5b9b1e56a55fae5beb25868eba9ca0f20e6d93e1843ac2537fcb4181746322cc5f5a1d9370a17aa02f8108d83bbf511c0d25ba26baa4294930b837027c2a47871fe6c9ca6ca2a15458c7bb1a4565ddbf6af35c50498b4ff3274a33a943e1ff140036cede4b92ec79346e93a8dc91f77d74bde94bbd9b631c17b053ff9493572feb49e5205acf74ca09958ec555835b04df72707ff6a912dc7f0a5d1f6e7726469faf5e4bdd1da79bd4f8d9615cbf48463e690c11fba05bacdb976d21d9d7e28ee81effd26fcf7c8","s":"c40e94ac66e4c1d1995fac6ad0f07740","i":"1b0b376fd127c186097da159"};
        
        let isVIP=false,passwordAttempts=0,unlockClickCount=0;const MAX_ATTEMPTS=3;
        window.bakedData=null;let cardsData=[],styleConfig={},textLibrary=[];
        const defaultStyle={fontTitle:"'Noto Serif TC', serif",fontBody:"'Noto Sans TC', sans-serif",paperColor:"#f9f6ea",textureOpacity:"0.5"};
        let currentScaleFactor=1,viewingStartIndex=0,currentEditId=null,selectedLibIndex=-1;
        const hex2buf=(h)=>new Uint8Array(h.match(/.{1,2}/g).map(b=>parseInt(b,16)));
        
        async function checkPassword(){
            if(passwordAttempts>=MAX_ATTEMPTS)return;
            const input=document.getElementById('access-input').value.trim();
            const errorMsg=document.getElementById('error-msg');
            const enc=new TextEncoder();
            if(!input)return;
            try{
                const hBuf=await window.crypto.subtle.digest("SHA-256",enc.encode(input));
                const hHex=[...new Uint8Array(hBuf)].map(x=>x.toString(16).padStart(2,'0')).join('');
                if(hHex===_p_h){
                    await decryptAndLoad(input);
                    passwordAttempts=0;
                    document.getElementById('start-overlay').style.opacity=0;
                    setTimeout(()=>document.getElementById('start-overlay').style.display='none',500);
                    isVIP=true;
                }else{throw new Error("Password mismatch");}
            }catch(e){
                passwordAttempts++;errorMsg.innerText=`å¯†ç¢¼éŒ¯èª¤ ${passwordAttempts} æ¬¡`;errorMsg.style.opacity=1;
                document.getElementById('access-input').value='';document.getElementById('access-input').focus();
                if(passwordAttempts>=MAX_ATTEMPTS)lockSystem();
            }
        }
        async function decryptAndLoad(p){
            try{
                if(!window.encryptedData){alert("No data");return;}
                const d=window.encryptedData;
                const enc=new TextEncoder();
                const kMat=await window.crypto.subtle.importKey("raw",enc.encode(p),{name:"PBKDF2"},false,["deriveKey"]);
                const key=await window.crypto.subtle.deriveKey({"name":"PBKDF2",salt:hex2buf(d.s),iterations:100000,hash:"SHA-256"},kMat,{"name":"AES-GCM",length:256},true,["decrypt"]);
                const decBuf=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:hex2buf(d.i)},key,hex2buf(d.c));
                window.bakedData=JSON.parse(new TextDecoder().decode(decBuf));
                initData();
            }catch(e){alert("Decryption failed");console.error(e);}
        }
        
        function initData(){
            if(window.bakedData){cardsData=window.bakedData.cards||[];styleConfig=window.bakedData.style||defaultStyle;textLibrary=window.bakedData.library||[];}else{return;}
            applyStyles();
            renderCards();
            initStackInteraction(); 
            renderSidebar();initAdminUI();renderLibraryList();adjustLayout();
        }
        function adjustLayout(){const w=window.innerWidth,h=window.innerHeight,s=document.getElementById('card-stack'),ap=document.getElementById('admin-panel');if(ap.style.display==='flex'){const lc=w*0.35,sc=Math.min((lc*0.85)/360,0.8);s.style.left=(lc/2)+'px';s.style.top=(h*0.55)+'px';s.style.transform=`translate(-50%, -50%) scale(${sc})`;currentScaleFactor=sc;return;}const isP=h>w,sc=isP?(w*0.96)/375:Math.min((h*0.95)/660,1.2);currentScaleFactor=Math.max(0.6,Math.min(sc,2.0));s.style.left='50%';s.style.top='50%';s.style.transform=`translate(-50%, -50%) scale(${currentScaleFactor})`;}
        window.addEventListener('resize',adjustLayout);
        function applyStyles(){document.documentElement.style.setProperty('--card-bg',styleConfig.paperColor);document.getElementById('global-paper-color').value=styleConfig.paperColor;}
        function updateMemoryState(){applyStyles();renderCards();renderSidebar();}
        function startPasswordAnimation(){document.getElementById('trigger-btn').style.opacity='0';document.getElementById('trigger-btn').style.pointerEvents='none';const ps=document.getElementById('password-section');ps.style.display='flex';setTimeout(()=>{ps.classList.add('active');setTimeout(()=>{const i=document.getElementById('access-input');if(i.style.display!=='none')i.focus();},2000);},50);}
        function lockSystem(){document.getElementById('password-section').style.display='none';document.getElementById('password-section').classList.remove('active');document.getElementById('lock-message').style.display='flex';}
        document.getElementById('lock-text').addEventListener('click',function(e){e.preventDefault();unlockClickCount++;if(unlockClickCount>=5){unlockClickCount=0;passwordAttempts=0;document.getElementById('lock-message').style.display='none';document.getElementById('error-msg').style.opacity=0;document.getElementById('access-input').value='';startPasswordAnimation();}});
        document.getElementById('access-input').addEventListener('keypress',function(e){if(e.key==='Enter')checkPassword();});
        function renderCards(){const c=document.getElementById('card-stack');c.innerHTML='';cardsData.forEach((d,i)=>{const card=document.createElement('div');card.className='card';if(d.type==='total_toc')card.classList.add('print-full-page');card.style.setProperty('--text-color',d.color||'#594a42');card.style.color='var(--text-color)';let inner=`<div class="card-sheen"></div><div class="card-content w-full h-full relative"><div class="card-page-num">${i+1}</div>`;if(d.type!=='total_toc')inner+=`<button onclick="jumpToTOC()" class="back-btn" title="Back">back</button>`;if(!['cover','chapter','total_toc'].includes(d.type))inner+=`<div class="absolute top-6 right-6 writing-vertical text-xs tracking-widest opacity-50 border-l border-current pl-2" style="writing-mode: vertical-rl; border-color: var(--text-color);">${d.tag||''}</div>`;
        const parseLink=s=>{if(!s)return{text:'',url:'#'};const p=s.split('##');let t=p[0].trim().replace(/\[link:(.*?)\](.*?)\[\/link\]/g,'<a href="$1" target="_blank" style="text-decoration:underline;">$2</a>').replace(/\[color:(.*?)\](.*?)\[\/color\]/g,'<span style="color:$1">$2</span>');return{text:t,url:p[1]?p[1].trim():null};};
        const getTitle=t=>`<span style="font-size:${d.titleScale||'100'}%">${t}</span>`;
        switch(d.type){
            case 'total_toc':inner+=`<div class="w-full h-full flex flex-col pt-16 px-8 overflow-hidden"><h2 class="text-2xl font-bold mb-6 tracking-widest text-center font-title border-b border-current pb-4">${getTitle(d.title)}</h2><div class="overflow-y-auto pr-2 space-y-3 h-full custom-scrollbar">`+cardsData.map((c,x)=>c.id===d.id?'':`<div onclick="jumpToCard('${c.id}')" class="cursor-pointer border-b border-dotted border-current/30 pb-1 hover:bg-black/5 transition flex justify-between items-end"><span class="text-sm font-bold opacity-80 truncate mr-2">${c.title||'ç„¡æ¨™é¡Œ'}</span><span class="text-xs opacity-50 font-mono">P.${x+1}</span></div>`).join('')+`</div></div>`;break;
            case 'cover':{const{text,url}=parseLink(d.content);inner+=`<div class="flex flex-col items-center justify-center h-full text-center px-4"><div class="mb-4 text-xs tracking-[0.4em] opacity-60 border-b border-current pb-2" style="border-color: var(--text-color);">${d.tag||'COVER'}</div><h1 class="text-5xl font-bold mb-6 tracking-widest leading-snug font-title">${getTitle(d.title)}</h1><div class="w-12 h-1 bg-current opacity-20 mb-8"></div><p class="text-xl font-serif italic tracking-widest opacity-80 whitespace-pre-wrap font-body">${url?`<a href="${url}" target="_blank" class="text-link">${text}</a>`:text}</p></div>`;break;}
            case 'intro':inner+=`<div class="w-full h-full flex flex-col pt-16 px-8"><h2 class="text-3xl font-bold mb-8 tracking-widest font-title">${getTitle(d.title)}</h2><div class="text-base leading-loose text-left opacity-90 whitespace-pre-wrap font-body">${parseLink(d.content).text}</div></div>`;break;
            case 'toc':inner+=`<div class="w-full h-full flex flex-col pt-16 px-8"><h2 class="text-2xl font-bold mb-10 tracking-widest border-b border-current pb-4 text-center font-title">${getTitle(d.title)}</h2><div class="space-y-4 font-body">`+(d.list||[]).map(l=>{const{text,url}=parseLink(l);return`<div class="flex items-end"><span class="font-bold opacity-80">${text}</span><div class="flex-grow border-b-2 border-dotted border-current opacity-30 mx-2 mb-1"></div><span class="font-serif opacity-60">${url||''}</span></div>`}).join('')+`</div></div>`;break;
            case 'chapter':inner+=`<div class="w-full h-full flex flex-col items-center justify-center relative overflow-hidden"><div class="absolute text-[200px] font-serif opacity-5 select-none" style="top:50%; left:50%; transform:translate(-50%, -50%);">${d.tag}</div><h2 class="text-sm tracking-[0.5em] mb-4 opacity-60 uppercase">CHAPTER ${d.tag}</h2><h1 class="text-4xl font-bold tracking-widest font-title border-y-2 border-current py-6 px-4">${getTitle(d.title)}</h1><p class="mt-6 tracking-widest opacity-60">${parseLink(d.content).text}</p></div>`;break;
            case 'quote':inner+=`<div class="flex flex-col items-center justify-center h-full text-center px-8"><i class="fas fa-quote-left text-3xl opacity-20 mb-6"></i><h2 class="text-2xl font-serif leading-loose tracking-widest opacity-90 whitespace-pre-wrap font-title">${parseLink(d.content).text}</h2><div class="mt-8 w-full text-right font-bold opacity-60 text-sm"><span>â€” ${getTitle(d.title)}</span></div></div>`;break;
            case 'standard':inner+=`<div class="w-full h-full flex flex-col pt-16 px-8"><h2 class="text-3xl font-bold mb-10 tracking-widest font-title decoration-wavy underline decoration-current/30 underline-offset-8">${getTitle(d.title)}</h2><ul class="space-y-5 font-body">`+(d.list||[]).map(l=>`<li class="flex items-start"><span class="mr-3 mt-2 w-1.5 h-1.5 rounded-full bg-current opacity-60 flex-shrink-0"></span><span class="text-lg opacity-90 leading-relaxed">${parseLink(l).text}</span></li>`).join('')+`</ul></div>`;break;
            case 'numbered':inner+=`<div class="w-full h-full flex flex-col pt-14 px-6"><h2 class="text-2xl font-bold mb-8 tracking-widest font-title border-b border-current pb-2">${getTitle(d.title)}</h2><div class="space-y-6">`+(d.list||[]).map((l,i)=>`<div class="flex items-start gap-4"><div class="w-8 h-8 rounded-full border border-current flex items-center justify-center flex-shrink-0 font-serif font-bold opacity-80">${i+1}</div><div class="pt-1 text-lg opacity-90 font-body">${parseLink(l).text}</div></div>`).join('')+`</div></div>`;break;
            case 'checklist':inner+=`<div class="w-full h-full flex flex-col pt-16 px-8"><h2 class="text-2xl font-bold mb-8 tracking-widest font-title text-center bg-black/5 py-2 rounded">${getTitle(d.title)}</h2><div class="space-y-4">`+(d.list||[]).map(l=>`<div class="flex items-center gap-3 p-2 border-b border-current/20"><i class="far fa-check-square text-xl opacity-60"></i><span class="text-lg opacity-90">${parseLink(l).text}</span></div>`).join('')+`</div></div>`;break;
            case 'grid':inner+=`<div class="w-full h-full flex flex-col pt-16 px-4"><h2 class="text-2xl font-bold mb-8 tracking-widest opacity-90 text-center font-title">${getTitle(d.title)}</h2><div class="grid grid-cols-2 gap-4 w-full">`+(d.list||[]).map(l=>{const{text,url}=parseLink(l);return`<div class="grid-box h-24 flex items-center justify-center cursor-pointer hover:bg-black/5" onclick="${url?`window.open('${url}')`:''}"><span class="font-bold text-lg opacity-80 font-body">${text}</span></div>`}).join('')+`</div></div>`;break;
            case 'grid3':inner+=`<div class="w-full h-full flex flex-col pt-16 px-4"><h2 class="text-2xl font-bold mb-6 tracking-widest opacity-90 text-center font-title">${getTitle(d.title)}</h2><div class="grid grid-cols-2 gap-3 w-full">`+(d.list||[]).map(l=>`<div class="border border-current rounded p-3 text-center flex items-center justify-center aspect-[4/3]"><span class="font-bold opacity-80 leading-tight">${parseLink(l).text}</span></div>`).join('')+`</div></div>`;break;
            case 'stat':{const p=d.content.split('##');inner+=`<div class="w-full h-full flex flex-col items-center justify-center px-6"><h3 class="text-xl tracking-widest opacity-60 mb-6 uppercase">${getTitle(d.title)}</h3><div class="text-6xl font-bold font-serif mb-4 tracking-tighter">${p[0]}</div><div class="text-lg opacity-80 font-body bg-current text-white px-4 py-1 rounded-full" style="background-color: var(--text-color);">${p[1]||''}</div></div>`;break;}
            case 'keyvalue':inner+=`<div class="w-full h-full flex flex-col justify-center px-6"><h2 class="text-center text-2xl font-bold mb-10 tracking-widest opacity-90 font-title">${getTitle(d.title)}</h2><div class="space-y-4 w-full">`+(d.list||[]).map(l=>{const{text,url}=parseLink(l);return`<div class="key-value"><span class="text-lg font-medium opacity-80 w-full flex justify-between font-body">${text}<span class="font-bold">${url||''}</span></span></div>`}).join('')+`</div></div>`;break;
            case 'chart':{const mv=Math.max(...(d.list||[]).map(l=>parseFloat(l.split('##')[1])||0));inner+=`<div class="w-full h-full flex flex-col pt-16 px-6"><h2 class="text-2xl font-bold mb-8 tracking-widest text-center font-title">${getTitle(d.title)}</h2><div class="flex-1 flex flex-col justify-center">`+(d.list||[]).map(l=>{const p=l.split('##');return`<div class="bar-container"><div class="bar-label font-bold">${p[0]}</div><div class="bar-track"><div class="bar-fill" style="width: ${(parseFloat(p[1])||0)/mv*100}%"></div></div><div class="bar-value">${parseFloat(p[1])||0}</div></div>`}).join('')+`</div></div>`;break;}
            case 'comparison':inner+=`<div class="w-full h-full flex flex-col pt-14 px-4"><h2 class="text-2xl font-bold mb-6 tracking-widest text-center font-title">${getTitle(d.title)}</h2><div class="flex-1 border-t-2 border-b-2 border-current py-4 overflow-hidden"><div class="grid grid-cols-2 h-full divide-x divide-current/30"><div class="px-2 space-y-4 text-center"><div class="font-bold text-sm opacity-50 mb-2">ä¸€èˆ¬æ–¹æ¡ˆ</div>`+(d.list||[]).map(l=>`<div class="text-sm py-2 border-b border-dotted border-current/20 h-16 flex items-center justify-center">${parseLink(l.split('##')[0]).text}</div>`).join('')+`</div><div class="px-2 space-y-4 text-center"><div class="font-bold text-sm opacity-50 mb-2">æœ¬æ–¹æ¡ˆ</div>`+(d.list||[]).map(l=>`<div class="text-sm font-bold py-2 border-b border-dotted border-current/20 h-16 flex items-center justify-center">${parseLink(l.split('##')[1]||'').text}</div>`).join('')+`</div></div></div></div>`;break;
            case 'table':inner+=`<div class="w-full h-full flex flex-col pt-16 px-6"><h2 class="text-2xl font-bold mb-6 tracking-widest text-center font-title">${getTitle(d.title)}</h2><table class="w-full text-sm border-collapse"><thead><tr class="border-b-2 border-current"><th class="py-2 text-left w-1/2">é …ç›®</th><th class="py-2 text-right">å…§å®¹</th></tr></thead><tbody>`+(d.list||[]).map(l=>{const p=l.split('##');return`<tr class="border-b border-current/10"><td class="py-3 font-bold opacity-80">${parseLink(p[0]).text}</td><td class="py-3 text-right opacity-90">${parseLink(p[1]||'').text}</td></tr>`}).join('')+`</tbody></table></div>`;break;
            case 'timeline':inner+=`<div class="w-full h-full flex flex-col pt-14 px-8"><h2 class="text-2xl font-bold mb-8 tracking-widest opacity-90 border-b border-current pb-2 font-title">${getTitle(d.title)}</h2><div class="pl-2">`+(d.list||[]).map(l=>`<div class="timeline-item"><div class="font-bold text-lg opacity-90 font-body">${parseLink(l).text}</div></div>`).join('')+`</div></div>`;break;
            case 'process':inner+=`<div class="w-full h-full flex flex-col pt-16 px-6"><h2 class="text-2xl font-bold mb-10 tracking-widest text-center font-title">${getTitle(d.title)}</h2><div class="flex-1 flex flex-col gap-4">`+(d.list||[]).map((l,i)=>`<div class="flex items-center"><div class="w-full border border-current rounded p-3 text-center font-bold relative">${parseLink(l).text}${i<(d.list.length-1)?`<div class="absolute -bottom-5 left-1/2 -translate-x-1/2 text-current"><i class="fas fa-arrow-down"></i></div>`:''}</div></div>${i<(d.list.length-1)?`<div class="h-4"></div>`:''}`).join('')+`</div></div>`;break;
            case 'qa':inner+=`<div class="w-full h-full flex flex-col pt-14 px-6"><h2 class="text-2xl font-bold mb-6 tracking-widest text-center font-title decoration-4 underline decoration-current/20">${getTitle(d.title)}</h2><div class="space-y-6 overflow-y-auto">`+(d.list||[]).map(l=>{const p=l.split('##');return`<div><div class="font-bold text-lg mb-1 flex gap-2"><span class="opacity-50">Q.</span><span>${parseLink((p[0]||'').replace('Q:','').trim()).text}</span></div><div class="text-sm opacity-80 pl-6 border-l-2 border-current/30 ml-1 py-1">${parseLink((p[1]||'').replace('A:','').trim()).text}</div></div>`}).join('')+`</div></div>`;break;
            case 'warning':inner+=`<div class="w-full h-full flex flex-col justify-center px-6"><div class="border-2 border-current p-6 relative"><span class="absolute -top-3 left-4 bg-[#f9f6ea] px-2 font-bold tracking-widest text-sm opacity-80 font-title" style="background-color: var(--card-bg);">${getTitle(d.title)}</span><ul class="list-disc pl-5 space-y-3 opacity-80 font-medium font-body text-sm leading-relaxed">`+(d.list||[]).map(l=>`<li>${parseLink(l).text}</li>`).join('')+`</ul></div></div>`;break;
            case 'contact':{const{text,url}=parseLink(d.content);inner+=`<div class="w-full h-full flex flex-col items-center justify-center px-6 text-center"><div class="w-20 h-20 rounded-full border-2 border-current flex items-center justify-center mb-6 text-3xl opacity-80"><i class="fas fa-user"></i></div><h2 class="text-2xl font-bold mb-6 tracking-widest font-title">${getTitle(d.title)}</h2><p class="text-lg opacity-80 whitespace-pre-wrap leading-loose font-body">${url?`<a href="${url}" target="_blank" class="text-link">${text}</a>`:text}</p></div>`;break;}
        }
        inner+=`</div>`;card.innerHTML=inner;card.style.touchAction="none";
        if(i===viewingStartIndex){card.style.display='flex';card.style.transform='scale(1)';card.style.opacity=1;card.style.zIndex=100;card.style.pointerEvents='auto';}else if(i>viewingStartIndex&&i-viewingStartIndex===1){card.style.display='flex';card.style.transform='scale(0.98)';card.style.opacity=0.5;card.style.zIndex=99;card.style.pointerEvents='none';}else{card.style.display='none';}c.appendChild(card);});
        
        const ab=document.getElementById('admin-btn');if(cardsData[viewingStartIndex]&&(cardsData[viewingStartIndex].type==='warning'||cardsData[viewingStartIndex].title.includes('é‡è¦è²æ˜')))ab.style.display='flex';else ab.style.display='none';}
        
        function initStackInteraction(){
            const stack = document.getElementById('card-stack');
            if(stack._handleDown) stack.removeEventListener('pointerdown', stack._handleDown);

            let isDragging = false, startX = 0, currentX = 0, activeCard = null;

            const handleDown = (e) => {
                if(e.target.closest('a') || e.target.closest('button') || e.target.closest('.cursor-pointer')) return;
                
                const allCards = document.querySelectorAll('.card');
                if(!allCards[viewingStartIndex]) return;
                
                activeCard = allCards[viewingStartIndex];

                if(!activeCard.contains(e.target)) return;

                isDragging = true;
                startX = e.clientX;
                activeCard.style.transition = 'none';
                try{ activeCard.setPointerCapture(e.pointerId); } catch(err){}
                
                document.addEventListener('pointermove', handleMove);
                document.addEventListener('pointerup', handleUp);
                document.addEventListener('pointercancel', handleUp);
            };

            const handleMove = (e) => {
                if(!isDragging || !activeCard) return;
                e.preventDefault(); 
                
                const tx = (e.clientX - startX) / currentScaleFactor;
                
                if(viewingStartIndex === 0 && tx > 50) return;
                if(viewingStartIndex === cardsData.length - 1 && tx < -50) return;
                
                currentX = tx;
                if(Math.abs(currentX) > 0) {
                    activeCard.style.transform = `translateX(${currentX}px) rotate(${currentX * 0.05}deg)`;
                }
            };

            const handleUp = (e) => {
                if(!isDragging || !activeCard) return;
                isDragging = false;
                
                document.removeEventListener('pointermove', handleMove);
                document.removeEventListener('pointerup', handleUp);
                document.removeEventListener('pointercancel', handleUp);
                
                activeCard.style.transition = 'transform 0.6s cubic-bezier(0.2, 0.8, 0.2, 1)';
                
                if(Math.abs(currentX) > 80) {
                    const dir = currentX > 0 ? 1 : -1; 
                    activeCard.style.transform = `translateX(${dir === 1 ? 1200 : -1200}px) rotate(${dir * 15}deg)`;
                    setTimeout(() => changePage(dir), 200);
                } else {
                    activeCard.style.transform = 'translate(0,0)';
                }
                currentX = 0;
                activeCard = null;
            };

            stack._handleDown = handleDown;
            stack.addEventListener('pointerdown', handleDown);
        }
        
        window.changePage=d=>{const n=viewingStartIndex-d;if(n<0||n>=cardsData.length)return;viewingStartIndex=n;renderCards();};
        window.jumpToCard=id=>{const i=cardsData.findIndex(c=>c.id===id);if(i!==-1){viewingStartIndex=i;renderCards();}};
        window.jumpToTOC=()=>{const t=cardsData.find(c=>c.type==='total_toc');if(t)jumpToCard(t.id);};
        function initAdminUI(){
            document.getElementById('global-paper-color').addEventListener('input',e=>{styleConfig.paperColor=e.target.value;applyStyles();});
            document.getElementById('admin-btn').onclick=()=>{if(isVIP)openAdmin();else{alert("è«‹å…ˆè§£é–");}};
            document.getElementById('close-admin-btn').onclick=()=>{document.getElementById('admin-panel').style.display='none';adjustLayout();};
            document.getElementById('add-page-btn').onclick=()=>{cardsData.push({id:'c_'+Date.now(),type:'standard',title:'æ–°é é¢',tag:'NEW',list:['å…§å®¹...']});updateMemoryState();};
            document.getElementById('reset-data-btn').onclick=()=>{if(confirm('é‡ç½®?'))location.reload();};
            document.getElementById('delete-page-btn').onclick=()=>{if(confirm('åˆªé™¤?')){cardsData=cardsData.filter(c=>c.id!==currentEditId);viewingStartIndex=Math.max(0,viewingStartIndex-1);updateMemoryState();showEditor(false);}};
            document.getElementById('apply-change-btn').onclick=applyEdit;
            document.getElementById('edit-title-scale').addEventListener('change',function(){if(this.value==='custom'){const v=prompt("æ¯”ä¾‹?");if(v){this.add(new Option(v+'%',v),this.lastChild);this.value=v;}applyEdit();}});
            document.getElementById('print-file-btn').onclick=()=>document.getElementById('print-settings-modal').classList.remove('hidden');
            window.closePrintModal=()=>document.getElementById('print-settings-modal').classList.add('hidden');
            window.executePrint=()=>{window.print();closePrintModal();};
            document.getElementById('save-file-btn').onclick=()=>{alert("âš ï¸ å®‰å…¨æç¤ºï¼šæ­¤ç‚ºæœ€çµ‚äº¤ä»˜ç‰ˆï¼Œåƒ…ä¾›ç€è¦½ã€‚å¦‚éœ€ä¿®æ”¹ï¼Œè«‹ä½¿ç”¨åŸå§‹ç·¨è¼¯å™¨ã€‚");};
        }
        function openAdmin(){document.getElementById('admin-panel').style.display='flex';renderSidebar();adjustLayout();showEditor(false);}
        function renderSidebar(){const l=document.getElementById('page-list-container');l.innerHTML='';cardsData.forEach((c,i)=>{const d=document.createElement('div');d.className=`admin-card-item ${c.id===currentEditId?'active':''}`;d.onclick=()=>selectCard(c.id);d.innerHTML=`<span class="bg-gray-200 text-xs w-6 h-6 flex items-center justify-center rounded-full mr-2">${i+1}</span><div class="truncate text-sm font-bold text-gray-700 flex-1">${c.title}</div>`;l.appendChild(d);});}
        function selectCard(id){currentEditId=id;renderSidebar();const c=cardsData.find(x=>x.id===id);if(!c)return;document.getElementById('edit-type').value=c.type;document.getElementById('edit-title').value=c.title;document.getElementById('edit-tag').value=c.tag||'';document.getElementById('edit-color').value=c.color||'#594a42';if(['cover','intro','chapter','quote','stat','contact'].includes(c.type))document.getElementById('edit-content').value=c.content||'';else document.getElementById('edit-content').value=(c.list||[]).join('\n');showEditor(true);jumpToCard(id);}
        function showEditor(s){document.getElementById('editor-form').className=s?'w-full bg-white p-6 rounded-xl shadow-sm border border-gray-200':'hidden';document.getElementById('editor-empty').className=s?'hidden':'h-full flex flex-col items-center justify-center text-gray-400';}
        function applyEdit(){const c=cardsData.find(x=>x.id===currentEditId);if(!c)return;c.type=document.getElementById('edit-type').value;c.title=document.getElementById('edit-title').value;c.tag=document.getElementById('edit-tag').value;c.color=document.getElementById('edit-color').value;c.titleScale=document.getElementById('edit-title-scale').value;const v=document.getElementById('edit-content').value;if(['cover','intro','chapter','quote','stat','contact'].includes(c.type)){c.content=v;delete c.list;}else{c.list=v.split('\n');delete c.content;}updateMemoryState();alert('å·²ä¿®æ”¹ (æš«å­˜)');}
        function renderLibraryList(){const d=document.getElementById('lib-list-container');d.innerHTML='';textLibrary.forEach((t,i)=>{const b=document.createElement('div');b.className='lib-item '+(i===selectedLibIndex?'active':'');b.innerText=t.content;b.onclick=()=>{selectedLibIndex=i;renderLibraryList();};d.appendChild(b);});}
        function lib_add_new(){const v=document.getElementById('lib-new-content').value;if(v){textLibrary.push({content:v});renderLibraryList();}}
        function lib_insert_at_cursor(){if(selectedLibIndex<0)return;const t=textLibrary[selectedLibIndex].content;const e=document.getElementById('edit-content');e.setRangeText(t,e.selectionStart,e.selectionEnd,'end');}
        function lib_delete(){if(selectedLibIndex>=0){textLibrary.splice(selectedLibIndex,1);selectedLibIndex=-1;renderLibraryList();}}
        window.insertLink=()=>{const u=prompt('URL?');if(u)document.getElementById('edit-content').setRangeText(`[link:${u}]é€£çµæ–‡å­—[/link]`);};
        window.insertColorCode=(c)=>document.getElementById('edit-content').setRangeText(`[color:${c}]æ–‡å­—[/color]`);
        
    </script>
</body>
</html>